var mi=Object.defineProperty;var fi=(s,r,e)=>r in s?mi(s,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[r]=e;var c=(s,r,e)=>(fi(s,typeof r!="symbol"?r+"":r,e),e);import{d as K,r as pi,t as xi,m as fs,p as ps,q as xs,a as lt,R as L,j as t,b as N,H as gi,T as gs,F as wi,c as vi,U as ws,L as J,e as Ct,f as ze,X as $t,E as ji,g as bi,h as yi,A as vs,I as Ni,i as Si,k as js,B as Re,C as ki,l as Ci,S as _t,n as $i,o as _i,s as je,u as bs,D as Ti,v as _e,w as Pi,x as Ri,M as Li,y as Ei,z as Mi,G as Tt,J as Fi,K as Ii,N as ys,P as Ue,O as At,Q as Di,V as oe,W as Ns,Y as Se,Z as pe,_ as Ss,$ as ks,a0 as Cs,a1 as et,a2 as $s,a3 as zi,a4 as Hi,a5 as _s,a6 as Ts,a7 as qi,a8 as Ai,a9 as Bi,aa as We,ab as Oi}from"./vendor-1f4b23dd.js";import"./hls-d9890d2c.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const Vi={ch:"零壹贰叁肆伍陆柒捌玖",ch_u:"个拾佰仟万亿",ch_f:"负",ch_d:"点",m_t:"人民币",m_z:"整",m_u:"元角分"},Bt={ch:"零一二三四五六七八九",ch_u:"个十百千万亿",ch_f:"负",ch_d:"点"},Ot=/^([+-])?0*(\d+)(\.(\d+))?$/,Ps=/^([+-])?0*(\d+)(\.(\d+))?e(([+-])?(\d+))$/i;function Ui(s){var r=Ps.exec(s.toString());if(!r)return s;var e=r[2],i=r[4]||"",n=r[5]?+r[5]:0;if(n>0){var a=i.substr(0,n);a=a.length<n?a+new Array(n-a.length+1).join("0"):a,i=i.substr(n),e+=a}else{n=-n;var o=e.length-n;o=o<0?0:o;var l=e.substr(o,n);l=l.length<n?new Array(n-l.length+1).join("0")+l:l,e=e.substring(0,o),i=l+i}return e=e==""?"0":e,(r[1]=="-"?"-":"")+e+(i?"."+i:"")}function Vt(s){var r=Ot.exec(s.toString());return!r&&Ps.test(s.toString())&&(r=Ot.exec(Ui(s.toString()))),r?{int:r[2],decimal:r[4],minus:r[1]=="-",num:r.slice(1,3).join("")}:null}function Be(s,r,e){if(s.splice.apply(s,[0,r.length].concat(r.splice(0,r.length))),arguments.length>2){var i=[].slice.call(arguments,2);i.unshift(s),Be.apply(null,i)}return s}function Wi(s,r){return Object.prototype.hasOwnProperty.call(s,r)}function ct(...s){for(var r,e=arguments[0]||{},i=Array.prototype.slice.call(arguments,1),n=0;n<i.length;n++){var a=i[n];for(r in a)Wi(a,r)&&(e[r]=a[r])}return e}function Ut(s){return s>=5?(s-4)*4+4:s}function ht(s,r){if(r==null&&(r=1),!(r<=0))for(;r--;)s.unshift(0)}function Wt(s,r,e){if(s==null)return"";var i=~"*.?+$^[](){}|\\/".indexOf(r)?"\\"+r:r,n=new RegExp("^"+i+"+"),a=new RegExp(i+"+$"),o=new RegExp(i+"{2}","g");return s=s.toString(),e=="^"&&(s=s.replace(n,"")),(!e||e=="$")&&(s=s.replace(a,"")),(!e||e=="nto1")&&(s=s.replace(o,r)),s}function Gt(s,r={}){const e=Vt(s);if(!e)return String(s);const{ch:i="",ch_u:n="",ch_f:a="",ch_d:o="."}=r;var l=i.charAt(0),h=e.int,u=e.decimal,d=e.minus,m="",f="",x=d?a:"";const g=function k(b,P,T){b=Vt(b).int;var I="",$=arguments.length>1?arguments[1]:r.tenMin,R=b.length;if(R===1)return i.charAt(+b);if(R<=4)for(var C=0,B=R;B--;){var S=+b.charAt(C);I+=$&&R==2&&C==0&&S==1?"":i.charAt(S),I+=S&&B?n.charAt(B):"",C++}else{for(var E=b.length/4>>0,U=b.length%4;U==0||!n.charAt(3+E);)U+=4,E--;var ne=b.substr(0,U),ae=b.substr(U);I=k(ne,$)+n.charAt(3+E)+(ae.charAt(0)=="0"?l:"")+k(ae,ae.length>4?$:!1)}return I=Wt(I,l),I};if(u){u=Wt(u,"0","$");for(var w=0;w<u.length;w++)f+=i.charAt(+u.charAt(w));f=f?o+f:""}if(m=g(h),r.ww&&n.length>5){var p=n.charAt(4),j=n.charAt(5),y=m.lastIndexOf(j);~y&&(m=m.substring(0,y).replace(new RegExp(j,"g"),p+p)+m.substring(y))}return x+m+f}function Gi(s,r={}){s=s.toString();const{ch:e="",ch_d:i="",ch_f:n="",ch_u:a=""}=r;var o=s.split(i),l=o[0].replace(n,""),h=o[1],u=!!~o[0].indexOf(n),d=a.charAt(1),m=a.charAt(4),f=a.charAt(5);l=l.replace(new RegExp(m+"{2}","g"),f);for(var x=l.split(""),g=0,w=0,p=[],j=[],y=[],k=0;k<x.length;k++){var b=x[k],P=0,T=0;if(~(P=e.indexOf(b)))P>0&&y.unshift(P);else if(~(T=a.indexOf(b))){var I=Ut(T);g>T?(ht(y,I),Be(j,y)):T>=w?(k==0&&(y=[1]),Be(p,j,y),p.length>0&&ht(p,I),w=T):(y.length==0&&d==b&&(y=[1]),Be(j,y),ht(j,Ut(T)),g=T)}}Be(p,j,y).reverse(),p.length==0&&p.push(0);var $=0;if(h){p.push("."),$="0.";for(var k=0;k<h.length;k++)$+=e.indexOf(h.charAt(k)),p.push(e.indexOf(h.charAt(k)));$=+$}return u&&p.unshift("-"),parseFloat(p.join(""))}const Yi={encodeS(s,r={}){return Gt(s,ct({ww:!0,...Bt},r))},encodeB(s,r={}){return Gt(s,ct({ww:!0,...Vi},r))},decodeS(s,r={}){return Gi(s,ct({ww:!0,...Bt},r))}};K.extend(pi);K.locale("zh-cn");function _(...s){return xi(s)}function Ie(s,r={count:2,pos:1}){const{count:e,pos:i}=r;if(String(s).length<e){const n=e-String(s).length;if(i===1)return`${"0".repeat(n)}${s}`;if(i===2)return`${s}${"0".repeat(n)}`}return String(s)}function Ki(s){if(typeof s=="number")return`第${s}集`;if(s.match(/^[0-9]/))return s;const r=/(\d+)/g;let e=s.replace(/[eE]/g,"");const i=e.match(r);if(!i)return s;for(let n=0;n<i.length;n++){const a=parseInt(i[n],10),o=Xi(a);e=e.replace(i[n],`第${o}集`)}return e}function Xi(s){return Yi.encodeS(s)}function Te(s){return Object.keys(s).filter(r=>s[r]!==void 0).map(r=>`${r}=${encodeURIComponent(s[r])}`).join("&")}function Rs(s){const r=Math.floor(s/60),e=Math.floor(s-r*60);return[r,"分",e,"秒"].join("")}function fe(s){const r=Math.floor(s/3600),e=Math.floor((s-r*3600)/60),i=Math.floor(s-r*3600-e*60);return r>0?r+":"+Ie(e)+":"+Ie(i):Ie(e)+":"+Ie(i)}function Ji(s){const r=Math.floor(s/60),e=s%60,i=String(r).padStart(2,"0"),n=String(e).padStart(2,"0");return`${i}:${n}`}function pt(s){const r=K(s),e=K(),i=e.diff(r,"minute");let n;return i>=7*24*60?n="7天前":i>=24*60?n=e.diff(r,"day")+"天前":i>=60?n=e.diff(r,"hour")+"小时前":i>0?n=i+"分钟前":n="刚刚",n}function ke(s=1e3){return new Promise(r=>{setTimeout(()=>{r(null)},s)})}function Ls(s,r){function e(i){return i&&typeof i=="object"&&!Array.isArray(i)}for(const i in r)e(r[i])?(s[i]||(s[i]={}),s[i]=Ls(s[i],r[i])):s[i]===void 0&&(s[i]=r[i]);return s}const Yt={get(s,r,e={}){const{headers:i}=e;return{url:[s,r?"?"+Te(r):""].join(""),method:"GET",headers:i}},post(s,r,e={}){const{headers:i}=e;return{url:s,method:"POST",body:r,headers:i}}};function Qi(s={}){const{hostnames:r={}}=s;let e=r.prod||"",i=s.headers??{},n=s.debug??!1;return{getHostname(){return e},setHostname(a){e=a},setHeaders(a){i=a},deleteHeaders(a){delete i[a]},appendHeaders(a){i={...i,...a}},setEnv(a){const{prod:o="",dev:l=o,test:h=o,beta:u=o}=r;a==="dev"&&(e=l),a==="test"&&(e=h),a==="beta"&&(e=u),a==="prod"&&(e=o)},setDebug(a){n=a},get(...a){const o=Yt.get(...a),{url:l,method:h,query:u,params:d,body:m,headers:f}=o;return{hostname:e,url:l,method:h,query:u,params:d,body:m,headers:{...o.headers,...i},process:s.process}},post(...a){const o=Yt.post(...a),{url:l,method:h,query:u,params:d,body:m}=o;return{hostname:e,url:l,method:h,query:u,params:d,body:m,headers:{...o.headers,...i},process:s.process}}}}class ut extends Error{constructor(e,i,n=null){super(e);c(this,"message");c(this,"code");c(this,"data",null);this.message=e,this.code=i,this.data=n}}const v={Ok:s=>({data:s,error:null}),Err:(s,r,e=null)=>({data:e,code:r,error:(()=>typeof s=="string"?new ut(s,r,e):s instanceof ut?s:typeof s=="object"?new ut(s.message,r,e):s.error)()})},A=Qi({hostnames:{dev:"https://media-t.funzm.com",test:"https://media-t.funzm.com",prod:""},process(s){if(s.error)return v.Err(s.error.message);const{code:r,msg:e,data:i}=s.data;return r!==0?v.Err(e,r,i):v.Ok(i)}}),Es="2.4.1";var Y=(s=>(s.US="US",s.CN="CN",s.TW="TW",s.HK="HK",s.JP="JP",s.DE="DE",s.GB="GB",s.FR="FR",s.IT="IT",s.BR="BR",s.CA="CA",s.AU="AU",s.IN="IN",s.RU="RU",s.KR="KR",s.BE="BE",s.ES="ES",s.MX="MX",s.ID="ID",s.TR="TR",s.SA="SA",s.ZA="ZA",s.AR="AR",s.TH="TH",s.EG="EG",s.NL="NL",s.CH="CH",s.SE="SE",s.PL="PL",s.PK="PK",s.NG="NG",s.MY="MY",s.BD="BD",s))(Y||{});const xt={CN:"国产剧",TW:"台剧",HK:"港剧",JP:"日剧",KR:"韩剧",US:"美剧",GB:"英剧",FR:"法国",IT:"意大利",BR:"巴西",BE:"比利时",DE:"德国",CA:"加拿大",AU:"澳大利亚",IN:"印度",RU:"俄罗斯",ES:"西班牙",MX:"墨西哥",ID:"印度尼西亚",TR:"土耳其",SA:"沙特阿拉伯",ZA:"南非",AR:"阿根廷",TH:"泰国",EG:"埃及",NL:"荷兰",CH:"瑞士",SE:"瑞典",PL:"波兰",PK:"巴基斯坦",NG:"尼日利亚",MY:"马来西亚",BD:"孟加拉国"},Kt=Object.keys(xt).slice(0,7).map(s=>({value:s,label:xt[s]})),Pt=["动作冒险","动画","喜剧","犯罪","纪录","剧情","家庭","儿童","悬疑","新闻","真人秀","Sci-Fi & Fantasy","肥皂剧","脱口秀","War & Politics","西部"],Zi=Pt.map(s=>({[s]:(()=>s==="Sci-Fi & Fantasy"?"奇幻":s==="War & Politics"?"战争/政治":s)()})).reduce((s,r)=>({...s,...r}),{}),er=Pt.map(s=>({label:Zi[s],value:s})),gt={CN:"中国大陆",TW:"中国台湾",HK:"中国香港",JP:"日本",KR:"韩国",US:"美国",GB:"英国",FR:"法国",IT:"意大利",BR:"巴西",DE:"德国",CA:"加拿大",AU:"澳大利亚",IN:"印度",RU:"俄罗斯",BE:"比利时",ES:"西班牙",MX:"墨西哥",ID:"印度尼西亚",TR:"土耳其",SA:"沙特阿拉伯",ZA:"南非",AR:"阿根廷",TH:"泰国",EG:"埃及",NL:"荷兰",CH:"瑞士",SE:"瑞典",PL:"波兰",PK:"巴基斯坦",NG:"尼日利亚",MY:"马来西亚",BD:"孟加拉国"};Object.keys(gt).slice(0,7).map(s=>({value:s,label:gt[s]}));Pt.map(s=>({[s]:s})).reduce((s,r)=>({...s,...r}),{});var Le=(s=>(s[s.Season=0]="Season",s[s.Movie=1]="Movie",s[s.Question=2]="Question",s[s.Want=3]="Want",s))(Le||{});const Ms=["信息有误","无法播放","分辨率太低","重复","缺少字幕","集/季数不全"];var O=(s=>(s[s.Season=1]="Season",s[s.Movie=2]="Movie",s))(O||{}),wt=(s=>(s[s.Manually=1]="Manually",s[s.DailyUpdate=2]="DailyUpdate",s[s.DailyUpdateDraft=3]="DailyUpdateDraft",s[s.DailyUpdateArchive=4]="DailyUpdateArchive",s[s.ManuallyRank=5]="ManuallyRank",s[s.ThirdPlatformRank=6]="ThirdPlatformRank",s[s.DoubanSeasonRank=7]="DoubanSeasonRank",s[s.DoubanMovieRank=8]="DoubanMovieRank",s[s.MaoyaoSeasonRank=9]="MaoyaoSeasonRank",s[s.MaoyaoMovieRank=10]="MaoyaoMovieRank",s))(wt||{}),Ze=(s=>(s[s.Loading=6]="Loading",s[s.Pending=1]="Pending",s[s.Scanned=2]="Scanned",s[s.Confirmed=3]="Confirmed",s[s.Expired=4]="Expired",s[s.Error=5]="Error",s))(Ze||{});function Ye(s){return A.post("/api/v2/wechat/report/create",s)}function tr(s){return A.post("/api/v2/wechat/notification/list",s)}function sr(s){if(s.error)return v.Err(s.error);const{next_marker:r,page_size:e,total:i,list:n}=s.data;return v.Ok({page_size:e,total:i,next_marker:r,list:n.map(a=>{const{id:o,content:l,status:h,created:u}=a,{msg:d,media:m}=JSON.parse(l);return{id:o,status:h,media:m,msg:d,created:K(u).format("YYYY-MM-DD HH:mm")}})})}function ir(s){const{id:r}=s;return A.post("/api/v2/wechat/notification/read",{id:r})}function rr(){return A.post("/api/v2/wechat/notification/read_all",{})}function nr(){return A.get("/api/info")}function ar(s){const{remark:r}=s;return A.post("/api/invitee/add",{remark:r})}function Fs(s){return A.get("/api/invitee/list",s)}function or(s){return A.post("/api/v2/wechat/collection/list",s)}function lr(s){return s.error?v.Err(s.error.message):v.Ok({...s.data,list:s.data.list.map(r=>{const{id:e,title:i,desc:n,medias:a}=r;return{id:e,title:i,desc:n,medias:a.sort((o,l)=>o.order-l.order).map(o=>{const{id:l,type:h,name:u,text:d,poster_path:m,air_date:f,cur_episode_count:x,episode_count:g}=o;return{id:l,type:h,name:u,poster_path:m,air_date:(()=>h===O.Movie?f:K(f).format("YYYY"))(),text:(()=>h===O.Movie?null:d||(x===g?`全${g}集`:`更新至${x}集`))()}}).filter(Boolean)}})})}function Is(s){return A.post("/api/v2/wechat/history/updated",{page:s.page,page_size:s.pageSize})}function Ds(s){if(s.error)return v.Err(s.error.message);const{page:r,page_size:e,no_more:i,list:n}=s.data;return v.Ok({page:r,page_size:e,no_more:i,list:n.map(a=>{const{id:o,name:l,poster_path:h,thumbnail_path:u,updated:d,latest_episode_order:m,latest_episode_name:f,latest_episode_created:x,cur_episode_name:g,cur_episode_order:w}=a;return{id:o,name:l,poster_path:h,episode_added:m-w,thumbnail_path:u,cur_episode:{order:w,name:g,updated_at:pt(d)},latest_episode:{order:m,name:f,created_at:pt(x)}}})})}function cr(s){return A.post("/api/v2/wechat/auth/code/confirm",s)}function hr(s){return A.post("/api/v2/wechat/invitation_code/list",s)}function zs(s){return A.post("/api/v2/wechat/invitation_code/create",s)}let Xt=0;function ur(){return Xt+=1,Xt}function dr(){const s=fs();let r=[];return{off(e,i){s.off(e,i)},on(e,i){const n=()=>{r=r.filter(a=>a!==n),this.off(e,i)};return r.push(n),s.on(e,i),n},emit(e,i){s.emit(e,i)},destroy(){for(let e=0;e<r.length;e+=1){const i=r[e];i()}this.emit("__destroy",null)}}}class q{constructor(r={}){c(this,"_unique_id","BaseDomain");c(this,"debug",!1);c(this,"_emitter",fs());c(this,"listeners",{});const{unique_id:e,debug:i}=r;e&&(this._unique_id=e)}uid(){return ur()}log(...r){return this.debug?[`%c CORE %c ${this._unique_id} %c`,"color:white;background:#dfa639;border-top-left-radius:2px;border-bottom-left-radius:2px;","color:white;background:#19be6b;border-top-right-radius:2px;border-bottom-right-radius:2px;","color:#19be6b;",...r]:[]}errorTip(...r){this.debug}off(r,e){this._emitter.off(r,e)}offEvent(r){const e=this.listeners[r]||[];for(let i=0;i<e.length;i+=1){const n=e[i];n()}}on(r,e){const i=()=>{const a=this.listeners[r]||[];this.listeners[r]=a.filter(o=>o!==i),this.off(r,e)};return(this.listeners[r]||[]).push(i),this._emitter.on(r,e),i}emit(r,e){this._emitter.emit(r,e)}tip(r){return this._emitter.emit("__tip",r),r.text.join(`
`)}destroy(){Object.keys(this.listeners).map(r=>{const e=this.listeners[r]||[];for(let i=0;i<e.length;i+=1){const n=e[i];n()}}),this.emit("__destroy")}onTip(r){return this.on("__tip",r)}onDestroy(r){return this.on("__destroy",r)}get[Symbol.toStringTag](){return"Domain"}}var Rt=(s=>(s.Horizontal="horizontal",s.Vertical="vertical",s))(Rt||{});const Je={sm:0,md:768,lg:992,xl:1200,"2xl":1536};function Jt(s){return s>=Je["2xl"]?"2xl":s>=Je.xl?"xl":s>=Je.lg?"lg":s>=Je.md?"md":"sm"}const Qt="(prefers-color-scheme: dark)";var Hs=(s=>(s[s.Tip=0]="Tip",s[s.Error=1]="Error",s[s.Login=2]="Login",s[s.Logout=3]="Logout",s[s.ForceUpdate=4]="ForceUpdate",s[s.DeviceSizeChange=5]="DeviceSizeChange",s[s.Ready=6]="Ready",s[s.Show=7]="Show",s[s.Hidden=8]="Hidden",s[s.Resize=9]="Resize",s[s.Blur=10]="Blur",s[s.Keydown=11]="Keydown",s[s.OrientationChange=12]="OrientationChange",s[s.EscapeKeyDown=13]="EscapeKeyDown",s[s.StateChange=14]="StateChange",s))(Hs||{});class mr extends q{constructor(e){super();c(this,"$user");c(this,"$storage");c(this,"lifetimes");c(this,"ready",!1);c(this,"screen",{width:0,height:0});c(this,"env",{wechat:!1,ios:!1,android:!1,pc:!1,weapp:!1,prod:"develop"});c(this,"orientation","vertical");c(this,"curDeviceSize","md");c(this,"theme","system");c(this,"pending",!1);c(this,"safeArea",!1);c(this,"Events",Hs);const{user:i,storage:n,beforeReady:a,onReady:o}=e;this.$user=i,this.$storage=n,this.lifetimes={beforeReady:a,onReady:o}}get state(){return{ready:this.ready,theme:this.theme,env:this.env,deviceSize:this.curDeviceSize}}async start(e){const{width:i,height:n}=e;this.screen={...this.screen,width:i,height:n},this.curDeviceSize=Jt(i);const{beforeReady:a}=this.lifetimes;if(a){if(this.pending)return v.Err("请不要重复加载");this.pending=!0;const o=await a();if(this.pending=!1,o.error)return v.Err(o.error)}return this.ready=!0,this.emit(6),this.emit(14,{...this.state}),v.Ok(null)}setTheme(e){let i=e;if(i&&e==="system"){const n=this.getSystemTheme();if(n.error)return;i=n.data}}applyTheme(e){const i="请在 connect.web 中实现 applyTheme 方法";return v.Err(i)}getTheme(){const e="请在 connect.web 中实现 getTheme 方法";return v.Err(e)}getSystemTheme(e){const i="请在 connect.web 中实现 getSystemTheme 方法";return v.Err(i)}tipUpdate(){this.emit(4)}vibrate(){}setSize(e){this.screen=e}setTitle(e){throw new Error("请实现 setTitle 方法")}setEnv(e){this.env={...this.env,...e}}copy(e){throw new Error("请实现 copy 方法")}getComputedStyle(e){throw new Error("请实现 getComputedStyle 方法")}notify(e){}disablePointer(){throw new Error("请实现 disablePointer 方法")}enablePointer(){throw new Error("请实现 enablePointer 方法")}keydown({key:e}){e==="Escape"&&this.escape(),this.emit(11,{key:e})}escape(){this.emit(13)}resize(e){this.screen=e,this.emit(9,e)}blur(){this.emit(10)}handleScreenOrientationChange(e){if(e===0){this.orientation="vertical",this.emit(12,this.orientation);return}this.orientation="horizontal",this.emit(12,this.orientation)}handleResize(e){this.screen=e;const i=Jt(e.width);i!==this.curDeviceSize&&(this.curDeviceSize=i,this.emit(5,this.curDeviceSize)),this.emit(9,e)}onReady(e){return this.on(6,e)}onDeviceSizeChange(e){return this.on(5,e)}onUpdate(e){return this.on(4,e)}onOrientationChange(e){return this.on(12,e)}onResize(e){return this.on(9,e)}onBlur(e){return this.on(10,e)}onShow(e){return this.on(7,e)}onHidden(e){return this.on(8,e)}onKeydown(e){return this.on(11,e)}onEscapeKeyDown(e){return this.on(13,e)}onStateChange(e){return this.on(14,e)}onError(e){return this.on(1,e)}}let vt=null;function fr(s){vt=s}class F extends q{constructor(e,i={}){super();c(this,"debug",!1);c(this,"defaultResponse",null);c(this,"service");c(this,"process");c(this,"client");c(this,"delay",800);c(this,"loading",!1);c(this,"pending",null);c(this,"response",null);c(this,"error",null);c(this,"id",String(this.uid()));const{client:n,delay:a,defaultResponse:o,process:l,onSuccess:h,onFailed:u,onCompleted:d,onCanceled:m,onLoading:f,beforeRequest:x}=i;this.service=e,this.process=l,this.client=n,a!==void 0&&(this.delay=a),o&&(this.defaultResponse=o,this.response=o),h&&this.onSuccess(h),u&&this.onFailed(u,{override:!0}),d&&this.onCompleted(d),m&&this.onCanceled(m),f&&this.onLoadingChange(f),x&&this.beforeRequest(x),vt&&vt(this)}get state(){return{loading:this.loading,error:this.error,response:this.response}}async run(...e){if(!this.service)return v.Err("缺少 service");if(typeof this.service!="function")return v.Err("service 不是函数");if(!this.client)return v.Err("缺少 client");if(this.pending!==null){const u=await this.pending;this.loading=!1;const d=u.data;return this.pending=null,v.Ok(d)}this.loading=!0,this.response=this.defaultResponse,this.error=null,this.emit(2,!0),this.emit(7,{...this.state}),this.emit(0);let i=null;const n=(()=>{const{hostname:u="",url:d,method:m,query:f,body:x,headers:g,process:w}=this.service(...e);if(w&&(i=w),m==="GET"){const p=this.client.get(u+d,f,{id:this.id,headers:g});return v.Ok(p)}if(m==="POST"){const p=this.client.post(u+d,x,{id:this.id,headers:g});return v.Ok(p)}return v.Err(`未知的 method '${m}'`)})();if(n.error)return v.Err(n.error.message);this.pending=n.data;const[a]=await Promise.all([this.pending,this.delay===null?null:ke(this.delay)]);this.loading=!1;const o=(()=>i?i(a):a)(),l=this.process?this.process(o):o;if(this.emit(2,!1),this.emit(7,{...this.state}),this.emit(5),this.pending=null,l.error)return l.error.code==="CANCEL"?(this.emit(6),v.Err(l.error)):(this.error=l.error,this.emit(4,l.error),this.emit(7,{...this.state}),v.Err(l.error.message));const h=l.data;return this.response=h,this.emit(3,h),this.emit(7,{...this.state}),this.emit(8,h),v.Ok(h)}reload(){}cancel(){if(!this.client)return v.Err("缺少 client");this.client.cancel(this.id)}clear(){this.response=null,this.emit(7,{...this.state}),this.emit(8,this.response)}modifyResponse(e){if(this.response===null)return;const i=e(this.response);this.response=i,this.emit(7,{...this.state}),this.emit(8,this.response)}onLoadingChange(e){return this.on(2,e)}beforeRequest(e){return this.on(0,e)}onSuccess(e){return this.on(3,e)}onFailed(e,i={}){return i.override&&this.offEvent(4),this.on(4,e)}onCanceled(e){return this.on(6,e)}onError(e){return this.on(4,e)}onCompleted(e){return this.on(5,e)}onStateChange(e){return this.on(7,e)}onResponseChange(e){return this.on(8,e)}}function Ke(s,r){let e;return function(...n){e&&clearTimeout(e),e=setTimeout(()=>{r(...n),e=null},s)}}const tt=10,De=1,jt=0,dt={dataSource:[],page:De,pageSize:tt,total:jt,search:{},initial:!0,noMore:!1,loading:!1,refreshing:null,empty:!1,error:null},mt={page:De,pageSize:tt,next_marker:""};function pr(s,r){const e={...s};return r.forEach(i=>{delete e[i]}),e}const xr=s=>{if(s===null)return{dataSource:[],page:1,pageSize:tt,total:jt,noMore:!1,empty:!1,error:new Error("process response fail, because response is null")};try{const r=s,{list:e,page:i=1,pageSize:n=10,total:a=0,isEnd:o}=r,l={dataSource:e,page:i,pageSize:n,total:a,noMore:!1,empty:!1,error:null};return a&&n&&i&&a<=n*i&&(l.noMore=!0),o!==void 0&&(l.noMore=o),n&&e.length<n&&(l.noMore=!0),e.length===0&&i===1&&(l.empty=!0),l}catch(r){return{dataSource:[],page:1,pageSize:tt,total:jt,noMore:!1,empty:!1,error:new Error(`process response fail, because ${r.message}`)}}},nt=class extends q{constructor(e,i={}){super();c(this,"debug",!1);c(this,"request");c(this,"beforeRequest",(e,i)=>({...i,...e}));c(this,"processor");c(this,"initialParams");c(this,"extraResponse");c(this,"params",{...mt});c(this,"response",{...dt});c(this,"rowKey");c(this,"searchDebounce",Ke(800,e=>this.search(e)));if(!(e instanceof F))throw new Error("fetch must be a instance of RequestCore");const{debug:n,rowKey:a="id",beforeRequest:o,processor:l,extraDefaultResponse:h,onLoadingChange:u,onStateChange:d,beforeSearch:m,afterSearch:f}=i;this.debug=!!n,this.rowKey=a,this.request=e,this.processor=x=>{const g={...this.response,...nt.commonProcessor(x)};if(l){const w=l(g,x);if(w!==void 0)return w}return g},o!==void 0&&(this.beforeRequest=o),this.initialParams={...mt},this.extraResponse={...h},u&&this.onLoadingChange(u),d&&this.onStateChange(d),m&&this.onBeforeSearch(m),f&&this.onAfterSearch(f),this.initialize(i)}initialize(e){const{search:i,dataSource:n,page:a,pageSize:o,initial:l}=e;i!==void 0&&(this.initialParams={...this.initialParams,...i},this.extraResponse.search=i),n!==void 0&&(this.extraResponse.dataSource=n),a!==void 0&&(this.initialParams.page=a,this.extraResponse.page=a),o!==void 0&&(this.initialParams.pageSize=o,this.extraResponse.pageSize=o),l!==void 0&&(this.extraResponse.initial=l),this.params={...this.initialParams},this.response={...nt.defaultResponse(),...this.extraResponse};const{page:h,pageSize:u,...d}=this.params,m={search:d};h&&(m.page=h),u&&(m.pageSize=u),this.response={...this.response,...m,search:{...this.response.search}}}setParams(e){let i={...this.params,...e};typeof e=="function"&&(i=e(this.params)),this.params=i,this.emit(3,{...this.params})}setDataSource(e){this.response.dataSource=e,this.emit(6,{...this.response})}async fetch(e,...i){this.response.error=null,this.response.loading=!0,this.emit(0,!0),this.emit(6,{...this.response});const n={...this.params,...e};let a=this.beforeRequest({...n},this.params);a===void 0&&(a=n);const o=await this.request.run(a,...i);if(this.response.loading=!1,this.response.search=pr({...n},["page","pageSize"]),this.response.initial&&(this.response.initial=!1),this.params={...a},this.emit(0,!1),this.emit(3,{...this.params}),this.emit(8),o.error)return v.Err(o.error);const l=o.data;let h=this.processor(l);return e.page===1&&h.dataSource.length===0&&(h.empty=!0),h.next_marker&&(this.params.next_marker=h.next_marker),h.dataSource===void 0&&(h.dataSource=[]),v.Ok(h)}async init(e){const i=await this.fetch({...this.initialParams,...e||{}});return i.error?(this.tip({icon:"error",text:[i.error.message]}),this.response.error=i.error,this.emit(7,i.error),this.emit(6,{...this.response}),v.Err(i.error)):(this.response={...this.response,...i.data},this.emit(6,{...this.response}),this.emit(5,[...i.data.dataSource]),this.emit(4,[...this.response.dataSource]),v.Ok({...this.response}))}async initAny(){return this.response.initial?this.init():(this.emit(6,{...this.response}),v.Ok(this.response))}async next(){const{page:e,...i}=this.params,n=await this.fetch({...i,page:e+1});return n.error?(this.tip({icon:"error",text:[n.error.message]}),this.response.error=n.error,this.emit(7,n.error),this.emit(6,{...this.response}),v.Err(n.error)):(this.response={...this.response,...n.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),v.Ok({...this.response}))}async prev(){const{page:e,...i}=this.params,n=await this.fetch({...i,page:(()=>e<=De?De:e-1)()});return n.error?(this.tip({icon:"error",text:[n.error.message]}),this.response.error=n.error,this.emit(7,n.error),this.emit(6,{...this.response}),v.Err(n.error)):(this.response={...this.response,...n.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),v.Ok({...this.response}))}nextWithCursor(){}async loadMoreForce(){const{page:e,...i}=this.params,n=await this.fetch({...i,page:e+1});if(n.error)return this.tip({icon:"error",text:[n.error.message]}),this.response.error=n.error,this.emit(7,n.error),this.emit(6,{...this.response}),v.Err(n.error);n.data.dataSource.length===0&&(this.params.page-=1);const a=this.response.dataSource;return this.response={...this.response,...n.data},this.response.dataSource=a.concat(n.data.dataSource),this.emit(6,{...this.response}),this.emit(5,[...n.data.dataSource]),this.emit(4,[...this.response.dataSource]),v.Ok({...this.response})}async loadMore(){if(this.response.loading||this.response.noMore)return;const{page:e,...i}=this.params,n=await this.fetch({...i,page:e+1});if(n.error)return this.tip({icon:"error",text:[n.error.message]}),this.response.error=n.error,this.emit(7,n.error),this.emit(6,{...this.response}),v.Err(n.error);const a=this.response.dataSource;return this.response={...this.response,...n.data},this.response.dataSource=a.concat(n.data.dataSource),this.emit(6,{...this.response}),this.emit(5,[...n.data.dataSource]),this.emit(4,[...this.response.dataSource]),v.Ok({...this.response})}async goto(e,i){const{page:n,pageSize:a,...o}=this.params,l=await this.fetch({...o,page:(()=>e<=De?De:e)(),pageSize:(()=>i!==void 0?i:a)()});return l.error?(this.tip({icon:"error",text:[l.error.message]}),this.response.error=l.error,this.emit(7,l.error),this.emit(6,{...this.response}),v.Err(l.error)):(this.response={...this.response,...l.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),v.Ok({...this.response}))}async search(e){this.emit(1);const i=await this.fetch({...this.initialParams,...e});return this.emit(2,{params:e}),i.error?(this.tip({icon:"error",text:[i.error.message]}),this.response.error=i.error,this.emit(7,i.error),this.emit(6,{...this.response}),v.Err(i.error)):(this.response={...this.response,...i.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),v.Ok({...this.response}))}async reset(e={}){this.params={...this.initialParams};const i=await this.fetch(e);return i.error?(this.tip({icon:"error",text:[i.error.message]}),this.response.error=i.error,this.emit(7,i.error),this.emit(6,{...this.response}),v.Err(i.error)):(this.response={...this.response,...i.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),v.Ok({...this.response}))}reload(){return this.fetch({})}async refresh(){const{page:e,...i}=this.params;this.response.refreshing=!0,this.emit(6,{...this.response});const n=await this.fetch({...i,page:1,next_marker:""});return this.response.refreshing=!1,n.error?(this.tip({icon:"error",text:[n.error.message]}),this.response.error=n.error,this.emit(7,n.error),this.emit(6,{...this.response}),v.Err(n.error)):(this.response={...this.response,...n.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),v.Ok({...this.response}))}clear(){this.response={...dt},this.params={...mt},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource])}deleteItem(e){const{dataSource:i}=this.response,n=i.filter(a=>!e(a));this.response.total=n.length,this.response.dataSource=n,this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource])}async deleteItems(e){const{dataSource:i}=this.response,n=i.filter(a=>!e.includes(a));this.response.total=n.length,this.response.dataSource=n,this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource])}modifyItem(e){const{dataSource:i}=this.response,n=[];for(let a=0;a<i.length;a+=1){const o=i[a];let l=e(o);l||(l=o),n.push(l)}this.response.dataSource=n,this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource])}replaceDataSource(e){this.response.dataSource=e,this.emit(4,[...this.response.dataSource])}modifyDataSource(e){this.response.dataSource=this.response.dataSource.map(i=>e(i)),this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource])}modifyResponse(e){this.response=e({...this.response}),this.emit(6,{...this.response})}modifyParams(e){this.params=e(this.params),this.emit(3,{...this.params})}modifySearch(e){this.params={...e(this.params),page:this.params.page,pageSize:this.params.pageSize},this.emit(3,{...this.params})}onStateChange(e){return this.on(6,e)}onLoadingChange(e){return this.on(0,e)}onBeforeSearch(e){return this.on(1,e)}onAfterSearch(e){return this.on(2,e)}onDataSourceChange(e){return this.on(4,e)}onDataSourceAdded(e){return this.on(5,e)}onError(e){return this.on(7,e)}onComplete(e){return this.on(8,e)}};let ie=nt;c(ie,"defaultResponse",()=>({...dt})),c(ie,"commonProcessor",xr);const Ne=class extends q{constructor(){super(...arguments);c(this,"_unique_id","NavigatorCore");c(this,"debug",!1);c(this,"name","root");c(this,"pathname","/");c(this,"query",{});c(this,"params",{});c(this,"location",{});c(this,"href","/");c(this,"histories",[]);c(this,"prevHistories",[]);c(this,"prevPathname",null);c(this,"origin","");c(this,"_pending",{pathname:"/",search:"",type:"initialize"})}static parse(e){const{pathname:i,query:n,...a}=ps(e),o=xs.parse(n,{ignoreQueryPrefix:!0});return Ne.prefix&&i.startsWith(Ne.prefix)?{...a,query:o,pathname:i.replace(Ne.prefix,"")}:{...a,query:o,pathname:i}}get state(){return{pathname:this.pathname,search:this._pending.search,params:this.params,query:this.query,location:this.location}}async prepare(e){const{pathname:i,href:n,search:a,origin:o}=e,l=i.replace(Ne.prefix,"");this.setPathname(l),this.origin=o,this.location=e;const h=gr(n);this.query=h,this._pending={pathname:l,search:a,type:"initialize"}}start(){const{pathname:e}=this._pending;this.setPathname(e),this.histories=[{pathname:e}],this.emit(7,{...this._pending})}setPrevPathname(e){this.prevPathname=e}setPathname(e){this.pathname=e}pushState(e){const i=`${this.origin}${Ne.prefix}${e}`,n=new URL(i),{pathname:a,search:o}=n,l=this.pathname;this.setPrevPathname(l),this.setPathname(a),this.histories.push({pathname:a}),this.emit(0,{from:l,to:a,path:a+o,pathname:a}),this.emit(10,[...this.histories])}async replaceState(e){const i=`${this.origin}${Ne.prefix}${e}`,n=new URL(i),{pathname:a,search:o}=n;this.setPrevPathname(this.pathname),this.setPathname(a),this.histories[this.histories.length-1]={pathname:a},this.emit(1,{from:this.prevPathname,path:a+o,pathname:a}),this.emit(10,[...this.histories])}handlePopState({type:e,pathname:i,href:n}){if(e!=="popstate")return;const a=i,o=this.pathname;this.setPrevPathname(o),this.setPathname(a);const l=(()=>{if(this.prevHistories.length===0)return!1;const d=this.prevHistories[this.prevHistories.length-1];return(d==null?void 0:d.pathname)===a})();if(this._pending={pathname:i,search:"",type:(()=>l?"forward":"back")()},l){this.setPrevPathname(this.pathname),this.setPathname(a);const d=this.prevHistories.pop();d&&(this.histories=this.histories.concat([d])),this.emit(4),this.emit(10,[...this.histories]),this.emit(2,{type:"forward",pathname:i,href:n});return}this.emit(3);const h=this.histories[this.histories.length-1];this.prevHistories=this.prevHistories.concat([h]).filter(Boolean),this.setPrevPathname(this.pathname),this.setPathname(a);const u=this.histories.slice(0,this.histories.length-1);this.histories=u.filter(Boolean),this.emit(10,[...this.histories]),this.emit(2,{type:"back",pathname:i,href:n})}onStart(e){return this.on(6,e)}onHistoryChange(e){return this.on(10,e)}onPushState(e){return this.on(0,e)}onReplaceState(e){return this.on(1,e)}onPopState(e){return this.on(2,e)}onReload(e){return this.on(5,e)}onPathnameChange(e){return this.on(7,e)}onBack(e){return this.on(3,e)}onForward(e){return this.on(4,e)}onRelaunch(e){return this.on(8,e)}onHistoriesChange(e){return this.on(10,e)}};let Pe=Ne;c(Pe,"prefix",null);function gr(s){const[,r]=s.split("?");return r?xs.parse(r):{}}class Z extends q{constructor(e={}){super(e);c(this,"name","PresenceCore");c(this,"debug",!1);c(this,"animationName","none");c(this,"mounted",!1);c(this,"enter",!1);c(this,"visible",!1);c(this,"exit",!1);const{mounted:i=!1,visible:n=!1}=e;this.mounted=i,this.visible=i,n&&(this.mounted=!0)}get state(){return{mounted:this.mounted,enter:this.enter,visible:this.visible,exit:this.exit,text:(()=>this.exit?"exit":this.enter?"enter":this.visible?"visible":"unknown")()}}toggle(e={}){if(this.visible){this.hide(e);return}this.show()}show(){this.mounted=!0,this.enter=!0,this.emit(0,{...this.state}),setTimeout(()=>{this.visible=!0,this.emit(2),this.emit(0,{...this.state})},120)}hide(e={}){const{destroy:i=!0}=e;if(i===!1){this.exit=!0,setTimeout(()=>{this.enter=!1,this.visible=!1,this.exit=!1,this.emit(4),this.emit(0,{...this.state})},120);return}this.exit=!0,this.emit(0,{...this.state}),setTimeout(()=>{this.visible=!1,this.emit(4),this.emit(0,{...this.state}),this.unmount()},120)}unmount(){this.mounted=!1,this.enter=!1,this.visible=!1,this.exit=!1,this.emit(6),this.emit(0,{...this.state})}reset(){this.mounted=!1,this.enter=!1,this.visible=!1,this.exit=!1,this.emit(0,{...this.state})}onTmpShow(e){return this.on(3,e)}onTmpHidden(e){return this.on(5,e)}onShow(e){return this.on(2,e)}onHidden(e){return this.on(4,e)}onUnmounted(e){return this.on(6,e)}onStateChange(e){return this.on(0,e)}onPresentChange(e){return this.on(1,e)}get[Symbol.toStringTag](){return"Presence"}}function Zt(s,r,e){const i=(()=>!e||Object.keys(e).length===0?"":"?"+Te(e))();return(()=>!s.match(/:[a-z]{1,}/)||!r||Object.keys(r).length===0?s+i:s.replace(/:([a-z]{1,})/g,(...a)=>{const[,o]=a;return String(r[o]||"")})+i)()}function qs(s,r=null){return Object.keys(s).map(i=>{const n=s[i],{title:a,pathname:o,options:l,children:h}=n,u=r?[r.name,i].filter(Boolean).join("."):i;if(h){const d=qs(h,{name:u,pathname:o});return[{title:a,name:u,pathname:o,options:l,layout:!0,parent:r?{name:r.name}:null},...d]}return[{title:a,name:u,pathname:o,options:l,parent:r?{name:r.name}:null}]}).reduce((i,n)=>i.concat(n),[])}function wr(s){const r=qs(s),e=r.map(n=>({[n.name]:n})).reduce((n,a)=>({...n,...a}),{}),i=r.map(n=>({[n.pathname]:n})).reduce((n,a)=>({...n,...a}),{});return{routes:e,routesWithPathname:i}}class Fe extends q{constructor(e){super(e);c(this,"_unique_id","ViewCore");c(this,"debug",!1);c(this,"id",this.uid());c(this,"name");c(this,"pathname");c(this,"title");c(this,"animation",{});c(this,"query",{});c(this,"params",{});c(this,"_showed",!1);c(this,"loaded",!1);c(this,"mounted",!0);c(this,"layered",!1);c(this,"isRoot",!1);c(this,"parent");c(this,"curView",null);c(this,"subViews",[]);c(this,"$presence",new Z);const{name:i,pathname:n,title:a,query:o={},visible:l=!1,animation:h={},parent:u=null,views:d=[]}=e;this.name=i,this.pathname=n,this.parent=u,this.title=a,this._unique_id=a,this.animation=h,this.subViews=d,d.length&&(this.curView=d[0]),this.query=o,l&&(this.mounted=!0);for(let m=0;m<d.length;m+=1){const f=d[m];f.parent=this}this.$presence.onStateChange(m=>{const{visible:f,mounted:x}=m,g=this.state.visible;g===!1&&f&&this.setShow(),g&&f===!1&&this.setHidden(),this.mounted=!!x,this.emit(13,{...this.state})})}get state(){return{mounted:this.mounted,visible:this.visible,layered:this.layered}}get href(){return[this.pathname,Te(this.query)].filter(Boolean).join("?")}get visible(){return this.$presence.visible}appendView(e){e.parent=this,this.subViews.length===0&&e.visible&&(this.curView=e),this.subViews.includes(e)||this.subViews.push(e),this.emit(0,[...this.subViews])}replaceViews(e){this.subViews=e,this.emit(0,[...this.subViews])}removeView(e,i={}){const{reason:n,destroy:a,callback:o}=i;this.subViews.includes(e)&&(e.onUnmounted(()=>{e.destroy(),this.subViews=this.subViews.filter(l=>l!==e),o&&o(),this.emit(0,[...this.subViews])}),e.hide({reason:n,destroy:a}),this.emit(0,[...this.subViews]))}findCurView(){return this.curView?this.curView.findCurView():this}ready(){this.emit(3)}showView(e,i={}){e!==this&&(e.visible||((()=>{if(!this.visible){if(!this.parent){this.isRoot;return}this.parent.showView(this,i)}})(),this.curView&&this.curView.hide(i),this.appendView(e),this.emit(5),this.curView=e,e.show(),this.emit(1,this.curView)))}show(){if(this.visible){this.$presence.state.mounted=!0;return}this.$presence.show()}hide(e={}){if(this.visible!==!1){for(let i=0;i<this.subViews.length;i+=1)this.subViews[i].hide(e);this.emit(7),this.$presence.hide(e)}}setShow(){this._showed||(this._showed=!0,this.emit(6))}setHidden(){this._showed=!1,this.emit(8)}mount(){this.setMounted()}unmount(){}setMounted(){this.mounted||(this.mounted=!0,this.emit(4))}setUnmounted(){this.mounted=!1,this.emit(9)}setLoaded(){this.loaded=!0}setUnload(){this.loaded=!1}buildUrl(e){return Zt(this.pathname,this.params,e)}buildUrlWithPrefix(e){const i=Zt(this.pathname,this.params,e);return[Pe.prefix,i].join("")}onStart(e){return this.on(12,e)}onReady(e){return this.on(3,e)}onMounted(e){return this.on(4,e)}onViewShow(e){return this.on(2,e)}onBeforeShow(e){return this.on(5,e)}onShow(e){return this.on(6,e)}onBeforeHide(e){return this.on(7,e)}onHidden(e){return this.on(8,e)}onLayered(e){return this.on(10,e)}onUncover(e){return this.on(11,e)}onUnmounted(e){return this.on(9,e)}onSubViewsChange(e){return this.on(0,e)}onCurViewChange(e){return this.on(1,e)}onMatched(e){return this.on(14,e)}onNotFound(e){return this.on(15,e)}onStateChange(e){return this.on(13,e)}}function vr(s){return A.post("/api/v2/wechat/mine/update_email",s)}function jr(s){return A.post("/api/v2/wechat/mine/update_pwd",s)}function br(s){return A.post("/api/validate",{token:s.token})}function yr(s){const{code:r}=s;return A.post("/api/v2/wechat/auth/weapp",{code:r})}function Nr(s){const{email:r,pwd:e}=s;return A.post("/api/v2/wechat/auth/login",{email:r,pwd:e})}function Sr(s){const{email:r,pwd:e,code:i}=s;return A.post("/api/v2/wechat/auth/register",{email:r,pwd:e,code:i})}var As=(s=>(s[s.Tip=0]="Tip",s[s.Error=1]="Error",s[s.Login=2]="Login",s[s.Logout=3]="Logout",s[s.Expired=4]="Expired",s[s.NeedUpdate=5]="NeedUpdate",s[s.StateChange=6]="StateChange",s))(As||{});class Bs extends q{constructor(e,i){super(e);c(this,"_unique_id","UserCore");c(this,"debug",!1);c(this,"id","");c(this,"username","Anonymous");c(this,"email","");c(this,"avatar","");c(this,"token","");c(this,"isLogin",!1);c(this,"permissions",[]);c(this,"$client");c(this,"$profile");const{id:n,username:a,email:o,avatar:l,token:h}=e;this.id=n,this.username=a,this.email=o,this.avatar=l,this.isLogin=!!h,this.token=h,this.$client=i,h&&this.$client.appendHeaders({Authorization:h}),this.$profile=new F(nr,{client:this.$client})}get state(){return{id:this.id,username:this.username,email:this.email,avatar:this.avatar,token:this.token}}async loginWithTokenId(e){const{token:i,tmp:n}=e;if(!i)return v.Err("缺少 token");const o=await new F(br,{client:this.$client}).run({token:i});return o.error?o.error.code===800?(this.emit(5),v.Err(o.error)):v.Err(o.error.message,900):(this.id=o.data.id,this.email=o.data.email,this.token=o.data.token,this.isLogin=!0,n||this.emit(2,{...this.state}),await ke(800),v.Ok({...this.state}))}async loginWithEmailAndPwd(e){const{email:i,pwd:n}=e;if(!i)return v.Err("请输入邮箱");if(!n)return v.Err("请输入密码");const o=await new F(Nr,{client:this.$client}).run({email:i,pwd:n});return o.error?v.Err(o.error):(this.id=o.data.id,this.token=o.data.token,this.isLogin=!0,this.emit(2,{...this.state}),v.Ok({id:this.id,token:this.token}))}authWithToken(e){const{id:i,email:n,token:a}=e;return a?(this.id=i,this.email=n,this.token=a,this.isLogin=!0,this.emit(2,{...this.state}),v.Ok({id:i,token:a})):v.Err("缺少 token")}async loginWithWeappCode(e){const{code:i}=e;if(!i)return v.Err("请传入 code");const a=await new F(yr,{client:this.$client}).run({code:i});return a.error?v.Err(a.error.message,900):(this.id=a.data.id,this.email=a.data.email,this.token=a.data.token,this.isLogin=!0,this.emit(2,{...this.state}),v.Ok({...this.state}))}async register(e){const{email:i,pwd:n,code:a}=e;if(!i)return v.Err("请输入邮箱");if(!n)return v.Err("请输入密码");const l=await new F(Sr,{client:this.$client}).run({email:i,pwd:n,code:a});return l.error?v.Err(l.error):(this.id=l.data.id,this.email=l.data.email,this.token=l.data.token,this.isLogin=!0,this.emit(2,{...this.state}),v.Ok({id:this.id,email:this.email,token:this.token}))}async fetchProfile(){if(!this.isLogin)return v.Err("请先登录");const e=await this.$profile.run();if(e.error)return e;const{nickname:i,email:n,avatar:a,permissions:o}=e.data;return this.username=i,this.email=n??"",this.avatar=a??"",this.permissions=o,v.Ok(e.data)}async updateEmail(e){const{email:i}=e;if(!i)return v.Err("请输入邮箱");const a=await new F(vr,{client:this.$client}).run({email:i});return a.error?v.Err(a.error.message):(this.email=i,this.emit(6,{...this.state}),v.Ok({}))}async updatePwd(e){const{pwd:i}=e;if(!i)return v.Err("请输入密码");const a=await new F(jr,{client:this.$client}).run({pwd:i});return a.error?v.Err(a.error.message):(this.emit(3),v.Ok({}))}hasPermission(e){return this.permissions.includes(e)}logout(){this.username="Anonymous",this.email="",this.avatar="",this.isLogin=!1,this.token="",this.emit(3)}onLogin(e){return this.on(2,e)}onLogout(e){return this.on(3,e)}onNeedUpdate(e){return this.on(5,e)}onExpired(e){return this.on(4,e)}}c(Bs,"Events",As);class kr extends q{constructor(e){super(e);c(this,"virtual",!1);c(this,"routes");c(this,"views");c(this,"stacks",[]);c(this,"cursor",-1);c(this,"$router");c(this,"$view");const{virtual:i=!1,view:n,router:a,routes:o,views:l}=e;this.$view=n,this.$router=a,this.routes=o,this.views=l,this.virtual=i}get state(){return{href:this.$router.href,stacks:this.stacks.map(e=>{const{id:i,pathname:n,title:a,query:o,visible:l}=e;return{id:[n,Te(o)].filter(Boolean).join("?"),key:n,title:a,query:JSON.stringify(o,null,2),visible:l}}),cursor:this.cursor}}push(e,i={},n={}){var m;const{ignore:a}=n;if(this.isLayout(e))return;const o=this.routes[e];if(!o)return;const l=[o.pathname,Te(i)].filter(Boolean).join("?");if(l===this.$router.href)return;const h=this.views[l];if(h){if(this.ensureParent(h),h.query=i,!h.parent)return;this.$router.href=h.href,this.$router.name=h.name,this.stacks=this.stacks.slice(0,this.cursor+1).concat(h),this.cursor+=1,h.parent.showView(h,{reason:"show_sibling",destroy:!1}),this.emit(1,{reason:"push",view:h,name:e,href:h.href,pathname:h.pathname,query:h.query,ignore:a}),this.emit(5,{...this.state});return}const u=(()=>{const f=this.routes[e];return f||null})();if(!u)return null;const d=new Fe({name:u.name,pathname:u.pathname,title:u.title,query:i,animation:(m=u.options)==null?void 0:m.animation,parent:null});this.views[l]=d,this.ensureParent(d),d.parent&&(this.$router.href=d.href,this.$router.name=d.name,this.stacks=this.stacks.slice(0,this.cursor+1).concat(d),this.cursor+=1,d.parent.showView(d,{reason:"show_sibling",destroy:!1}),this.emit(1,{reason:"push",view:d,name:e,href:d.href,pathname:d.pathname,query:d.query,ignore:a}),this.emit(5,{...this.state}))}replace(e,i={}){var u,d,m;const n=[e,Te(i)].filter(Boolean).join("?");if(n===this.$router.href)return;const a=this.views[n];if(a){if(this.ensureParent(a),a.query=i,!a.parent)return;this.$router.href=a.href,this.$router.name=a.name;const f=this.stacks[this.stacks.length-1];f&&((u=f.parent)==null||u.removeView(f)),this.stacks[this.stacks.length-1]=a,a.parent.showView(a),this.emit(1,{reason:"replace",view:a,name:a.name,href:a.href,pathname:a.pathname,query:a.query}),this.emit(5,{...this.state});return}const o=(()=>{const f=this.routes[e];return f||null})();if(!o)return null;const l=new Fe({name:o.name,pathname:o.pathname,title:o.title,query:i,animation:(d=o.options)==null?void 0:d.animation,parent:null});if(this.views[n]=l,this.ensureParent(l),!l.parent)return;this.$router.href=l.href,this.$router.name=l.name;const h=this.stacks[this.stacks.length-1];h&&((m=h.parent)==null||m.removeView(h,{reason:"show_sibling",callback:()=>{delete this.views[n]}})),this.stacks[this.stacks.length-1]=l,l.parent.showView(l),this.emit(1,{reason:"replace",view:l,name:l.name,href:l.href,pathname:l.pathname,query:l.query}),this.emit(5,{...this.state})}realBack(){var o;const e=this.cursor-1,i=this.stacks[e];if(!i)return;const n=i.href;if(!i.parent)return;this.$router.href=n,this.$router.name=i.name,this.cursor=e;const a=this.stacks.slice(e+1);for(let l=0;l<a.length;l+=1){const h=a[l];(o=h.parent)==null||o.removeView(h,{reason:"back",destroy:!0,callback:()=>{delete this.views[h.href]}})}i.parent.showView(i,{reason:"back",destroy:!0}),this.emit(1,{reason:"back",view:i,name:i.name,href:i.href,pathname:i.pathname,query:i.query}),this.emit(3),this.emit(5,{...this.state})}back(){}forward(){var o;const e=this.cursor+1,i=this.stacks[e];if(!i||!i.parent)return;const n=i.href;this.$router.href=n,this.$router.name=i.name,this.cursor=e;const a=this.stacks.slice(e+1);for(let l=0;l<a.length;l+=1){const h=a[l];(o=h.parent)==null||o.removeView(h,{reason:"forward",callback:()=>{delete this.views[h.href]}})}i.parent.showView(i),this.emit(1,{reason:"forward",view:i,name:i.name,href:i.href,pathname:i.pathname,query:i.query}),this.emit(4),this.emit(5,{...this.state})}reload(){}ensureParent(e){const{name:i}=e;if(e.parent){if(e.parent.pathname==="/")return;this.ensureParent(e.parent);return}const n=this.routes[i];if(!n)return;const{parent:a}=n;if(this.views[a.name]){if(e.parent=this.views[a.name],a.name==="root")return;this.ensureParent(this.views[a.name]);return}const o=this.routes[a.name];if(!o)return null;const l=new Fe({name:o.name,pathname:o.pathname,title:o.title,parent:null});this.views[o.name]=l,e.parent=l,this.ensureParent(l)}buildURL(e,i={}){const n=(()=>{const o=this.routes[e];return o||null})();return n?new Fe({name:n.name,pathname:n.pathname,title:n.title,query:i,parent:null}).buildUrl(i):this.routes["root.notfound"].pathname}buildURLWithPrefix(e,i={}){const n=(()=>{const o=this.routes[e];return o||null})();return n?new Fe({name:n.name,pathname:n.pathname,title:n.title,query:i,parent:null}).buildUrlWithPrefix(i):this.routes["root.notfound"].pathname}isLayout(e){const i=this.routes[e];return i?i.layout:null}handleClickLink(e){const{href:i,target:n}=e;this.emit(2,{href:i,target:n})}onTopViewChange(e){return this.on(0,e)}onRouteChange(e){return this.on(1,e)}onBack(e){return this.on(3,e)}onForward(e){return this.on(4,e)}onClickLink(e){return this.on(2,e)}onStateChange(e){return this.on(5,e)}}function Cr(s){const r=globalThis.document;s.getComputedStyle=w=>window.getComputedStyle(w),s.setTitle=w=>{document.title=w},s.copy=w=>{const p=document.createElement("textarea");p.value=w,document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p)},window.addEventListener("DOMContentLoaded",()=>{const{innerWidth:w,innerHeight:p}=window;s.setSize({width:w,height:p})}),window.addEventListener("orientationchange",function(){s.handleScreenOrientationChange(window.orientation)}),window.addEventListener("load",()=>{}),window.addEventListener("beforeunload",w=>{}),window.addEventListener("resize",()=>{}),window.addEventListener("blur",()=>{s.emit(s.Events.Blur)}),document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="hidden"){s.emit(s.Events.Hidden);return}s.emit(s.Events.Show)});const e=navigator.userAgent,i=e.toLowerCase(),n=/iPad|iPhone|iPod/.test(e),a=/Android/.test(e);s.setEnv({wechat:i.indexOf("micromessenger")!==-1,ios:n,android:a,pc:!n&&!a});const o=window.matchMedia(Qt);let l="light";const h=w=>{w||(w=window.matchMedia(Qt));const j=w.matches?"dark":"light";return l=j,s.theme=j,v.Ok(j)};o.addListener(h);let u="data-theme";const d="system",m=["light","dark"];s.applyTheme=w=>{const p=document.documentElement,j=l;j?p.setAttribute(u,j):p.removeAttribute(u);const y=m.includes(d)?d:null,k=m.includes(l)?l:y;return p.style.colorScheme=k,v.Ok(null)},s.getSystemTheme=h,s.setTheme=w=>{s.theme=w,s.emit(s.Events.StateChange,{...s.state}),s.$storage.set("theme",w)};const{availHeight:f,availWidth:x}=window.screen;if(window.navigator.userAgent.match(/iphone/i)){const w=["375-812","414-896","428-926","390-844","393-852","430-932"].includes(`${x}-${f}`);s.safeArea=!!w}r.addEventListener("keydown",w=>{const{key:p}=w;s.keydown({key:p})});const g=r.body.style.pointerEvents;s.disablePointer=()=>{r.body.style.pointerEvents="none"},s.enablePointer=()=>{r.body.style.pointerEvents=g}}const $r=globalThis.document;function _r(s){s.reload=()=>{window.location.reload()},s.back=()=>{window.history.back()},s.$router.onPopState(r=>{const{type:e,pathname:i,href:n}=r;if(e==="back"){s.realBack();return}if(e==="forward"){s.forward();return}}),s.$router.onPushState(({from:r,to:e,path:i,pathname:n})=>{window.history.pushState({from:r,to:e},"",i)}),s.$router.onReplaceState(({from:r,path:e,pathname:i})=>{window.history.replaceState({from:r},"",e)}),$r.addEventListener("click",r=>{let e=r.target;if(e instanceof Document||e===null)return;let i=!1;for(;e;){const o=e;if(o.tagName==="A"){i=!0;break}e=o.parentNode}if(!i)return;const n=e,a=n.getAttribute("href");a&&a.startsWith("/")&&(a.startsWith("http")||n.getAttribute("target")!=="_blank"&&(r.preventDefault(),s.handleClickLink({href:a,target:null})))}),window.addEventListener("popstate",r=>{var a;const{type:e}=r,{pathname:i,href:n}=window.location;s.$router.handlePopState({type:e,href:n,pathname:(a=r.state)==null?void 0:a.to})})}var Oe=(s=>(s[s.Pending=0]="Pending",s[s.Loading=1]="Loading",s[s.Loaded=2]="Loaded",s[s.Failed=3]="Failed",s))(Oe||{});let es="";class Xe extends q{constructor(e){super();c(this,"unique_uid");c(this,"src");c(this,"width");c(this,"height");c(this,"scale",null);c(this,"fit");c(this,"step",0);c(this,"realSrc");const{unique_id:i,width:n=200,height:a=200,src:o,scale:l,fit:h="cover"}=e;this.width=n,this.height=a,this.src="",this.fit=h,this.realSrc=o,l&&(this.scale=l),i&&(this.unique_uid=i)}static url(e){return e?e.includes("http")?e:es+e:""}static setPrefix(e){es=e}get state(){return{src:this.src,step:this.step,width:this.width,height:this.height,scale:this.scale}}updateSrc(e){this.realSrc=e,this.handleShow()}handleShow(){if(!this.realSrc){this.step=3,this.emit(0,{...this.state});return}this.step=1,this.src=Xe.url(this.realSrc),this.emit(0,{...this.state})}handleLoaded(){this.step=2,this.emit(2),this.emit(0,{...this.state})}handleError(){this.step=3,this.emit(0,{...this.state}),this.emit(3)}onStateChange(e){return this.on(0,e)}onStartLoad(e){return this.on(1,e)}onLoad(e){return this.on(2,e)}onError(e){return this.on(3,e)}}class ve extends q{constructor(e={}){super(e);c(this,"btns",[]);c(this,"cur",null);c(this,"scale",null);const{scale:i}=e;i&&(this.scale=i)}bind(e){const i=this.btns.find(a=>a.unique_uid===e);if(i)return i;const n=new Xe({src:e,scale:this.scale||void 0});return this.btns.push(n),n}select(e){const i=this.btns.find(n=>n.unique_uid===e);i&&(this.cur=i)}clear(){this.cur=null}onStateChange(e){this.on(0,e)}}class Tr extends q{constructor(e={}){super(e);c(this,"headers",{});c(this,"debug",!1);const{headers:i={},debug:n=!1}=e;this.headers=i,this.debug=n}async get(e,i,n={}){try{const o={url:[e,i?"?"+Te(i):""].join(""),method:"GET",id:n.id,headers:{...this.headers,...n.headers||{}}};this.debug;const l=await this.fetch(o);return v.Ok(l.data)}catch(a){const o=a,{message:l}=o;return v.Err(l)}}async post(e,i,n={}){const a=[e].join("");try{const o={url:a,method:"POST",data:i,id:n.id,headers:{...this.headers,...n.headers||{}}};this.debug;const l=await this.fetch(o);return v.Ok(l.data)}catch(o){const l=o,{message:h}=l;return v.Err(h)}}async fetch(e){return{data:{}}}cancel(e){const i="请在 connect 中实现 cancel 方法";return v.Err(i)}setHeaders(e){this.headers=e}appendHeaders(e){this.headers={...this.headers,...e}}setDebug(e){this.debug=e}onStateChange(e){return this.on(0,e)}}function Pr(s){let r=[];s.fetch=async e=>{const{url:i,method:n,id:a,data:o,headers:l,timeout:h=6e3}=e,u=lt.CancelToken.source();if(a&&r.push({id:a,source:u}),n==="GET")try{const d=await lt.get(i,{params:o,headers:l,cancelToken:u.token,timeout:h});return r=r.filter(m=>m.id!==a),d}catch(d){throw r=r.filter(m=>m.id!==a),d}if(n==="POST")try{const d=await lt.post(i,o,{headers:l,timeout:h,cancelToken:u.token});return r=r.filter(m=>m.id!==a),d}catch(d){throw r=r.filter(m=>m.id!==a),d}return Promise.reject("unknown method")},s.cancel=e=>{const i=r.find(n=>n.id===e);return i?(r=r.filter(n=>n.id!==e),i.source.cancel("主动取消"),v.Ok(null)):v.Err("没有找到对应请求")}}const Ee=new Tr({headers:{"client-version":Es}});Pr(Ee);var Ce=(s=>(s.LD="LD",s.SD="SD",s.HD="HD",s.FHD="FHD",s.QHD="QHD",s))(Ce||{});const bt={LD:"标清",SD:"普清",HD:"高清",FHD:"4K",QHD:"超高清"};class Rr extends q{constructor(e){super(e);c(this,"key");c(this,"values");c(this,"defaultValues");c(this,"client");c(this,"set",Ke(100,(e,i)=>{const n={...this.values,[e]:i};this.values=n,this.client.setItem(this.key,JSON.stringify(this.values)),this.emit(0,{...this.state})}));c(this,"merge",(e,i,n={})=>{const a=this.get(e)||{};if(Array.isArray(a)){let o=n.reverse?[...i,...a]:[...a,...i];return n.limit&&(o=o.slice(0,n.limit)),this.set(e,o),o}if(typeof a=="object"&&typeof i=="object"){const o={...a,...i};return this.set(e,o),o}return a});const{key:i,client:n,defaultValues:a,values:o}=e;this.key=i,this.values=Ls(o,a),this.defaultValues=a,this.client=n}get state(){return{values:this.values}}get(e,i){const n=this.values[e];if(n===void 0){if(i)return i[e];throw new Error("the default value no existing")}return n}clear(e){if(this.values[e]===void 0)return null;this.values={...this.values,[e]:this.defaultValues[e]},this.client.setItem(this.key,JSON.stringify(this.values)),this.emit(0,{...this.state})}onStateChange(e){return this.on(0,e)}}const Lr={user:{id:"",username:"anonymous",email:"",token:"",avatar:""},theme:"system",player_settings:{rate:1,volume:.5,type:Ce.HD,skip:{}},token_id:"",tv_search:{language:[]},movie_search:{language:[]},media_search_histories:[],dialog_flags:{}},Os="m_global",Er=globalThis.localStorage.getItem(Os),Me=new Rr({key:Os,defaultValues:Lr,values:(()=>{const s=JSON.parse(Er||"{}");if(s.media_search_histories&&s.media_search_histories.length&&typeof s.media_search_histories[0]=="string"){const i=K("2024/03/20").valueOf();s.media_search_histories=s.media_search_histories.map((n,a)=>({text:n,sort:i+a}))}const r=s.media_search_histories?s.media_search_histories.sort((e,i)=>i.sort-e.sort):[];return{...s,media_search_histories:r}})(),client:globalThis.localStorage}),Mr={root:{title:"ROOT",pathname:"/",children:{home_layout:{title:"首页布局",pathname:"/home",options:{keep_alive:!0,require:["login"]},children:{home_index:{title:"首页",pathname:"/home/index",children:{home_index_season:{title:"电视剧",pathname:"/home/index/season"},home_index_movie:{title:"电影",pathname:"/home/index/movie"},home_index_recommended:{title:"推荐",pathname:"/home/index/recommended"},home_index_history:{title:"播放历史",pathname:"/home/index/history"}},options:{keep_alive:!0,require:["login"]}}}},season_playing:{title:"播放电视剧",pathname:"/season_play",options:{keep_alive:!0,animation:{in:"fade-in",out:"fade-out"},require:["login"]}},movie_playing:{title:"播放电影",pathname:"/movie_play",options:{keep_alive:!0,animation:{in:"fade-in",out:"fade-out"},require:["login"]}},history_updated:{title:"我的",pathname:"/home/updated_history",options:{keep_alive:!0,animation:{in:"slide-in-from-right",out:"slide-out-to-right"},require:["login"]}},search:{title:"搜索",pathname:"/search",options:{animation:{},require:["login"]}},invitee:{title:"好友",pathname:"/invitee",options:{keep_alive:!0,animation:{in:"slide-in-from-right",out:"slide-out-to-right"},require:["login"]}},messages:{title:"消息",pathname:"/home/message",options:{keep_alive:!0,animation:{in:"slide-in-from-right",out:"slide-out-to-right"},require:["login"]}},mine:{title:"我的",pathname:"/mine/index",options:{keep_alive:!0,animation:{in:"slide-in-from-right",out:"slide-out-to-right"},require:["login"]}},update_mine_profile:{title:"修改邮箱密码",pathname:"/mine/patch",options:{keep_alive:!0,animation:{in:"slide-in-from-right",out:"slide-out-to-right"},require:["login"]}},invitation_code:{title:"邀请码",pathname:"/code",options:{keep_alive:!0,animation:{in:"slide-in-from-right",out:"slide-out-to-right"},require:["login"]}},help:{title:"帮助中心",pathname:"/help",options:{keep_alive:!0,animation:{in:"slide-in-from-right",out:"slide-out-to-right"}}},login:{title:"登录",pathname:"/login",options:{keep_alive:!0}},register:{title:"注册",pathname:"/register",options:{keep_alive:!0}},scan:{title:"登录",pathname:"/scan",options:{keep_alive:!0,require:["login"]}},test:{title:"测试",pathname:"/test"},notfound:{title:"404",pathname:"/notfound"}}}},Vs=wr(Mr),Fr=Vs.routes,Us=Vs.routesWithPathname;fr(s=>{s.onFailed(r=>{X.tip({text:[r.message]}),r.code===900&&W.push("root.login")}),s.client||(s.client=Ee)});Pe.prefix="/mobile";Xe.setPrefix(window.location.origin);window.location.hostname==="media-t.funzm.com"&&A.setEnv("dev");const yt=new Pe;class Ir extends Bs{say(){}}const ue=new Ir(Me.get("user"),Ee),Nt=new Fe({name:"root",pathname:"/",title:"ROOT",visible:!0,parent:null,views:[]});Nt.isRoot=!0;const W=new kr({view:Nt,router:yt,routes:Fr,views:{root:Nt}}),X=new mr({user:ue,storage:Me,async beforeReady(){var i,n;const{pathname:s,query:r}=W.$router,e=Us[s];return e?(n=(i=e.options)==null?void 0:i.require)!=null&&n.includes("login")?(await ue.loginWithTokenId({token:yt.query.token,tmp:Number(yt.query.tmp)}),ue.isLogin?(Ee.appendHeaders({Authorization:ue.token}),A.appendHeaders({Authorization:ue.token}),he.init(),W.isLayout(e.name)?(W.push("root.home_layout.home_index.home_index_season",{language:Y.CN},{ignore:!0}),v.Ok(null)):(W.push(e.name,r,{ignore:!0}),v.Ok(null))):(X.tip({text:["请先登录"]}),W.push("root.login",{redirect:e.pathname}),v.Err("need login"))):W.isLayout(e.name)?v.Err("can't goto layout"):(W.push(e.name,r,{ignore:!0}),v.Ok(null)):(W.push("root.notfound"),v.Err("not found"))}});Cr(X);_r(W);X.env.ios&&(W.back=()=>{W.realBack()});W.onClickLink(({href:s,target:r})=>{const{pathname:e,query:i}=Pe.parse(s),n=Us[e];if(!n){X.tip({text:["没有匹配的页面"]});return}if(r==="_blank"){const a=W.buildURLWithPrefix(n.name,i);window.open(a);return}W.push(n.name,i)});W.onRouteChange(({reason:s,view:r,href:e,ignore:i})=>{const{title:n}=r;X.setTitle(n),!i&&(X.env.ios||(s==="push"&&W.$router.pushState(e),s==="replace"&&W.$router.replaceState(e)))});ue.onLogin(s=>{Ee.appendHeaders({Authorization:ue.token}),A.appendHeaders({Authorization:ue.token}),Me.set("user",s)});ue.onLogout(()=>{Me.clear("user"),A.deleteHeaders("Authorization"),W.push("root.login")});ue.onExpired(()=>{Me.clear("user"),X.tip({text:["token 已过期，请重新登录"]}),W.push("root.login")});ue.onTip(s=>{X.tip(s)});ue.onNeedUpdate(()=>{X.tipUpdate()});const he=new ie(new F(tr,{process:sr,client:Ee}),{search:{status:1}});ie.commonProcessor=s=>{if(s===null)return{dataSource:[],page:1,pageSize:20,total:0,noMore:!1,empty:!1,error:null};try{const r=s.data||s,{list:e,page:i,page_size:n,total:a,noMore:o,no_more:l,next_marker:h}=r,u={dataSource:e,page:i,pageSize:n,total:a,empty:!1,noMore:!1,error:null,next_marker:h};return a<=n*i&&(u.noMore=!0),l!==void 0&&(u.noMore=l),o!==void 0&&(u.noMore=o),h===null&&(u.noMore=!0),e.length===0&&i===1&&(u.empty=!0),u}catch(r){return{dataSource:[],page:1,pageSize:20,total:0,noMore:!1,empty:!1,error:new Error(`${r.message}`)}}};const M=L.memo(s=>{const{when:r,fallback:e=null,children:i}=s;return r?t.jsx(t.Fragment,{children:i}):t.jsx(t.Fragment,{children:e})});function D(s){const r=N.useRef(!1);N.useState(()=>{r.current||(r.current=!0,s())})}function Dr(s){N.useEffect(()=>{s()},[])}function H(s){return N.useMemo(()=>s(),[])}const Lt=L.memo(s=>{const{store:r,index:e}=s;N.useRef(null);const[i,n]=N.useState(r.$presence.state);return D(()=>{r.$presence.onStateChange(a=>{n(a)}),r.ready()}),N.useEffect(()=>{if(!r.mounted)return r.setShow(),()=>{r.setUnmounted(),r.destroy()}},[]),t.jsx(t.Fragment,{children:t.jsx(M,{when:i.mounted,children:t.jsx("div",{className:_(s.className,i.enter&&r.animation.in?`animate-in ${r.animation.in}`:"",i.exit&&r.animation.out?`animate-out ${r.animation.out}`:""),style:{zIndex:e,display:i.visible?"block":"none"},"data-title":r.title,"data-href":r.href,children:s.children})})})});class qe extends q{constructor(e){super(e);c(this,"app");c(this,"defaultIcon");c(this,"defaultText");c(this,"icon");c(this,"text");c(this,"pathname");c(this,"badge",!1);c(this,"active",!1);c(this,"clickForScrollToTop",!1);c(this,"clickForRefresh",!0);c(this,"pendingState",null);c(this,"disable",()=>{this.clickForScrollToTop=!1,this.clickForRefresh=!1,this.icon=this.defaultIcon,this.text=this.defaultText,this.emit(0,{...this.state})});c(this,"setCanRefresh",()=>{this.clickForRefresh||(this.clickForRefresh=!0,this.update())});c(this,"setCanTop",e=>{if(this.clickForScrollToTop)return;const{icon:i,text:n}=e;this.icon=i,this.text=n,this.clickForScrollToTop=!0,this.update()});c(this,"update",Ke(200,()=>{this.active&&this.emit(0,{...this.state})}));const{app:i,icon:n,text:a,pathname:o}=e;this.app=i,this.defaultIcon=n,this.defaultText=a,this.icon=n,this.text=a,this.pathname=o}get state(){return{icon:this.icon,text:this.text,active:this.active,badge:this.badge}}select(){if(!this.active){if(this.active=!0,this.pendingState){const{icon:e,text:i,clickForScrollToTop:n,clickForRefresh:a}=this.pendingState;this.icon=e,this.text=i,this.clickForScrollToTop=n,this.clickForRefresh=a}this.emit(0,{...this.state})}}hide(){this.active&&(this.pendingState={icon:this.icon,text:this.text,active:this.active,badge:this.badge,clickForScrollToTop:this.clickForScrollToTop,clickForRefresh:this.clickForRefresh},this.icon=this.defaultIcon,this.text=this.defaultText,this.active=!1,this.clickForScrollToTop=!1,this.clickForRefresh=!0,this.emit(0,{...this.state}))}setIcon(e){this.icon=e,this.emit(0,{...this.state})}setText(e){this.text=e,this.emit(0,{...this.state})}handleClick(){if(this.active){if(this.clickForScrollToTop){this.emit(2);return}if(this.clickForRefresh){this.emit(1);return}return}}onStateChange(e){return this.on(0,e)}onScrollToTop(e){return this.on(2,e)}onRefresh(e){return this.on(1,e)}}const zr=L.memo(s=>{const{app:r,history:e,client:i,storage:n,pages:a,view:o}=s,l=H(()=>new qe({app:r,icon:t.jsx(gi,{className:"w-6 h-6"}),pathname:"root.home_layout.home_index",text:"首页"})),h=H(()=>new qe({app:r,icon:t.jsx(gs,{className:"w-6 h-6"}),pathname:"root.home_layout.home_index.home_index_season",text:"电视剧"})),u=H(()=>new qe({app:r,icon:t.jsx(wi,{className:"w-6 h-6"}),pathname:"root.home_layout.home_index.home_index_movie",text:"电影"})),d=H(()=>new qe({app:r,icon:t.jsx(vi,{className:"w-6 h-6"}),pathname:"root.home_layout.home_index.home_index_history",text:"观看记录"})),m=H(()=>new qe({app:r,icon:t.jsx(ws,{className:"w-6 h-6"}),pathname:"root.mine",text:"我的"})),[f,x]=N.useState(o.subViews),g=[l,h,u,d,m];return D(()=>{function w(p){const j=g.find(k=>k.pathname===p);if(!j)return;const y=g.filter(k=>k.pathname!==p);for(let k=0;k<y.length;k+=1)y[k].hide();j.select()}w(o.name),o.onSubViewsChange(p=>{x(p)})}),t.jsx(t.Fragment,{children:t.jsx("div",{className:"relative z-90 w-full h-full",children:f.map((w,p)=>{const j=w.name,y=a[j];return t.jsx(Lt,{className:"absolute left-0 top-0 w-full h-full",store:w,index:p,children:t.jsx("div",{className:_("w-full h-full scrollbar-hide overflow-y-auto bg-w-bg-3 opacity-100 scroll scroll--hidden",r.env.android?"scroll--fix":""),children:t.jsx(y,{app:r,history:e,client:i,storage:n,pages:a,view:w})})},w.id)})})})}),Hr={updated_history:{priority:100,interval:"daily"}};function qr(s){const r=K().valueOf(),e=Br(s);if(!e)return!1;const{interval:i}=e;if(i==="always")return!0;const n=(()=>{const a=Me.get("dialog_flags")[s];return a?a.show_at:null})();if(!n)return!0;if(i==="daily"){const a=[K(r).clone().startOf("day"),K(r).clone().endOf("day")];return!(K(n).clone().isAfter(a[0])&&K(n).clone().isBefore(a[1]))}if(i==="hourly"){const a=[K(r).clone().startOf("hour"),K(r).clone().endOf("hour")];return!(K(n).clone().isAfter(a[0])&&K(n).clone().isBefore(a[1]))}return!1}function Ar(s){const r=K().valueOf();Me.merge("dialog_flags",{[s]:{show_at:r}})}function Br(s){const r=Hr[s];return r||null}const Or=Ct("active:scale-95 inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:opacity-50 dark:focus:ring-slate-400 disabled:pointer-events-none dark:focus:ring-offset-slate-900 data-[state=open]:bg-slate-100 dark:data-[state=open]:bg-slate-800",{variants:{variant:{default:"bg-w-brand text-white",destructive:"bg-red-500 text-white hover:bg-red-600 dark:hover:bg-red-600",outline:"bg-transparent border border-slate-200 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-100",subtle:"bg-w-fg-5 text-w-fg-0",ghost:"bg-transparent hover:bg-slate-100 dark:hover:bg-slate-800 dark:text-slate-100 dark:hover:text-slate-100 data-[state=open]:bg-transparent dark:data-[state=open]:bg-transparent",link:"bg-transparent dark:bg-transparent underline-offset-4 hover:underline text-slate-900 dark:text-slate-100 hover:bg-transparent dark:hover:bg-transparent"},size:{default:"py-2 px-4",sm:"px-2 text-sm rounded-md",lg:"py-2 px-8 text-md font-normal rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),le=L.memo(s=>{const{store:r,variant:e,size:i}=s,[n,a]=N.useState(r.state);D(()=>{r.onStateChange(u=>{a(u)})});const{disabled:o,loading:l}=n,h=Or({variant:e,size:i,class:_(s.className,"w-full space-x-2")});return t.jsxs("button",{className:h,role:"button",disabled:o,onClick:u=>{u.preventDefault(),r.click()},children:[t.jsx(M,{when:l,children:t.jsx(J,{className:"w-4 h-4 mr-2 animation animate-spin"})}),(()=>s.children?s.children:n.text?n.text:"确定")()]})});le.displayName="Button";function Vr(s,r){s.focus=()=>{r.focus()}}const ee=s=>{const{store:r,prefix:e,focus:i}=s,n=N.useRef(null),[a,o]=N.useState(r.state);N.useEffect(()=>{const p=n.current;p&&(Vr(r,p),(i||r.autoFocus)&&p.focus(),r.setMounted())},[]),D(()=>{r.onStateChange(p=>{o(p)})});const{loading:l,value:h,placeholder:u,disabled:d,allowClear:m,autoComplete:f,autoFocus:x,type:g,tmpType:w}=a;return t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute left-3 top-[50%] translate-y-[-50%] text-w-fg-1",children:(()=>e?l?t.jsx(ze,{className:"w-5 h-5 animate-spin"}):e:null)()}),t.jsx("input",{ref:n,className:_("flex items-center h-10 w-full rounded-md leading-none border border-w-bg-2 bg-w-bg-3 text-w-fg-0 py-2 px-3 text-sm","focus:outline-none focus:ring-2 focus:ring-fg-4 focus:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","placeholder:text-w-fg-1",e?"pl-10":"",s.className),style:{verticalAlign:"bottom"},value:h,placeholder:u,disabled:d,type:w||g,autoComplete:f?"on":"new-password",autoFocus:x,autoCorrect:"false",onChange:p=>{const{value:j}=p.target;r.change(j)},onKeyDown:p=>{p.key==="Enter"&&r.handleEnter()},onBlur:()=>{r.handleBlur()}}),t.jsx("div",{className:"absolute right-3 top-[50%] translate-y-[-50%]",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[(()=>!m||!h?null:t.jsx("div",{className:"p-1 rounded-full bg-w-fg-2 text-w-bg-0",onClick:p=>{p.stopPropagation(),r.clear(),r.focus()},children:t.jsx($t,{className:"w-2 h-2"})}))(),(()=>g!=="password"?null:w?t.jsx("div",{className:"text-w-fg-2",onClick:p=>{p.stopPropagation(),r.hideText()},children:t.jsx(ji,{className:"w-4 h-4"})}):t.jsx("div",{className:"text-w-fg-2",onClick:p=>{p.stopPropagation(),r.showText()},children:t.jsx(bi,{className:"w-4 h-4"})}))()]})})]})};ee.displayName="Input";const ce=L.memo(s=>{const{store:r,enterClassName:e,exitClassName:i}=s,[n,a]=N.useState(r.state);D(()=>{r.onStateChange(u=>a(u))});const{visible:o,mounted:l,text:h}=n;return t.jsx(M,{when:l,children:t.jsx("div",{className:_("presence",n.enter&&e?e:"",n.exit&&i?i:"",s.className),role:"presentation",style:{display:o?"block":"none"},children:s.children})})});function Et(s){return yi.createPortal(t.jsx("div",{className:"portal",children:s.children}),document.body)}const Ws=L.memo(s=>t.jsx(t.Fragment,{children:s.children})),Gs=L.memo(s=>{const{store:r}=s;return t.jsx(ce,{store:r.$present,children:t.jsx(Et,{children:t.jsx("div",{className:s.className,children:s.children})})})}),Ys=L.memo(s=>{const{store:r}=s,[e,i]=N.useState(r.state);return D(()=>{r.onStateChange(n=>{i(n)})}),t.jsx("div",{"data-state":Mt(e.open),className:_(s.className),onClick:()=>{r.hide()}})}),Ks=L.memo(s=>{const{store:r}=s,[e,i]=N.useState(r.state);return D(()=>{r.onStateChange(n=>{i(n)})}),t.jsx("div",{className:_(s.className),"data-state":Mt(e.open),children:s.children})}),Ur=L.memo(s=>t.jsx("div",{className:s.className,...s})),Wr=L.memo(s=>{const{store:r}=s,[e,i]=N.useState(r.state);return D(()=>{r.onStateChange(n=>{i(n)})}),t.jsxs("div",{className:s.className,"data-state":Mt(e.open),onClick:()=>{s.store.hide()},children:[s.children,t.jsx("span",{className:"sr-only",children:"Close"})]})}),Gr=L.memo(s=>t.jsx("div",{className:_(s.className),children:s.children})),Yr=L.memo(s=>t.jsx("div",{className:_(s.className),children:s.children})),Kr=L.memo(s=>t.jsx("div",{className:_(s.className),children:s.children})),Xr=L.memo(s=>{const{store:r}=s;return t.jsx(le,{variant:"default",store:r.okBtn,children:s.children})}),Jr=L.memo(s=>{const{store:r}=s;return t.jsx(le,{variant:"subtle",className:s.className,store:r.cancelBtn,children:s.children})});function Mt(s){return s?"open":"closed"}const G=L.memo(s=>{const{store:r}=s,[e,i]=N.useState(r.state),[n,a]=N.useState(r.$present.state);D(()=>{r.onStateChange(u=>i(u)),r.$present.onStateChange(u=>a(u))});const{title:o,footer:l,cancel:h}=e;return t.jsx(Ws,{store:r,children:t.jsxs(Gs,{store:r,className:"fixed inset-0 z-50 flex items-start justify-center sm:items-center",children:[t.jsx(Ys,{store:r,className:_("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm","transition-all duration-200",n.enter?"animate-in fade-in":"",n.exit?"animate-out fade-out":"")}),t.jsxs(Ks,{store:r,className:_("fixed left-[50%] top-[30%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 sm:rounded-lg md:w-full","bg-w-bg-0 border-w-bg-2",n.enter?"animate-in fade-in-0 zoom-in-95 slide-in-from-left-1/2 slide-in-from-top-[48%]":"",n.exit?"animate-out fade-out-0 zoom-out-95 slide-out-to-left-1/2 slide-out-to-top-[48%]":""),children:[t.jsxs(Gr,{className:"flex flex-col space-y-1.5 text-center sm:text-left",children:[t.jsx(Kr,{className:_("text-lg text-w-fg-0 font-semibold leading-none tracking-tight"),children:o}),t.jsx(Ur,{className:_("text-sm text-muted-foreground"),children:s.children})]}),t.jsx(M,{when:!!l,children:t.jsxs(Yr,{className:_("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2"),children:[t.jsx(M,{when:!!h,children:t.jsx(Jr,{className:"mt-2",store:r,children:"取消"})}),t.jsx(Xr,{store:r})]})}),t.jsx(Wr,{store:r,className:_("absolute top-4 right-4 cursor-pointer rounded-full","opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:pointer-events-none","dark:focus:ring-slate-400 dark:focus:ring-offset-black-900","data-[state=open]:bg-w-bg-0",n.enter?"animate-in bg-w-bg-0":"",(n.exit,"")),children:t.jsx($t,{width:15,height:15})})]})]})})});function ts(s){return s.touches?{x:s.touches[0].pageX,y:s.touches[0].pageY}:s.clientX&&s.clientY?{x:s.clientX,y:s.clientY}:{x:0,y:0}}function Ve(s){s&&s.cancelable&&!s.defaultPrevented&&s.preventDefault&&s.preventDefault()}function Qr(s,r){let e=Math.abs(s);return e=.82231*r/(1+4338.47/Math.pow(e,1.14791)),Math.round(s<0?-e:e)}function Zr(s,r){const e=Math.abs(s.x-r.x),i=Math.abs(s.y-r.y),n=Math.sqrt(e*e+i*i);return n!==0?Math.asin(i/n)/Math.PI*180:0}const ss="enable-hardware";function en(s,r){function e(u){s.handlePointDown(u);const d=s.getScrollTop();s.os.pc&&d<=0&&(r.addEventListener("mousemove",s.handleMouseMove,{passive:!1}),document.ondragstart=function(){return!1})}function i(){s.handleTouchEnd(),s.os.pc&&(r.removeEventListener("mousemove",s.handleMouseMove),document.ondragstart=function(){return!0})}r.addEventListener("touchstart",e),r.addEventListener("touchmove",s.handleTouchMove,{passive:!1}),r.addEventListener("touchend",i),r.addEventListener("touchcancel",i),r.addEventListener("mousedown",e),r.addEventListener("mouseup",i),r.addEventListener("mouseleave",i),r.addEventListener("scroll",s.handleScrolling);let n=!1;s.optimizeScroll=u=>{u&&n===!1&&(r.classList.add(ss),r.style.webkitOverflowScrolling="auto",n=!0),u===!1&&n&&(r.style.webkitOverflowScrolling="touch",r.classList.remove(ss),n=!1)};let a=0,o=0;function l(u){let d=u.currentTarget,m=!0;for(;d&&d!==document.body&&d!==document;){const w=d.classList;if(w){if(w.contains("mescroll")||w.contains("mescroll-touch")){m=!1;break}else if(w.contains("mescroll-touch-x")||w.contains("mescroll-touch-y")){var f=u.touches?u.touches[0].pageX:0,x=u.touches?u.touches[0].pageY:0;a||(a=f),o||(o=x);const p=Math.abs(a-f),j=Math.abs(o-x),y=Math.sqrt(p*p+j*j);if(a=f,o=x,y!==0){var g=Math.asin(j/y)/Math.PI*180;if(g<=45&&w.contains("mescroll-touch-x")||g>45&&w.contains("mescroll-touch-y")){m=!1;break}}}}d=d.parentNode}m&&Ve(u)}s.refreshRect=()=>{const{scrollHeight:u}=r;s.setRect({contentHeight:u})},s.setBounce=u=>{s.os.ios&&(u===!1?window.addEventListener("touchmove",l,{passive:!1}):window.removeEventListener("touchmove",l))},s.setScrollTop=u=>{r.scrollTop=u},s.getScrollTop=()=>r.scrollTop,s.getScrollClientHeight=()=>r.clientHeight,s.getScrollHeight=()=>r.scrollHeight,s.getBodyHeight=()=>document.body.clientHeight||document.documentElement.clientHeight,s.getOffsetTop=u=>{let d=u.offsetTop,m=u.offsetParent;for(;m&&m!==r;)d+=m.offsetTop+m.clientTop,m=m.offsetParent;return d};function h(u,d,m,f=300,x=30){const g=d-u;if(f===0||g===0){m&&m(d);return}const w=f/x,p=g/w;let j=0;const y=window.setInterval(()=>{j<w-1?(u+=p,m&&m(u,y),j++):(m&&m(d,y),window.clearInterval(y))},x)}s.scrollTo=(u,d)=>{const{top:m=0}=u,f=s.getScrollTop();let x=m;if(x>0){const g=s.getScrollHeight()-s.getScrollClientHeight();x>g&&(x=g)}else x=0;s.isScrollTo=!0,r.style.overflow="hidden",h(f,x,g=>{s.setScrollTop(g),g===x&&(r.style.overflow="auto",s.isScrollTo=!1)},d)},s.destroy=()=>{r.removeEventListener("touchstart",e),r.removeEventListener("touchmove",s.handleTouchMove),r.removeEventListener("touchend",i),r.removeEventListener("touchcancel",i),r.removeEventListener("mousedown",e),r.removeEventListener("mousemove",s.handleMouseMove),r.removeEventListener("mouseup",i),r.removeEventListener("mouseleave",i),r.removeEventListener("scroll",s.handleScrolling),s.setBounce(!0)}}function tn(s,r){s.hideIndicator=()=>{r.innerHTML=""},s.changeIndicatorHeight=i=>{r.style.height=i+"px"};let e=!1;s.setIndicatorHeightTransition=i=>{i&&e===!1&&(r.style.transition="height 300ms",e=!0),!i&&e===!0&&(r.style.transition="unset",e=!1)}}const sn=L.memo(s=>{const{store:r,children:e,...i}=s,n=N.useRef(null);return N.useEffect(()=>{const a=n.current;if(a)return r.setRect({width:a.clientWidth,height:a.clientHeight}),r.setMounted(),en(r,a),()=>{r.destroy()}},[]),t.jsx("div",{ref:a=>{n.current=a},className:s.className,style:s.style,onClick:s.onClick,children:s.children})}),rn=L.memo(s=>{const{store:r}=s,e=N.useRef(null);return N.useEffect(()=>{const i=e.current;i&&(tn(r,i),r.needHideIndicator&&r.hideIndicator())},[]),t.jsx("div",{ref:i=>{e.current=i},className:s.className,style:{height:0},children:s.children})}),nn=L.memo(s=>{const{store:r}=s,e=N.useRef(null);return D(()=>{r.inDownOffset(()=>{e.current&&(e.current.style.display="block")}),r.onPullToRefresh(()=>{e.current&&(e.current.style.display="none")})}),t.jsx("div",{ref:e,className:s.className,children:s.children})}),an=L.memo(s=>{const{store:r}=s,e=N.useRef(null);return D(()=>{r.inDownOffset(()=>{e.current&&(e.current.style.display="none")}),r.onPullToRefresh(()=>{e.current&&(e.current.style.display="inline-block")})}),t.jsx("div",{ref:e,className:s.className,style:{display:"none"},children:s.children})}),se=L.memo(s=>{const{store:r,children:e,...i}=s,[n,a]=N.useState(!1);return D(()=>{r.inDownOffset(()=>{a(!1)}),r.outDownOffset(()=>{a(!0)})}),t.jsxs(sn,{className:_("scroll-view w-full h-full overflow-y-auto",s.className),style:s.style,store:r,onClick:i.onClick,children:[t.jsx(rn,{className:"relative w-full overflow-hidden text-center",store:r,children:t.jsxs("div",{className:"absolute left-0 bottom-0 w-full min-h-[30px] py-[10px]",children:[t.jsx(nn,{className:"w-[50px] h-[50px] mx-auto rounded-full bg-w-bg-0",store:r,children:t.jsx("div",{className:_("inline-flex justify-center items-center w-full h-full",n?"rotate-[180deg]":"rotate-[0deg]"),style:{transition:"all 300ms"},children:t.jsx(vs,{width:18,height:18})})}),t.jsx(an,{className:"w-[50px] h-[50px] mx-auto rounded-full bg-w-bg-0",store:r,children:t.jsx("div",{className:"inline-flex justify-center items-center w-full h-full",children:t.jsx(ze,{className:"animate animate-spin",width:18,height:18})})})]})}),s.children]})}),z=L.memo(s=>t.jsx("div",{className:_("animate-pulse w-full h-full rounded-md bg-w-fg-5",s.className)}));function on(s,r){const e=new IntersectionObserver(i=>{i.forEach(n=>{n.isIntersecting&&(r.handleShow(),e.unobserve(s))})},{threshold:.01});e.observe(s)}const be=L.memo(s=>{const{store:r}=s,e=N.useRef(null),[i,n]=N.useState(r.state);return D(()=>{r.onStateChange(a=>{n(a)})}),N.useEffect(()=>{e.current&&on(e.current,r)},[]),t.jsx("div",{ref:e,className:_(s.className,"flex items-center justify-center bg-w-bg-0"),children:(()=>i.step===Oe.Failed?t.jsx(Ni,{className:"w-8 h-8 text-w-fg-2"}):i.step===Oe.Pending?t.jsx(Si,{className:"w-8 h-8 text-w-fg-2"}):[Oe.Loading,Oe.Loaded].includes(i.step)?t.jsx("img",{className:s.className,style:(()=>{const a={objectFit:i.fit};return i.scale&&(a.transform=`scale(${i.scale})`),a})(),src:i.src,alt:i.alt,onError:()=>{r.handleError()}}):null)()})});function ln(s){const{visible:r,onClick:e}=s;return t.jsx("div",{className:_("z-100 fixed right-4 bottom-28",r?"block":"hidden"),style:{zIndex:100},children:t.jsx("div",{className:"flex items-center justify-center w-[64px] h-[64px] rounded-full bg-w-bg-0 opacity-100",onClick:e,children:t.jsx(js,{className:"w-6 h-6"})})})}const cn=L.memo(s=>{const{label:r,store:e}=s,[i,n]=N.useState(e.state);return D(()=>{e.onStateChange(a=>{n(a)})}),t.jsx("div",{className:_("flex justify-center items-center py-1 px-2 mb-2 rounded-lg text-w-fg-1 border border-w-fg-1 leading-none",i.checked?"bg-w-bg-active text-w-fg-1":""),onClick:()=>{e.toggle()},children:t.jsx("div",{className:"text-sm leading-tight",children:r})})}),is=s=>{const{store:r}=s,[e,i]=N.useState(r.state);return D(()=>{r.onStateChange(n=>{i(n)})}),t.jsx("div",{className:"flex flex-wrap space-x-2",children:e.options.map(n=>{const{label:a,value:o,core:l}=n;return t.jsx(cn,{store:l,label:a},a)})})};class xe extends q{constructor(e={}){super(e);c(this,"value",null);const{value:i,onChange:n}=e;i&&(this.value=i),n&&this.onChange(n)}get state(){return this.value}select(e){this.value=e,this.emit(1),this.emit(0,this.value)}patch(e){this.value={...this.value,...e},this.emit(1),this.emit(0,this.value)}isEmpty(){return this.value===null}clear(){this.value=null,this.emit(1),this.emit(0)}onChange(e){return this.on(1,e)}onStateChange(e){return this.on(0,e)}}class te extends q{constructor(e={}){super(e);c(this,"id",this.uid());c(this,"cur");c(this,"state",{loading:!1,disabled:!1,text:"确定"});this.cur=new xe;const{onClick:i}=e;i&&this.onClick(()=>{i(this.cur.value)})}click(){this.state.loading||this.state.disabled||this.emit(0)}disable(){this.state.disabled=!0,this.emit(1,{...this.state})}enable(){this.state.disabled=!1,this.emit(1,{...this.state})}bind(e){return this.cur.select(e),this}setLoading(e){this.state.loading!==e&&(this.state.loading=e,this.emit(1,{...this.state}))}setText(e){this.state.text=e,this.emit(1,{...this.state})}onClick(e){this.on(0,e)}onStateChange(e){this.on(1,e)}}class rs extends q{constructor(e={}){super(e);c(this,"$presence");c(this,"label");c(this,"disabled");c(this,"checked");c(this,"prevChecked",!1);const{label:i="",disabled:n=!1,checked:a=!1,onChange:o}=e;this.label=i,this.disabled=n,this.checked=a,this.$presence=new Z,o&&this.onChange(o)}get state(){return{label:this.label,checked:this.checked,disabled:this.disabled}}toggle(){const e=this.checked;(()=>{if(e){this.$presence.hide();return}this.$presence.show()})(),this.checked=!0,e&&(this.checked=!1),this.prevChecked=e,this.emit(1,this.checked),this.emit(0,{...this.state})}check(){this.checked!==!0&&(this.$presence.show(),this.prevChecked=this.checked,this.checked=!0,this.emit(0,{...this.state}))}uncheck(){this.checked!==!1&&(this.$presence.hide(),this.prevChecked=this.checked,this.checked=!1,this.emit(0,{...this.state}))}onChange(e){return this.on(1,e)}onStateChange(e){return this.on(0,e)}}class V extends q{constructor(e={}){super(e);c(this,"open",!1);c(this,"title","");c(this,"footer",!0);c(this,"showCancel",!0);c(this,"$present",new Z);c(this,"okBtn",new te);c(this,"cancelBtn",new te);const{title:i,footer:n=!0,cancel:a=!0,onOk:o,onCancel:l,onUnmounted:h}=e;i&&(this.title=i),this.footer=n,this.showCancel=a,o&&this.onOk(o),l&&this.onCancel(l),h&&this.onUnmounted(h),this.$present.onShow(async()=>{this.open=!0,this.emit(5,!0),this.emit(10,{...this.state})}),this.$present.onHidden(async()=>{this.open=!1,this.emit(6),this.emit(5,!1),this.emit(10,{...this.state})}),this.$present.onUnmounted(()=>{this.emit(4)}),this.okBtn.onClick(()=>{this.ok()}),this.cancelBtn.onClick(()=>{this.hide()})}get state(){return{open:this.open,title:this.title,footer:this.footer,cancel:this.showCancel}}show(){this.open||this.$present.show()}hide(){this.open!==!1&&this.$present.hide()}ok(){this.emit(7)}cancel(){this.emit(6)}setTitle(e){this.title=e,this.emit(10,{...this.state})}onShow(e){return this.on(1,e)}onHidden(e){return this.on(3,e)}onUnmounted(e){return this.on(4,e)}onVisibleChange(e){return this.on(5,e)}onOk(e){return this.on(7,e)}onCancel(e){return this.on(6,e)}onStateChange(e){return this.on(10,e)}get[Symbol.toStringTag](){return"Dialog"}}class re extends q{constructor(e={}){super(e);c(this,"_defaultValue","");c(this,"value","");c(this,"placeholder");c(this,"disabled");c(this,"allowClear",!0);c(this,"autoComplete",!1);c(this,"autoFocus",!1);c(this,"type");c(this,"loading",!1);c(this,"valueUsed","");c(this,"tmpType","");c(this,"setMounted",()=>{this.emit(2)});c(this,"handleEnter",()=>{this.valueUsed=this.value,this.emit(5,this.value)});c(this,"handleBlur",()=>{this.value!==this.valueUsed&&(this.valueUsed=this.value,this.emit(4,this.value))});c(this,"setLoading",e=>{this.loading=e,this.emit(1,{...this.state})});c(this,"focus",()=>{});c(this,"change",e=>{this.value=e,this.emit(0,e),this.emit(1,{...this.state})});c(this,"enable",()=>{this.disabled=!0,this.emit(1,{...this.state})});c(this,"disable",()=>{this.disabled=!1,this.emit(1,{...this.state})});c(this,"showText",()=>{this.tmpType="text",this.emit(1,{...this.state})});c(this,"hideText",()=>{this.tmpType="",this.emit(1,{...this.state})});c(this,"clear",()=>{this.value=this._defaultValue,this.emit(6),this.emit(1,{...this.state})});c(this,"reset",()=>{this.value=this._defaultValue,this.emit(1,{...this.state})});c(this,"enter",()=>{this.emit(5)});c(this,"onChange",e=>this.on(0,e));c(this,"onStateChange",e=>this.on(1,e));c(this,"onMounted",e=>this.on(2,e));c(this,"onFocus",e=>this.on(3,e));c(this,"onBlur",e=>this.on(4,e));c(this,"onEnter",e=>this.on(5,e));c(this,"onClear",e=>this.on(6,e));const{_name:i,defaultValue:n,placeholder:a="请输入",type:o="string",disabled:l=!1,autoFocus:h=!1,autoComplete:u=!1,onChange:d,onBlur:m,onEnter:f,onClear:x,onMounted:g}=e;i&&(this._unique_id=i),this.placeholder=a,this.type=o,this.disabled=l,this.autoComplete=u,this.autoFocus=h,n&&(this._defaultValue=n),n&&(this.value=n),d&&this.onChange(d),f&&this.onEnter(()=>{f(this.value)}),m&&this.onBlur(m),x&&this.onClear(x),g&&this.onMounted(g)}get state(){return{value:this.value,placeholder:this.placeholder,disabled:this.disabled,loading:this.loading,type:this.type,tmpType:this.tmpType,autoComplete:this.autoComplete,autoFocus:this.autoFocus,allowClear:this.allowClear}}}class He extends q{constructor(e={}){super(e);c(this,"id",this.uid());c(this,"cur");c(this,"longPressTimer",null);c(this,"longPressing",!1);c(this,"rect",{width:0,height:0,scrollHeight:0});c(this,"canScroll",!1);c(this,"state",{loading:!1,disabled:!1});c(this,"pressTime",0);c(this,"handleMouseDown",()=>{this.pressTime=new Date().valueOf(),this.longPressTimer=setTimeout(()=>{this.longPressing=!0,this.emit(2)},600)});this.cur=new xe;const{onMounted:i,onClick:n,onLongPress:a,onLongPressFinish:o}=e;i&&this.onMounted(i),n&&this.onClick(()=>{n(this.cur.value)}),a&&this.onLongPress(()=>{a(this.cur.value)}),o&&this.onLongPressFinish(o)}clearLongPressTimer(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null)}handleMouseUp(e){this.longPressing&&this.emit(3),this.clearLongPressTimer()}handleMouseOut(){this.clearLongPressTimer()}handleClick(){this.click()}setMounted(){}setStyles(e){}click(){this.state.loading||this.state.disabled||this.emit(0)}disable(){this.state.disabled=!0,this.emit(5,{...this.state})}enable(){this.state.disabled=!1,this.emit(5,{...this.state})}setRect(e){this.rect=e,e.scrollHeight>e.height&&(this.canScroll=!0),this.emit(4,{canScroll:this.canScroll})}scrollTo(e){}bind(e){return this.cur.select(e),this}setLoading(e){this.state.loading!==e&&(this.state.loading=e,this.emit(5,{...this.state}))}onMounted(e){return this.on(4,e)}onClick(e){return this.on(0,e)}onLongPress(e){return this.on(2,e)}onLongPressFinish(e){return this.on(3,e)}onStateChange(e){return this.on(5,e)}}class hn extends q{constructor(e={}){super(e);c(this,"btns",[]);c(this,"cur",null);const{onClick:i,onLongPress:n}=e;i&&this.onClick(i),n&&this.onLongPress(n)}bind(e){const i=this.btns.find(a=>a.cur.value===e);if(i)return i;const n=new He({onClick:a=>{this.cur=n,this.emit(0,a)},onLongPress:a=>{this.cur=n,this.emit(2,a)}});return n.bind(e),this.btns.push(n),n}clear(){this.cur=null}setLoading(e){if(this.cur===null){for(let i=0;i<this.btns.length;i+=1)this.btns[i].setLoading(e);return}this.cur.setLoading(e)}onClick(e){return this.on(0,e)}onLongPress(e){return this.on(2,e)}onMounted(e){return this.on(4,e)}onStateChange(e){return this.on(5,e)}}class Q extends q{constructor(e){super(e);c(this,"os",{android:!0,ios:!1,pc:!1,wechat:!1});c(this,"rect",{width:0,height:0,scrollTop:0,contentHeight:0});c(this,"canPullToRefresh");c(this,"canReachBottom",!0);c(this,"needHideIndicator",!1);c(this,"scrollable",!0);c(this,"pullToRefresh",{step:"pending",pullStartX:0,pullStartY:0,pullMoveX:0,pullMoveY:0,distX:0,distY:0,distResisted:0});c(this,"threshold",120);c(this,"options");c(this,"pullToRefreshOptions");c(this,"isPullToRefreshing",!1);c(this,"isLoadingMore",!1);c(this,"startPoint",{x:0,y:0});c(this,"lastPoint",{x:0,y:0});c(this,"downHight",0);c(this,"upHight",0);c(this,"maxTouchMoveInstanceY",0);c(this,"inTouchEnd",!1);c(this,"inTopWhenPointDown",!1);c(this,"inBottomWhenPointDown",!1);c(this,"isMoveDown",!1);c(this,"isMoveUp",!1);c(this,"isScrollTo",!1);c(this,"movetype","pending");c(this,"preScrollY",0);c(this,"isUpAutoLoad",!1);c(this,"startPullToRefresh",()=>{this.isPullToRefreshing||(this.isPullToRefreshing=!0,this.downHight=this.pullToRefreshOptions.offset,this.setIndicatorHeightTransition(!0),this.changeIndicatorHeight(this.downHight),this.emit(3))});c(this,"finishPullToRefresh",()=>{this.isPullToRefreshing&&(this.downHight=0,this.changeIndicatorHeight(0),this.isPullToRefreshing=!1,this.emit(4))});c(this,"disablePullToRefresh",()=>{this.pullToRefreshOptions.isLock=!0});c(this,"enablePullToRefresh",()=>{this.pullToRefreshOptions.isLock=!1});c(this,"handleMouseDown",e=>{this.handlePointDown(e)});c(this,"handleMouseMove",e=>{this.handlePointMove(e)});c(this,"handleTouchStart",e=>{this.handlePointDown(e)});c(this,"handleTouchMove",e=>{this.handlePointMove(e)});c(this,"handlePointDown",e=>{this.isScrollTo&&Ve(e);const i=ts(e);if(i.x<36){Ve(e);return}this.startPoint=i,this.lastPoint=this.startPoint,this.maxTouchMoveInstanceY=this.getBodyHeight()-this.pullToRefreshOptions.bottomOffset,this.inTouchEnd=!1;const n=this.getScrollTop();this.inTopWhenPointDown=n===0});c(this,"handlePointMove",e=>{if(this.startPoint.x<=36)return;const i=this.getScrollTop();i>0&&(this.inTopWhenPointDown=!1);const n=ts(e),a=n.y-this.startPoint.y;if(a>0&&i<=0&&(Ve(e),this.canPullToRefresh&&!this.inTouchEnd&&!this.isPullToRefreshing)){if(!this.inTopWhenPointDown)return;const o=Zr(this.lastPoint,n);if(o&&o<this.pullToRefreshOptions.minAngle)return;if(this.maxTouchMoveInstanceY>0&&n.y>=this.maxTouchMoveInstanceY){this.inTouchEnd=!0,this.handleTouchEnd();return}this.downHight<this.pullToRefreshOptions.offset?this.movetype!=="pulling"&&(this.movetype==="pending"&&(this.setIndicatorHeightTransition(!1),this.os.ios&&!this.inTopWhenPointDown&&this.optimizeScroll(!0)),this.movetype,this.movetype="pulling",this.emit(0),this.isMoveDown=!0):this.movetype!=="releasing"&&(this.movetype="releasing",this.emit(1),this.isMoveDown=!0),this.downHight=Qr(n.y-this.startPoint.y,1e3),this.changeIndicatorHeight(this.downHight),this.emit(2,{instance:this.downHight})}if(a<0){const o=this.getScrollHeight(),l=this.getScrollClientHeight();o-l-i<=0&&Ve(e)}this.lastPoint=n});c(this,"handleTouchEnd",()=>{this.startPoint={x:0,y:0},this.canPullToRefresh&&this.isMoveDown&&(this.downHight>=this.pullToRefreshOptions.offset?this.startPullToRefresh():(this.downHight=0,this.setIndicatorHeightTransition(!0),this.changeIndicatorHeight(0)),this.optimizeScroll(!1),this.movetype="pending",this.isMoveDown=!1)});c(this,"handleScrolling",()=>{const e=this.getScrollTop(),i=e-this.preScrollY>0;this.isLoadingMore||this.getScrollHeight()-this.getScrollClientHeight()-e<=this.threshold&&i&&(this.isLoadingMore=!0,this.emit(8)),this.emit(7,{scrollTop:e})});c(this,"setBounce",e=>{});c(this,"hideIndicator",()=>{});c(this,"scrollTo",(e,i=300)=>{});c(this,"destroy",()=>{});const{os:i,offset:n=80,onScroll:a,onReachBottom:o,onPullToRefresh:l,onPullToBack:h}=e;this.options=e,i&&(this.os=i),this.pullToRefreshOptions={isLock:!1,offset:n,bottomOffset:20,minAngle:45},this.canPullToRefresh=!!l,this.canPullToRefresh||(this.needHideIndicator=!0),this.needHideIndicator&&(this.pullToRefreshOptions.offset=9999),a&&this.onScroll(a),o&&this.onReachBottom(o),l&&this.onPullToRefresh(l)}get state(){return{top:0,left:0,step:this.movetype,scrollTop:this.downHight,pullToRefresh:this.canPullToRefresh,scrollable:this.scrollable}}setReady(){this.emit(9)}setRect(e){this.rect={...this.rect,...e}}finishLoadingMore(){this.isLoadingMore=!1}setMounted(){this.emit(9)}refreshRect(){}changeIndicatorHeight(e){}setIndicatorHeightTransition(e){}optimizeScroll(e){}getToBottom(){return this.getScrollHeight()-this.getScrollClientHeight()-this.getScrollTop()}getOffsetTop(e){return 0}getScrollHeight(){return 0}getScrollClientHeight(){return 0}getScrollTop(){return 0}setScrollTop(e){}getBodyHeight(){return 0}inDownOffset(e){return this.on(0,e)}outDownOffset(e){return this.on(1,e)}onPulling(e){return this.on(2,e)}onScroll(e){return this.on(7,e)}onReachBottom(e){return this.on(8,e)}onPullToRefresh(e){return this.canPullToRefresh=!0,this.on(3,e)}onMounted(e){return this.on(9,e)}}class un extends q{constructor(e={}){super(e);c(this,"_unique_id","ToastCore");c(this,"delay",1200);c(this,"timer",null);c(this,"open",!1);c(this,"$present");c(this,"state",{icon:null,texts:[]});const{delay:i}=e;i&&(this.delay=i),this.$present=new Z,this.$present.onShow(()=>{this.open=!0,this.emit(4,!0)}),this.$present.onHidden(()=>{this.open=!1,this.emit(4,!1)})}async show(e){const{icon:i,texts:n}=e;if(this.state.icon=i,this.state.texts=n,this.emit(7,{...this.state}),this.timer!==null){this.clearTimer(),this.timer=setTimeout(()=>{this.hide(),this.clearTimer()},this.delay);return}this.$present.show(),this.timer=setTimeout(()=>{this.hide(),this.clearTimer()},this.delay)}clearTimer(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}hide(){this.$present.hide({destroy:!0})}onShow(e){return this.on(1,e)}onHide(e){return this.on(3,e)}onOpenChange(e){return this.on(4,e)}onStateChange(e){return this.on(7,e)}get[Symbol.toStringTag](){return"ToastCore"}}class ns extends q{constructor(e={}){super(e);c(this,"options",[]);c(this,"disabled");c(this,"values",[]);c(this,"prevChecked",!1);const{values:i,options:n=[],disabled:a=!1,onChange:o}=e;i&&(this.values=i),this.disabled=a;const l={label:"全部",value:"__all__",core:new rs({label:"全部",checked:!1,disabled:!1,onChange:h=>{if(h){this.values=[];const u=this.options.filter(d=>d.value==="__all__"?!1:d.core.state.checked);for(let d=0;d<u.length;d+=1)u[d].core.uncheck();this.emit(1,[...this.values]),this.emit(0,{...this.state});return}}})};this.options=n.map(h=>{const{label:u,value:d,checked:m,disabled:f}=h,x=new rs({label:u,checked:m,disabled:f,onChange:g=>{const w=this.values.includes(d);if(g&&!w){l.core.checked&&l.core.uncheck(),this.checkOption(d);return}!g&&w&&this.uncheckOption(d)}});return{label:u,value:d,core:x}}),this.options=[l].concat(this.options),o&&this.onChange(o)}get indeterminate(){return this.values.length===this.options.length}get state(){return{values:this.values,options:this.options,disabled:this.disabled,indeterminate:this.indeterminate}}checkOption(e){this.values=this.values.concat(e),this.emit(1,[...this.values]),this.emit(0,{...this.state})}uncheckOption(e){this.values=this.values.filter(i=>i!==e),this.emit(1,[...this.values]),this.emit(0,{...this.state})}reset(){this.values=[],this.emit(1,[...this.values]),this.emit(0,{...this.state})}onChange(e){return this.on(1,e)}onStateChange(e){return this.on(0,e)}}const me=L.memo(s=>{var u,d;const{store:r,skeleton:e=null,extraEmpty:i=null,extraNoMore:n,onRefresh:a}=s,[o,l]=N.useState(r.response),h=H(()=>new te({async onClick(){a&&a()}}));return D(()=>{r.onStateChange(m=>{l(m)})}),t.jsxs("div",{className:_("relative text-w-fg-1",s.wrapClassName),children:[t.jsx(M,{when:!!(o.initial&&e),children:t.jsx("div",{className:s.className,children:e})}),t.jsx(M,{when:!o.empty,fallback:t.jsx("div",{className:"w-full h-[240px] flex items-center justify-center",children:t.jsxs("div",{className:"flex flex-col items-center justify-center",children:[t.jsx(Re,{className:"w-24 h-24"}),t.jsxs("div",{className:"mt-4 flex items-center space-x-2",children:[t.jsx(M,{when:o.loading,children:t.jsx(J,{className:"w-6 h-6 animate-spin"})}),t.jsx("div",{className:"text-xl",children:o.loading?"加载中":"列表为空"})]}),i]})}),children:t.jsx("div",{className:s.className,children:s.children})}),t.jsx(M,{when:!!o.error,fallback:t.jsx(M,{when:!o.noMore&&!o.initial,children:t.jsx("div",{className:"flex justify-center py-8",children:t.jsxs("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>{r.loadMore()},children:[t.jsx(M,{when:o.loading,fallback:t.jsx(vs,{className:"w-6 h-6"}),children:t.jsx(J,{className:"w-6 h-6 animate-spin"})}),t.jsx("div",{className:"text-center",children:o.loading?"加载中":"加载更多"})]})})}),children:t.jsx("div",{className:"w-full h-[240px] flex items-center justify-center py-24",children:t.jsxs("div",{className:"flex flex-col items-center justify-center px-8",children:[t.jsx(ki,{className:"w-24 h-24"}),t.jsx("div",{className:"mt-4 flex items-center space-x-2",children:t.jsx("div",{className:"text-center text-xl",children:(u=o.error)==null?void 0:u.message})}),t.jsx(M,{when:!!((d=o.error)!=null&&d.message.includes("timestamp check failed")),children:t.jsx(le,{store:h,variant:"subtle",size:"sm",className:"mt-4 py-8 px-4",children:"点击刷新"})})]})})}),t.jsx(M,{when:o.noMore&&!o.empty,children:t.jsxs("div",{className:"py-8",children:[t.jsx("div",{className:"flex justify-center",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(M,{when:o.loading,children:t.jsx(J,{className:"w-6 h-6 animate-spin"})}),t.jsx("div",{className:"text-center",children:"没有数据了"})]})}),n]})})]})}),dn=s=>t.jsx(t.Fragment,{children:s.children}),mn=s=>{const{store:r}=s;return t.jsx(Et,{children:t.jsx(ce,{store:r.$present,children:s.children})})},fn=s=>t.jsx("div",{className:"fixed z-[99] left-[50%] translate-x-[-50%] top-60 w-120 h-120 ",children:t.jsx("div",{className:_(s.className),children:s.children})}),pn=L.memo(s=>{const{store:r}=s,[e,i]=N.useState(r.state),[n,a]=N.useState(r.$present.state);D(()=>{r.onStateChange(l=>{i(l)}),r.$present.onStateChange(l=>a(l))});const{texts:o}=e;return t.jsx(dn,{store:r,children:t.jsx(mn,{store:r,className:_(n.enter?"animate-in fade-in":"",n.exit?"animate-out fade-out":""),children:t.jsx(fn,{store:r,className:_("grid gap-4 rounded-lg bg-w-bg-4 text-w-bg-0 dark:text-w-fg-0 p-6 duration-200 sm:max-w-lg sm:rounded-lg",n.enter?"animate-in fade-in sm:zoom-in-90":"",n.exit?"animate-out fade-out":""),children:o.map((l,h)=>t.jsx("div",{className:"text-center",children:l},h))})})})}),xn=Ct("fixed z-50 scale-100 gap-4 bg-w-bg-2 text-w-fg-0 opacity-100",{variants:{position:{top:"w-full duration-300",bottom:"w-full duration-300",left:"h-full duration-300",right:"h-full duration-300"},size:{content:"",default:"",sm:"",lg:"",xl:"",full:""}},compoundVariants:[{position:["top","bottom"],size:"content",class:"max-h-screen"},{position:["top","bottom"],size:"default",class:"h-1/3"},{position:["top","bottom"],size:"sm",class:"h-1/4"},{position:["top","bottom"],size:"lg",class:"h-1/2"},{position:["top","bottom"],size:"xl",class:"h-5/6"},{position:["top","bottom"],size:"full",class:"h-screen"},{position:["right","left"],size:"content",class:"max-w-screen"},{position:["right","left"],size:"default",class:"w-1/3"},{position:["right","left"],size:"sm",class:"w-1/4"},{position:["right","left"],size:"lg",class:"w-1/2"},{position:["right","left"],size:"xl",class:"w-5/6"},{position:["right","left"],size:"full",class:"w-screen"}],defaultVariants:{position:"right",size:"default"}}),gn=Ct("fixed inset-0 z-50 flex",{variants:{position:{top:"items-start",bottom:"items-end",left:"justify-start",right:"justify-end"}},defaultVariants:{position:"right"}}),Ge=L.memo(s=>{const{store:r,size:e="lg",hideTitle:i}=s;return t.jsx(wn,{store:r,children:t.jsx(bn,{store:r,hideTitle:i,position:"bottom",size:e,children:s.children})})}),wn=Ws,vn=s=>t.jsx(Gs,{store:s.store,className:_(s.className),children:t.jsx("div",{className:gn({position:s.position}),children:s.children})}),jn=s=>{const{store:r}=s,[e,i]=N.useState(r.$present.state);return D(()=>{r.$present.onStateChange(n=>i(n))}),t.jsx(Ys,{store:r,className:_("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm transition-all duration-200",e.enter?"animate-in fade-in":"",e.exit?"animate-out fade-out":"",s.className),onClick:()=>{r.hide()}})},bn=s=>{const{className:r,store:e,position:i,size:n,hideTitle:a,children:o}=s,[l,h]=N.useState(e.$present.state);return D(()=>{e.$present.onStateChange(u=>h(u))}),t.jsxs(vn,{store:e,position:i,children:[t.jsx(jn,{store:e}),t.jsxs(Ks,{store:e,className:_(xn({position:i,size:n}),"duration-200",l.enter?"animate-in slide-in-from-bottom":"",l.exit?"animate-out slide-out-to-bottom":"",r),children:[t.jsx(M,{when:!a,children:t.jsx(yn,{className:"flex absolute -top-14 w-full",children:t.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",onClick:()=>{e.hide()},children:t.jsx($t,{className:"w-5 h-5 text-w-fg-1"})})})}),o]})]})},yn=({className:s,...r})=>t.jsx("div",{className:_("flex flex-col h-14 rounded-tl-xl rounded-tr-xl bg-w-bg-2 border-b border-w-bg-3 text-center sm:text-left",s),...r});function Nn(s,r){r.scrollTo=n=>{s.scrollTo({top:n.top})},r.setStyles=n=>{s.style.cssText=n};const{width:e,height:i}=s.getBoundingClientRect();r.setRect({width:e,height:i,scrollHeight:s.scrollHeight}),s.addEventListener("click",()=>{r.handleClick()}),r.setMounted()}const at=L.memo(s=>{const{store:r}=s,[e,i]=N.useState(r.state),n=N.useRef(null);return D(()=>{r.onStateChange(a=>{i(a)})}),N.useEffect(()=>{n.current&&Nn(n.current,r)},[]),t.jsx("div",{ref:n,className:s.className,style:s.style,onClick:a=>{r.longPressing&&(a.preventDefault(),a.stopPropagation()),r.longPressing=!1},onTouchStart:()=>{r.handleMouseDown()},onTouchEnd:a=>{r.handleMouseUp({type:"touch end",stopPropagation(){a.stopPropagation()}}),r.longPressing=!1},onMouseDown:()=>{r.handleMouseDown()},onMouseUp:a=>{r.handleMouseUp({type:"mouse up",stopPropagation(){a.stopPropagation()}})},onMouseOut:()=>{r.handleMouseOut()},children:s.children})}),Sn="modulepreload",kn=function(s){return"/mobile/"+s},as={},Cn=function(r,e,i){if(!e||e.length===0)return r();const n=document.getElementsByTagName("link");return Promise.all(e.map(a=>{if(a=kn(a),a in as)return;as[a]=!0;const o=a.endsWith(".css"),l=o?'[rel="stylesheet"]':"";if(!!i)for(let d=n.length-1;d>=0;d--){const m=n[d];if(m.href===a&&(!o||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${l}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":Sn,o||(u.as="script",u.crossOrigin=""),u.href=a,document.head.appendChild(u),o)return new Promise((d,m)=>{u.addEventListener("load",d),u.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>r())};function $n(s,r){s.onloadstart=()=>{r.handleStartLoad()},s.onloadedmetadata=function(e){const i=this.videoWidth,n=this.videoHeight;r.handleLoadedmetadata({width:i,height:n,duration:s.duration})},s.onload=()=>{r.handleLoad()},s.oncanplay=e=>{r.handleCanPlay({duration:s.duration})},s.onplay=()=>{r.handlePlay()},s.onplaying=()=>{r.handlePlaying()},s.ontimeupdate=e=>{const{currentTime:i,duration:n}=e.currentTarget;r.handleTimeUpdate({currentTime:i,duration:n})},s.onpause=e=>{const{currentTime:i,duration:n}=e.currentTarget;r.handlePause({currentTime:i,duration:n})},s.onwaiting=()=>{},s.onended=()=>{r.handleEnded()},s.onvolumechange=e=>{const{volume:i}=e.currentTarget,n=i;r._curVolume!==n&&r.handleVolumeChange(n)},s.onresize=()=>{const{videoHeight:e,videoWidth:i}=s;r.handleResize({width:i,height:e})},s.onerror=e=>{const i=(()=>{var a,o;if(typeof e=="string")return new Error(e);const n=(o=(a=e.target)==null?void 0:a.error)==null?void 0:o.code;return n===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED?new Error("不支持的视频格式"):n===MediaError.MEDIA_ERR_DECODE?new Error("视频解码错误"):n===MediaError.MEDIA_ERR_ABORTED?new Error("视频加载中止"):new Error("unknown")})();r.handleError(i.message)},s.addEventListener("webkitstartfullscreen",()=>{r.handleFullscreenChange(!0)}),s.addEventListener("webkitendfullscreen",()=>{r.handleFullscreenChange(!1)}),r.bindAbstractNode({$node:s,async play(){try{await s.play()}catch{}},pause(){s.pause()},canPlayType(e){return!!s.canPlayType(e)},async load(e){if(s.canPlayType("application/vnd.apple.mpegurl")){s.src=e,s.load();return}const n=(await Cn(()=>import("./hls-d9890d2c.js").then(a=>a.h),[])).default;if(n.isSupported()&&e.includes("m3u8")){const a=new n({fragLoadingTimeOut:2e3});a.attachMedia(s),a.on(n.Events.MEDIA_ATTACHED,()=>{a.loadSource(e)});return}s.src=e,s.load()},setCurrentTime(e){s.currentTime=e},setVolume(e){s.volume=e},setRate(e){s.playbackRate=e},enableFullscreen(){s.removeAttribute("webkit-playsinline"),s.removeAttribute("playsinline")},disableFullscreen(){s.setAttribute("webkit-playsinline","true"),s.setAttribute("playsinline","true")},requestFullscreen(){s.requestFullscreen&&s.requestFullscreen(),s.webkitRequestFullscreen&&s.webkitRequestFullscreen(),s.mozRequestFullScreen&&s.mozRequestFullScreen(),s.msRequestFullscreen&&s.msRequestFullscreen()},exitFullscreen(){},showSubtitle(){s.textTracks[0]&&(s.textTracks[0].mode="showing")},hideSubtitle(){s.textTracks[0]&&(s.textTracks[0].mode="hidden")},showAirplay(){if(s.webkitShowPlaybackTargetPicker){s.webkitShowPlaybackTargetPicker();return}alert("AirPlay not supported.")},pictureInPicture(){if(s.webkitSetPresentationMode){s.webkitSetPresentationMode("picture-in-picture");return}alert("Picture-in-Picture not supported.")}})}const Ft=L.memo(s=>{const{store:r}=s,e=N.useRef(null),[i,n]=N.useState(r.state);D(()=>{r.onStateChange(m=>n(m))}),N.useEffect(()=>{const m=e.current;m!==null&&($n(m,r),r.setMounted())},[]);const{width:a,height:o,ready:l,poster:h,subtitle:u,prepareFullscreen:d}=i;return t.jsx("div",{className:"video transition-all",style:{width:a,overflow:"hidden"},onTouchStart:m=>{m.stopPropagation()},onTouchMove:m=>{m.stopPropagation()},onTouchEnd:m=>{m.stopPropagation()},children:t.jsx("video",{ref:e,className:"w-full relative z-10",controls:!1,"webkit-playsinline":d?void 0:"true",playsInline:!d,width:`${a}px`,height:`${o}px`,children:u?t.jsx("track",{src:u.src,kind:"captions",label:u.label,srcLang:u.lang}):null})})}),_n=L.memo(s=>{const{store:r}=s,[e,i]=N.useState(r.state),[n,a]=N.useState(r.left);D(()=>{r.onStateChange(h=>{i(h)}),r.onLinePositionChange(h=>{a(h.left)})});const{tabs:o,current:l}=e;return t.jsx("div",{className:_("__a tab-header w-full overflow-x-auto scroll--hidden"),onAnimationStart:h=>{const{width:u,height:d,left:m}=h.currentTarget.getBoundingClientRect();r.mounted||r.updateContainerClient({width:u,height:d,left:m})},children:t.jsxs("div",{className:"relative border-bottom border-w-bg-3",children:[t.jsx("div",{className:"flex pl-1",children:o.map((h,u)=>t.jsx("div",{className:_("__a py-2 px-4 break-keep text-md transition-all",l===u?"active-item-class":"",l===u?"text-w-fg-0":"text-w-fg-1"),onClick:()=>{r.select(u)},onAnimationEnd:d=>{if(d.stopPropagation(),r.mounted)return;const m=d.currentTarget;r.updateTabClient(u,{rect(){const{offsetLeft:f,clientWidth:x,clientHeight:g}=m;return{width:x,height:g,left:f}}})},children:h.text},u))}),t.jsx("div",{className:"absolute z-0 bottom-0 w-full h-[1px] bg-w-bg-3"}),n!==null?t.jsx("div",{className:"absolute z-10 bottom-0 w-4 bg-w-brand transition-all",style:{left:n,height:4,transform:"translateX(-50%)"}}):null]})})});class Tn extends q{constructor(e){super(e);c(this,"key");c(this,"tabs",[]);c(this,"count",0);c(this,"mounted",!1);c(this,"extra",{});c(this,"current",null);c(this,"left",null);c(this,"container",{width:0,left:0,scrollLeft:0});c(this,"targetLeftWhenSelected",null);const{key:i="id",options:n,targetLeftWhenSelected:a=0,onChange:o,onMounted:l}=e;this.key=i,this.targetLeftWhenSelected=a,this.tabs=n,o&&this.onChange(o),l&&this.onMounted(l)}get selectedTabId(){if(this.current===null)return null;const e=this.tabs[this.current];return e?e.id??null:this.tabs.length?this.tabs[0].id:null}get selectedTab(){return this.current===null?null:this.tabs[this.current]}get state(){return{tabs:this.tabs,curId:this.selectedTabId,current:this.current,left:this.targetLeftWhenSelected}}setTabs(e){if(e.length!==0){this.tabs=e;for(let i=0;i<e.length;i+=1){const{id:n}=e[i];this.extra[n]={rect(){return{left:0,width:0,height:0}}}}}}select(e){const i=this.tabs[e];if(!i)return;this.current=e;const n=this.calcLineLeft(this.current);n!==null&&(this.left=n,this.changeLinePosition(n)),this.emit(4,{...i,index:e}),this.emit(0,{...this.state})}selectById(e,i={}){const{ignore:n}=i,a=this.tabs.findIndex(h=>h.id===e);if(a===-1)return;const o=this.tabs[a];if(!o)return;this.current=a;const l=this.calcLineLeft(this.current);l!==null&&this.changeLinePosition(l),this.emit(0,{...this.state}),n||this.emit(4,{...o,index:a})}handleChangeById(e){const i=this.tabs.findIndex(a=>a.id===e);if(i===-1)return;this.current=i;const n=this.calcLineLeft(this.current);n!==null&&this.changeLinePosition(n)}calcLineLeft(e){const i=this.tabs[e];if(!i)return null;const n=this.extra[i.id].rect();return n.left+n.width/2}updateTabClient(e,i){const n=this.tabs[e];if(!n||(this.extra[n.id]=i,Object.keys(this.extra).length!==this.tabs.length))return;const a=this.calcLineLeft(0);a!==null&&this.changeLinePosition(a),this.mounted=!0,this.emit(3)}changeLinePosition(e){this.emit(2,{left:e})}updateTabClientById(e,i){const n=this.tabs.findIndex(o=>o.id===e);if(n===-1)return;const a=this.tabs[n];this.extra[a.id]=i}updateContainerClient(e){this.container={...this.container,...e}}calcScrollLeft(e){const{width:i,left:n}=this.container;if(e===null)return;const a=this.extra[e.id].rect(),o=a.left+a.width/2,l=(()=>this.targetLeftWhenSelected===null?0:this.targetLeftWhenSelected<=1?this.targetLeftWhenSelected*i:this.targetLeftWhenSelected)();if(o<=l){this.container.scrollLeft=0;return}const h=o-n-l;this.container.scrollLeft=h,this.emit(1,{left:h})}onScroll(e){return this.on(1,e)}onLinePositionChange(e){return this.on(2,e)}onChange(e){return this.on(4,e)}onMounted(e){return this.on(3,e)}onStateChange(e){return this.on(0,e)}}class Xs extends q{constructor(e){super(e);c(this,"height",0);c(this,"curTop",0);c(this,"targetTop",0);c(this,"fixed",!1);c(this,"needRegisterAgain",!0);c(this,"shouldFixed",!0);c(this,"mounted",!1);c(this,"style",{});c(this,"$node",null);c(this,"rect",()=>({top:0,height:0}));c(this,"setTop",Ci(0,e=>{this.$node}));const{top:i,defaultHeight:n=0,onMounted:a=null}=e;this.targetTop=i,this.height=n,a&&this.onMounted(a)}get state(){return{height:this.height,fixed:this.fixed,top:this.targetTop,style:this.style}}handleMounted(e){const{top:i,height:n}=e;this.curTop=i,this.height=n,i===this.targetTop&&this.fix(),this.mounted=!0,this.emit(2,{height:n})}handleScroll(e){const{scrollTop:i}=e,n=(()=>this.targetTop>=this.curTop||i+this.targetTop>=this.curTop)();this.shouldFixed=n,this.fixed!==n&&(this.fixed=n,this.emit(4,{...this.state}))}register(e){const{top:i,height:n}=e;this.curTop=i,this.mounted=!0,this.targetTop>=this.curTop&&(this.targetTop=this.curTop),this.height=n,this.emit(3)}registerAgain(){const{top:e,height:i}=this.rect();this.register({top:e,height:i})}setRect(e){this.rect=e}fix(){this.fixed||this.shouldFixed&&(this.fixed=!0,this.emit(0),this.emit(4,{...this.state}))}unfix(){this.fixed&&(this.fixed=!1,this.emit(1),this.emit(4,{...this.state}))}set(e){const{fixed:i,top:n,style:a}=e;i!==void 0&&(this.fixed=i),n!==void 0&&(this.targetTop=n),a!==void 0&&(this.style=a),this.emit(4,{...this.state})}onMounted(e){return this.on(2,e)}onSizeChange(e){return this.on(3,e)}onStateChange(e){return this.on(4,e)}}function Pn(s){const{app:r,history:e,client:i,storage:n,pages:a,view:o}=s,l=new Q({os:r.env,onScroll(g){h.handleScroll(g)}}),h=new Xs({top:0,defaultHeight:96}),u=new Tn({key:"id",options:[{id:"recommended",name:"root.home_layout.home_index.home_index_recommended",text:"推荐",query:{}},{id:"history",name:"root.home_layout.home_index.home_index_history",text:"观看记录",query:{}},{id:"china",name:"root.home_layout.home_index.home_index_season",text:"电视剧",query:{language:Y.CN}},{id:"movie",name:"root.home_layout.home_index.home_index_movie",text:"电影",query:{}},{id:"korean",name:"root.home_layout.home_index.home_index_season",text:"韩剧",query:{language:Y.KR}},{id:"jp",name:"root.home_layout.home_index.home_index_season",text:"日剧",query:{language:Y.JP}},{id:"us",name:"root.home_layout.home_index.home_index_season",text:"美剧",query:{language:Y.US}}],onChange(g){const{id:w,name:p,query:j={}}=g;e.push(p,{id:w,...j})}}),d=new re({placeholder:"请输入关键字搜索"}),m=new ve({}),f=new V({footer:!1}),x=new ie(new F(Is,{process:Ds,client:i}),{pageSize:5});return{$updatedMediaList:x,ui:{$scroll:l,$search:d,$tab:u,$image:m,$affix:h,$updatedMediaDialog:f},ready(){o.onShow(()=>{r.setTitle(o.title)}),e.onRouteChange(async({pathname:g,href:w,query:p})=>{u.mounted&&p.id&&(await ke(200),u.selectById(p.id))}),u.onMounted(()=>{e.$router.pathname,u.selectById("china")}),x.onStateChange(g=>{g.dataSource.length!==0&&qr("updated_history")&&(f.show(),Ar("updated_history"))}),x.init()}}}const Rn=L.memo(s=>{const{app:r,history:e,client:i,storage:n,pages:a,view:o,menu:l}=s,h=H(()=>Pn(s)),[u,d]=N.useState(o.subViews),[m,f]=N.useState(he.response),[x,g]=N.useState(h.$updatedMediaList.response),[w,p]=N.useState(h.ui.$affix.height);return D(()=>{o.onSubViewsChange(j=>{d(j)}),h.$updatedMediaList.onStateChange(j=>{g(j)}),h.ui.$scroll.onScroll(j=>{if(l){if(j.scrollTop>r.screen.height){l.setCanTop({icon:t.jsx(js,{className:"w-6 h-6"}),text:"回到顶部"});return}if(j.scrollTop===0){l.setCanRefresh();return}l.disable()}}),l&&(l.onScrollToTop(()=>{h.ui.$scroll.scrollTo({top:0})}),l.onRefresh(async()=>{h.ui.$scroll.startPullToRefresh()})),he.onStateChange(j=>{f(j)}),h.ready()}),t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"z-10",children:[t.jsxs("div",{className:"z-50 w-full bg-w-bg-0",children:[t.jsxs("div",{className:"flex items-center justify-between w-full py-2 px-4 text-w-fg-0 space-x-4",children:[t.jsxs("div",{className:"relative flex-1 w-0",children:[t.jsx(ee,{store:h.ui.$search,prefix:t.jsx(_t,{className:"w-5 h-5"})}),t.jsx("div",{className:"absolute z-10 inset-0",onClick:()=>{e.push("root.search")}})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"relative",onClick:()=>{e.push("root.messages")},children:[t.jsx($i,{className:"w-6 h-6"}),t.jsx(M,{when:!!m.total,children:t.jsx("div",{className:"absolute top-[-6px] right-0 px-[8px] h-[16px] rounded-xl break-all whitespace-nowrap text-[12px] border-w-bg-0 dark:border-w-fg-0 bg-w-red text-w-bg-0 dark:text-w-fg-0 translate-x-1/2",style:{lineHeight:"16px"},children:m.total})})]}),t.jsx("div",{className:"relative",onClick:()=>{e.push("root.mine")},children:t.jsx(ws,{className:"w-6 h-6"})})]})]}),t.jsx(_n,{store:h.ui.$tab})]}),t.jsx("div",{className:"absolute inset-0 flex flex-col",style:{top:w},children:u.map((j,y)=>{const k=j.name,b=a[k];return t.jsx(Lt,{className:"absolute inset-0",style:{zIndex:y},store:j,index:y,children:t.jsx(b,{app:r,history:e,storage:n,client:i,pages:a,view:j})},j.id)})})]}),t.jsx(Ge,{title:"有更新",store:h.ui.$updatedMediaDialog,size:"content",children:t.jsxs("div",{className:"px-4 pt-4 mb-4 flex w-full h-[280px] overflow-x-auto scroll--hidden safe-bottom",children:[x.dataSource.map(j=>{const{id:y,name:k,poster_path:b,latest_episode:P}=j;return t.jsxs("div",{className:"mr-2",onClick:()=>{e.push("root.season_playing",{id:y}),h.ui.$updatedMediaDialog.hide()},children:[t.jsx("div",{className:"w-[120px] h-[180px] rounded-md",children:t.jsx(be,{className:"w-full h-full rounded-md object-cover",store:h.ui.$image.bind(b),alt:k})}),t.jsxs("div",{className:"w-[120px] mt-2",children:[t.jsx("div",{className:"text-lg text-w-fg-1 truncate text-ellipsis",children:k}),t.jsx("div",{className:"",children:t.jsx("div",{className:"max-w-full text-w-fg-2 text-sm truncate text-ellipsis",children:t.jsx("div",{className:"",children:P.name})})})]})]},y)}),t.jsx("div",{className:"",onClick:()=>{e.push("root.history_updated"),h.ui.$updatedMediaDialog.hide()},children:t.jsx("div",{className:"flex items-center justify-center w-[120px] h-[180px] rounded-md bg-w-bg-1",children:t.jsxs("div",{className:"flex flex-col items-center justify-center text-w-fg-2",children:[t.jsx(_i,{className:"w-12 h-12"}),t.jsx("div",{className:"mt-1",children:"查看更多"})]})})})]})})]})}),de=L.memo(s=>{const{store:r,options:e}=s,[i,n]=N.useState(r.state);return D(()=>{r.onStateChange(a=>{n(a)})}),t.jsx("div",{className:s.className,children:(()=>{const a=e.find(o=>o.value===i.value);return a?a.content:null})()})});class st extends q{constructor(e){super(e);c(this,"unique_uid");c(this,"value");const{value:i,unique_id:n}=e;this.value=i,n&&(this.unique_uid=n)}get state(){return{value:this.value}}set(e){this.show(e)}show(e){this.value=e,this.emit(0,{...this.state})}onStateChange(e){return this.on(0,e)}}class we extends q{constructor(e){super(e);c(this,"btns",[]);c(this,"cur",null);c(this,"defaultValue");const{value:i}=e;this.defaultValue=i}bind(e){const i=this.btns.find(a=>a.unique_uid===e);if(i)return i;const n=new st({unique_id:e,value:this.defaultValue});return this.btns.push(n),n}clear(){this.cur=null}select(e){const i=this.btns.find(n=>n.unique_uid===e);i&&(this.cur=i)}set(e){this.cur!==null&&this.cur.show(e)}onStateChange(e){this.on(0,e)}}function Ln(s){const{app:r,client:e,history:i}=s,n=new F(ir,{client:e}),a=new F(rr,{client:e}),o=new st({value:1}),l=new Q({os:r.env,async onPullToRefresh(){await he.refresh(),l.finishPullToRefresh()},async onReachBottom(){await he.loadMore(),l.finishLoadingMore()}}),h=new ve;return{$read:n,$readAll:a,ui:{$scroll:l,$step:o,$poster:h},readMsg(u){const{id:d,media:m}=u;if(n.run({id:d}),he.modifyResponse(f=>({...f,dataSource:f.dataSource.map(x=>x.id===d?{...x,status:2}:x)})),m&&m.type===O.Season){i.push("root.season_playing",{id:m.id});return}if(m&&m.type===O.Movie){i.push("root.movie_playing",{id:m.id});return}r.tip({text:["未知的 media type"]})},readAllMsg(){he.modifyResponse(u=>({...u,dataSource:u.dataSource.map(d=>({...d,status:2})),total:0})),a.run(),o.show(0)}}}const En=L.memo(s=>{const{app:r,history:e,client:i,view:n}=s,a=H(()=>Ln(s)),[o,l]=N.useState(he.response),[h,u]=N.useState(56);return D(()=>{he.onStateChange(d=>l(d)),he.response.dataSource.length===0&&a.ui.$step.show(0)}),t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"z-50 w-full bg-w-bg-0",children:t.jsxs("div",{className:"flex items-center justify-between p-4",children:[t.jsx("div",{className:"flex items-center cursor-pointer",children:t.jsx("div",{className:"inline-block",onTouchEnd:()=>{e.back()},children:t.jsx(je,{className:"w-6 h-6"})})}),t.jsx("div",{className:"flex items-center",onClick:()=>{a.readAllMsg()},children:t.jsx(de,{store:a.ui.$step,options:[{value:0,content:null},{value:1,content:t.jsx(bs,{className:"w-6 h-6"})}]})})]})}),t.jsx(se,{store:a.ui.$scroll,className:"absolute bottom-0 left-0 w-full",style:{top:h},children:t.jsx("div",{className:"min-h-screen w-full px-4",children:t.jsx("div",{className:"overflow-hidden rounded-xl",children:t.jsx(me,{store:he,className:"divide-y divide-w-bg-0 dark:divide-gray-800",children:o.dataSource.map(d=>{const{id:m,msg:f,status:x,created:g,media:w}=d;return t.jsxs("div",{className:"relative py-6",onClick:()=>{a.readMsg(d)},children:[t.jsx("div",{className:"break-all",children:f}),t.jsx("div",{className:"",children:(()=>{if(w){const{name:p,poster_path:j}=w;return t.jsxs("div",{className:"flex mt-2",children:[t.jsx("div",{className:"relative w-[49px] h-[74px] mr-2",children:t.jsx(be,{className:"w-full h-full rounded-lg object-cover",store:a.ui.$poster.bind(j),alt:p})}),t.jsx("div",{className:"flex-1 max-w-full overflow-hidden",children:t.jsx("div",{className:"flex items-center",children:t.jsx("h2",{className:"text-lg",children:p})})})]})}return null})()}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"mt-2 text-sm",children:g}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"p-2",children:t.jsx(M,{when:x===2,fallback:t.jsx(Ti,{className:"w-4 h-4"}),children:t.jsx(_e,{className:"w-4 h-4"})})}),t.jsx("div",{className:"text-sm",children:x===2?"已读":"标记已读"})]})]}),t.jsx(M,{when:x===2,children:t.jsx("div",{className:"absolute inset-0 opacity-50 pointer-events-none"})})]},m)})})})})})]})});function Mn(s){const{app:r,client:e,history:i,storage:n}=s,a=new ie(new F(or,{process:lr,client:e}),{pageSize:10}),o=new Q({os:r.env,async onPullToRefresh(){await a.refresh(),o.finishPullToRefresh()}}),l=new ve;return{$list:a,ui:{$scroll:o,$poster:l},ready(){a.init()}}}const Fn=L.memo(s=>{const{app:r,client:e,history:i,storage:n}=s,a=H(()=>Mn(s)),[o,l]=N.useState(a.$list.response);return D(()=>{a.$list.onStateChange(h=>l(h)),a.ready()}),t.jsx(t.Fragment,{children:t.jsx(se,{className:"w-full h-full bg-w-bg-3",store:a.ui.$scroll,children:t.jsx(me,{store:a.$list,className:"relative space-y-3 bg-w-bg-3",skeleton:t.jsx(t.Fragment,{children:t.jsxs("div",{className:"py-2",children:[t.jsx("div",{className:"px-4",children:t.jsx(z,{className:"h-[32px] w-[188px]"})}),t.jsxs("div",{className:_("flex mt-2 px-4 space-x-3"),children:[t.jsxs("div",{children:[t.jsx("div",{className:"relative rounded-lg overflow-hidden",children:t.jsx(z,{className:"w-[138px] h-[192px] object-cover"})}),t.jsx(z,{className:"mt-2 h-[24px] w-[120px]"}),t.jsx(z,{className:"mt-1 h-[20px] w-[80px]"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"relative rounded-lg overflow-hidden",children:t.jsx(z,{className:"w-[138px] h-[192px] object-cover"})}),t.jsx(z,{className:"mt-2 h-[24px] w-[120px]"}),t.jsx(z,{className:"mt-1 h-[20px] w-[80px]"})]})]})]})}),children:(()=>o.dataSource.map(h=>{const{id:u,title:d,desc:m,medias:f}=h;return t.jsxs("div",{className:"pt-4 text-w-fg-0",children:[t.jsxs("div",{className:"px-4",children:[t.jsx("h2",{className:"text-xl",children:d}),m&&t.jsx("div",{className:"text-sm text-w-fg-1",children:m})]}),t.jsx("div",{className:_("flex pb-4 py-2 min-h-[248px] overflow-x-auto px-4 space-x-3 scroll scroll--hidden",r.env.android?"scroll--fix":""),children:(()=>f.length===0?t.jsx("div",{className:"flex items-center justify-center w-full h-full mt-[68px]",children:t.jsxs("div",{className:"flex flex-col items-center justify-center text-w-fg-1",children:[t.jsx(Re,{className:"w-16 h-16"}),t.jsx("div",{className:"mt-2",children:"暂无数据"})]})}):f.map(x=>{const{id:g,name:w,type:p,poster_path:j,text:y,air_date:k}=x;return t.jsx("div",{className:"w-[128px]",onClick:()=>{if(p===O.Season){i.push("root.season_playing",{id:g});return}if(p===O.Movie){i.push("root.movie_playing",{id:g});return}r.tip({text:["数据异常"]})},children:t.jsxs("div",{className:"w-[128px]",children:[t.jsxs("div",{className:"relative w-[128px] h-[192px] rounded-lg overflow-hidden",children:[t.jsx(be,{className:"w-full h-full object-cover",store:a.ui.$poster.bind(j),alt:w}),y&&t.jsxs("div",{className:"absolute w-full bottom-0 flex flex-row-reverse items-center",children:[t.jsx("div",{className:"absolute z-10 inset-0 opacity-80 bg-gradient-to-t to-transparent from-w-fg-0 dark:from-w-bg-0"}),t.jsx("div",{className:"relative z-20 p-2 pt-6 text-[12px] text-w-bg-1 dark:text-w-fg-1",children:y})]})]}),t.jsxs("div",{className:"mt-2 flex-1 max-w-full overflow-hidden",children:[t.jsx("div",{className:"flex items-center overflow-hidden text-ellipsis",children:t.jsx("h2",{className:"break-all truncate",children:w})}),t.jsx("div",{className:"flex items-center",children:t.jsx("div",{className:"text-sm text-w-fg-1",children:k})})]})]})},g)}))()})]},u)}))()})})})});function It(s){const{page:r,pageSize:e,...i}=s;return A.post("/api/v2/wechat/media/list",{...i,page:r,page_size:e})}function Dt(s){return s.error?v.Err(s.error):v.Ok({...s.data,list:s.data.list.map(r=>{const{id:e,type:i,name:n,original_name:a,overview:o,extra_text:l,poster_path:h,air_date:u,vote_average:d,genres:m,origin_country:f,actors:x=[]}=r;return{id:e,type:i,name:n||a,overview:o,poster_path:h,air_date:K(u).format(i===O.Movie?"YYYY-MM-DD":"YYYY"),vote:(()=>d===0?null:Number(d.toFixed(1)))(),genres:[...f.map(g=>i===O.Movie?gt[g]:i===O.Season?xt[g]:null).filter(Boolean),...m.map(g=>g.label).filter(Boolean)],episode_count_text:l,full:!!(l!=null&&l.match(/全[0-9]{1,}/)),actors:x.map(g=>g.name).join(" / ")}})})}function Js(s){const{media_id:r,target_member_id:e}=s;return A.post("/api/v2/wechat/member/token",{media_id:r,target_member_id:e})}function In(){return A.post("/api/v2/wechat/rank",{})}function Dn(s){return s.error?v.Err(s.error.message):v.Ok(s.data.map(r=>{const{id:e,type:i,title:n,desc:a,medias:o}=r;return{id:e,type:i,title:n,desc:a,medias:o.slice(0,10).map((l,h)=>{const{id:u,name:d,order:m,poster_path:f,vote_average:x}=l;return{key:h,id:u,name:d,order:m,poster_path:f,vote_average:x}})}}))}class it extends q{constructor(e){super(e);c(this,"dialog");c(this,"input");const{client:i}=e,n=new F(Ye,{client:i,onLoading(l){o.okBtn.setLoading(l)},onSuccess:()=>{this.tip({text:["提交成功"]}),o.hide()},onFailed:l=>{this.tip({text:["提交失败",l.message]})}}),a=new re({placeholder:"请输入想看的电视剧/电影"});this.input=a;const o=new V({title:"想看",onOk:()=>{if(!a.value){this.tip({text:["请先输入电视剧/电影"]});return}n.run({type:Le.Want,data:a.value})}});this.dialog=o}}function zn(s){const{app:r,client:e,history:i,view:n}=s,a=new ie(new F(It,{process:Dt,client:e}),{pageSize:20,search:{type:O.Season}}),o=new Q({os:r.env,async onPullToRefresh(){await a.refresh(),o.finishPullToRefresh()},async onReachBottom(){await a.loadMore(),o.finishLoadingMore()}}),l=new ve,h=new it({client:e}),u=new te({onClick(){h.dialog.show()}});return{$list:a,ui:{$scroll:o,$image:l,$mediaRequestBtn:u},ready(){a.init({language:n.query.language})},handleClickSeason(d){const{id:m,type:f}=d;if(f===O.Season){i.push("root.season_playing",{id:m});return}if(f===O.Movie){i.push("root.movie_playing",{id:m});return}r.tip({text:["未知的媒体类型"]})}}}const Hn=L.memo(s=>{const r=H(()=>zn(s)),[e,i]=N.useState(r.$list.response);return D(()=>{r.$list.onStateChange(n=>i(n)),r.ready()}),t.jsx(t.Fragment,{children:t.jsx(se,{className:"h-full bg-w-bg-3",store:r.ui.$scroll,children:t.jsx(me,{store:r.$list,className:"relative grid grid-cols-1 pt-4",skeleton:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex px-3 pb-3 cursor-pointer",children:[t.jsx("div",{className:"relative w-[128px] h-[198px] mr-4",children:t.jsx(z,{className:"w-full h-full"})}),t.jsxs("div",{className:"flex-1 max-w-full overflow-hidden text-ellipsis",children:[t.jsx(z,{className:"w-full h-[32px]"}),t.jsx(z,{className:"mt-1 w-24 h-[24px]"}),t.jsx(z,{className:"mt-2 w-32 h-[22px]"})]})]}),t.jsxs("div",{className:"flex px-3 pb-3 cursor-pointer",children:[t.jsx("div",{className:"relative w-[128px] h-[198px] mr-4",children:t.jsx(z,{className:"w-full h-full"})}),t.jsxs("div",{className:"flex-1 max-w-full overflow-hidden text-ellipsis",children:[t.jsx(z,{className:"w-full h-[32px]"}),t.jsx(z,{className:"mt-1 w-24 h-[24px]"}),t.jsx(z,{className:"mt-2 w-32 h-[22px]"})]})]})]}),extraEmpty:t.jsx("div",{className:"mt-2",children:t.jsx(le,{store:r.ui.$mediaRequestBtn,variant:"subtle",children:"提交想看的电视剧"})}),children:(()=>e.dataSource.map(n=>{const{id:a,type:o,name:l,episode_count_text:h,full:u,vote:d,genres:m,air_date:f,poster_path:x="",actors:g}=n;return t.jsxs("div",{className:"flex px-3 pb-3 cursor-pointer",onClick:()=>{r.handleClickSeason(n)},children:[t.jsx("div",{className:"relative w-[128px] h-[198px] mr-4 rounded-lg overflow-hidden",children:t.jsx(be,{className:"w-full h-full object-cover",store:r.ui.$image.bind(x),alt:l})}),t.jsxs("div",{className:"flex-1 max-w-full overflow-hidden",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("h2",{className:"text-xl text-w-fg-0",children:l})}),t.jsxs("div",{className:"flex items-center mt-1",children:[t.jsx("div",{children:f}),t.jsx("p",{className:"mx-2 ",children:"·"}),t.jsx("div",{className:_("relative flex items-center bg-gray-100 rounded-md dark:bg-gray-800",u?"bg-green-100 text-green-500 dark:bg-green-800 dark:text-green-500":""),style:{padding:"2px 4px",fontSize:12},children:h})]}),g?t.jsx("div",{className:_("mt-1 text-sm rounded-md bg-blue-100 text-blue-600 overflow-hidden text-ellipsis break-keep whitespace-nowrap","dark:text-blue-400 dark:bg-gray-900"),style:{padding:"2px 4px",fontSize:12},children:g}):null,(()=>d===null?null:t.jsx("div",{className:"mt-2",children:t.jsxs("div",{className:_("relative",d<=6?"text-gray-500":d>=8?"text-orange-500":"text-w-brand"),style:{},children:[t.jsx("span",{className:"italic tracking-tight font-mono text-lg",children:d}),t.jsx("span",{className:"relative ml-1 italic",style:{top:-1,left:-2,fontSize:10},children:"分"})]})}))(),t.jsx("div",{className:"mt-2 flex items-center flex-wrap gap-2 max-w-full",children:m.map(w=>t.jsx("div",{className:"py-1 px-2 text-[12px] leading-none rounded-lg break-keep whitespace-nowrap border border-w-fg-1",style:{lineHeight:"12px"},children:w},w))})]})]},a)}))()})})})});function qn(s){const{app:r,client:e}=s,i=new ie(new F(It,{process:Dt,client:e}),{pageSize:20,search:{type:O.Movie}}),n=new Q({os:r.env,async onPullToRefresh(){await i.refresh(),n.finishPullToRefresh()},async onReachBottom(){await i.loadMore(),n.finishLoadingMore()}}),a=new it({client:e}),o=new te({onClick(){a.dialog.show()}}),l=new ve;return{$list:i,ui:{$scroll:n,$poster:l,$mediaRequest:a,$mediaRequestBtn:o},ready(){i.init()}}}const An=L.memo(s=>{const{app:r,history:e}=s,i=H(()=>qn(s)),[n,a]=N.useState(i.$list.response);return D(()=>{i.$list.onStateChange(o=>a(o)),i.ready()}),t.jsx(t.Fragment,{children:t.jsx(se,{className:"h-full bg-w-bg-3",store:i.ui.$scroll,children:t.jsx(me,{store:i.$list,className:"relative grid grid-cols-1 pt-4",skeleton:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex px-3 pb-3 cursor-pointer",children:[t.jsx("div",{className:"relative w-[128px] h-[198px] mr-4",children:t.jsx(z,{className:"w-full h-full"})}),t.jsxs("div",{className:"flex-1 max-w-full overflow-hidden text-ellipsis",children:[t.jsx(z,{className:"w-full h-[32px]"}),t.jsx(z,{className:"mt-1 w-24 h-[24px]"}),t.jsx(z,{className:"mt-2 w-32 h-[22px]"})]})]}),t.jsxs("div",{className:"flex px-3 pb-3 cursor-pointer",children:[t.jsx("div",{className:"relative w-[128px] h-[198px] mr-4",children:t.jsx(z,{className:"w-full h-full"})}),t.jsxs("div",{className:"flex-1 max-w-full overflow-hidden text-ellipsis",children:[t.jsx(z,{className:"w-full h-[32px]"}),t.jsx(z,{className:"mt-1 w-24 h-[24px]"}),t.jsx(z,{className:"mt-2 w-32 h-[22px]"})]})]})]}),extraEmpty:t.jsx("div",{className:"mt-2",children:t.jsx(le,{store:i.ui.$mediaRequestBtn,variant:"subtle",children:"提交想看的电视剧"})}),children:(()=>n.dataSource.map(o=>{const{id:l,type:h,name:u,episode_count_text:d,vote:m,genres:f,air_date:x,poster_path:g="",actors:w}=o;return t.jsxs("div",{className:"flex px-3 pb-3 cursor-pointer",onClick:()=>{if(h===O.Season){e.push("root.season_playing",{id:l});return}if(h===O.Movie){e.push("root.movie_playing",{id:l});return}r.tip({text:["未知的媒体类型"]})},children:[t.jsxs("div",{className:"relative w-[128px] h-[198px] mr-4 rounded-lg overflow-hidden",children:[t.jsx(be,{className:"w-full h-full object-cover",store:i.ui.$poster.bind(g),alt:u}),d&&t.jsxs("div",{className:"absolute w-full bottom-0 flex flex-row-reverse items-center",children:[t.jsx("div",{className:"absolute z-10 inset-0 opacity-80 bg-gradient-to-t to-transparent from-w-fg-0 dark:from-w-bg-0"}),t.jsx("div",{className:"relative z-20 p-2 pt-6 text-[12px] text-w-bg-1 dark:text-w-fg-1",children:d})]})]}),t.jsxs("div",{className:"flex-1 max-w-full overflow-hidden",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("h2",{className:"text-xl text-w-fg-0",children:u})}),t.jsx("div",{className:"flex items-center mt-1",children:t.jsx("div",{children:x})}),w?t.jsx("div",{className:_("mt-1 text-sm rounded-md bg-blue-100 text-blue-600 overflow-hidden text-ellipsis break-keep whitespace-nowrap","dark:text-blue-400 dark:bg-gray-900"),style:{padding:"2px 4px",fontSize:12},children:w}):null,(()=>m===null?null:t.jsx("div",{className:"",children:t.jsxs("div",{className:_("relative",m<=6?"text-gray-500":m>=8?"text-orange-500":"text-w-brand"),style:{},children:[t.jsx("span",{className:"italic tracking-tight font-mono text-lg",children:m}),t.jsx("span",{className:"ml-1 italic",style:{fontSize:12},children:"分"})]})}))(),t.jsx("div",{className:"mt-2 flex items-center flex-wrap gap-2 max-w-full",children:f.map(p=>t.jsx("div",{className:"py-1 px-2 text-[12px] leading-none rounded-lg break-keep whitespace-nowrap border border-w-fg-1",style:{lineHeight:"12px"},children:p},p))})]})]},l)}))()})})})});function Qs(s){return A.post("/api/v2/wechat/media/playing",{media_id:s.media_id,type:s.type})}function Zs(s){if(s.error)return v.Err(s.error);const{id:r,name:e,overview:i,poster_path:n,genres:a,origin_country:o,source_count:l,cur_source:h,sources:u,vote_average:d,source_groups:m}=s.data,f=u.map(ei),x=(()=>m.map(p=>{const{start:j,end:y}=p,k=h.order>=j&&h.order<=y;return{text:j===y?j:`${j}-${y}`,cur:k,media_id:r,start:j,end:y,list:k?f:[]}}))(),g=f.find(p=>p.id===h.id),w=(()=>{if(g){const y=(()=>{const k=g.files.find(b=>b.id===h.cur_source_file_id);return k||g.files[0]})();return{...g,...os({...h,cur_source_file_id:y.id})}}const p=f[0];if(!p)return null;const j=(()=>{const y=p.files.find(k=>k.id===h.cur_source_file_id);return y||p.files[0]})();return{...p,...os({...p,current_time:0,thumbnail_path:"",cur_source_file_id:j.id})}})();return v.Ok({id:r,name:e,overview:i,posterPath:n,genres:a,originCountry:o,voteAverage:d,sourceCount:l,sourceGroups:x,curSource:w})}function ei(s){const{id:r,name:e,overview:i,air_date:n,order:a,media_id:o,still_path:l,runtime:h,sources:u,subtitles:d}=s;return{id:r,name:(()=>{const m=/^第[0-9一二三四五六七八九十]{1,}[集期章]：/;return e.match(m)?e.replace(m,""):e})(),overview:i,seasonId:o,order:a,runtime:(()=>h?Ji(h):null)(),stillPath:l,files:u.map((m,f)=>({id:m.id,name:`源${f+1}`,invalid:!1,order:f+1})),subtitles:d}}function os(s){const{id:r,current_time:e,thumbnail_path:i,cur_source_file_id:n}=s;return{id:r,currentTime:e,thumbnailPath:i,curFileId:n}}function ls(s){return A.post("/api/v2/wechat/media/episode",{media_id:s.media_id,start:s.start,end:s.end})}function cs(s){return s.error?v.Err(s.error.message):v.Ok(s.data.list.map(r=>ei(r)))}function ti(s){const{media_id:r,media_source_id:e,current_time:i,duration:n,source_id:a}=s;return A.post("/api/v2/wechat/history/update",{media_id:r,media_source_id:e,current_time:i,duration:n,source_id:a})}function Bn(s){const{page:r,pageSize:e,...i}=s;return A.post("/api/v2/wechat/history/list",{...i,page:r,page_size:e})}function On(s){if(s.error)return s;const{list:r,total:e,page_size:i,next_marker:n}=s.data;return v.Ok({page_size:i,total:e,next_marker:n,list:r.map(a=>{const{id:o,type:l,media_id:h,name:u,poster_path:d,has_update:m,episode_count:f,cur_episode_number:x,cur_episode_count:g,thumbnail_path:w,duration:p,current_time:j,air_date:y,updated:k}=a;return{id:o,type:l,media_id:h,name:u,posterPath:d,episodeCountText:(()=>l===O.Movie||!f?null:g===f?`全${f}集`:`更新至${g}集`)(),episodeText:l===O.Movie?null:Ki(x),hasUpdate:!!m,airDate:y,currentTime:j,percent:j===0||p===0?0:parseFloat((j/p*100).toFixed(0)),updated:pt(k),thumbnail_path:w}})})}function si(s){return A.post("/api/v2/wechat/history/delete",{history_id:s.history_id})}async function Vn(s){return await A.post("/api/v2/wechat/media/series",{media_id:s.media_id})}function Un(s){const{app:r,client:e,history:i,menu:n}=s,a=new Q({os:r.env,async onPullToRefresh(){await o.refresh(),a.finishPullToRefresh()},async onReachBottom(){await o.loadMore(),a.finishLoadingMore()}}),o=new ie(new F(Bn,{process:On,client:e}),{pageSize:20}),l=new xe,h=new V({onOk(){l.value&&u.run({history_id:l.value.id})}}),u=new F(si,{client:e,onLoading(x){h.okBtn.setLoading(x)},onFailed(x){r.tip({text:["删除失败",x.message]})},onSuccess(x){r.tip({text:["删除成功"]}),h.hide(),o.deleteItem(g=>{var w;return g.id===((w=l.value)==null?void 0:w.id)}),l.clear()}}),d=new ve,m=new hn({onClick(x){if(!x)return;const{type:g,media_id:w}=x;if(g===O.Season){i.push("root.season_playing",{id:w});return}if(g===O.Movie){i.push("root.movie_playing",{id:w});return}}}),f=new ve({scale:1.38});return{$list:o,ui:{$scroll:a,$deletingConfirmDialog:h,$poster:d,$thumbnail:f,$card:m},ready(){o.init()},handleClickHistory(x){const{type:g,media_id:w}=x;if(g===O.Season){i.push("root.season_playing",{id:w});return}if(g===O.Movie){i.push("root.movie_playing",{id:w});return}}}}const Wn=L.memo(s=>{const{app:r,client:e,history:i,view:n,menu:a}=s,o=H(()=>Un(s)),[l,h]=N.useState(o.$list.response),u=N.useRef(!1),[d,m]=N.useState(!1);return D(()=>{a&&(a.onScrollToTop(()=>{o.ui.$scroll.scrollTo({top:0})}),a.onRefresh(async()=>{o.ui.$scroll.startPullToRefresh(),await o.$list.refresh(),o.ui.$scroll.finishPullToRefresh()})),o.ui.$scroll.onScroll(f=>{let x=!1;f.scrollTop>r.screen.height&&(x=!0),u.current!==x&&(u.current=x,m(x))}),o.$list.onStateChange(f=>h(f)),o.ready()}),t.jsxs(t.Fragment,{children:[t.jsx(se,{className:"h-full bg-w-bg-3",store:o.ui.$scroll,children:t.jsx(me,{store:o.$list,className:"grid grid-cols-2 gap-2 px-3 pt-4",skeleton:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative w-full rounded-lg",children:[t.jsx("div",{className:"relative w-full h-[124px] overflow-hidden rounded-t-md",children:t.jsx(z,{className:"w-full h-full object-cover"})}),t.jsxs("div",{className:"py-2 pb-4",children:[t.jsx(z,{className:"w-[68%] h-[24px]"}),t.jsx(z,{className:"mt-2 w-[20%] h-[18px]"})]})]}),t.jsxs("div",{className:"relative w-full rounded-lg",children:[t.jsx("div",{className:"relative w-full h-[124px] overflow-hidden rounded-t-md",children:t.jsx(z,{className:"w-full h-full object-cover"})}),t.jsxs("div",{className:"py-2 pb-4",children:[t.jsx(z,{className:"w-[38%] h-[24px]"}),t.jsx(z,{className:"mt-2 w-[72%] h-[18px]"})]})]})]}),children:l.dataSource.map(f=>t.jsx("div",{className:"relative flex w-full cursor-pointer select-none",children:t.jsxs("div",{className:"relative w-full bg-w-bg-2 rounded-lg",onClick:()=>{o.handleClickHistory(f)},children:[t.jsxs("div",{className:"relative w-full h-[124px] overflow-hidden rounded-t-md",children:[t.jsx(be,{className:"w-full h-full object-cover",store:o.ui.$thumbnail.bind(f.thumbnail_path),alt:f.name}),t.jsx("div",{className:"absolute w-full top-0 flex flex-row-reverse items-center",children:t.jsx("div",{className:"relative z-20 p-2 text-[12px] text-w-bg-0 dark:text-w-fg-0",children:f.episodeCountText})}),t.jsx("div",{className:"absolute bottom-0 w-full",children:t.jsx("div",{className:"w-full h-[2px] rounded-md bg-w-brand",style:{width:`${f.percent}%`}})}),t.jsxs("div",{className:"absolute bottom-2 right-2 text-[12px] text-w-bg-0 dark:text-w-fg-0",children:[f.percent,"%"]})]}),t.jsx(M,{when:!!f.hasUpdate,children:t.jsx("div",{className:"absolute top-2 left-2",children:t.jsx("div",{className:"huizhang",children:"更新"})})}),t.jsxs("div",{className:"p-2 pb-2",children:[t.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap text-w-fg-0",children:f.name}),t.jsxs("div",{className:"flex items-center mt-1 text-sm text-w-fg-1",children:[f.updated,t.jsx(M,{when:!!f.episodeText,children:t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"mx-1",children:"·"}),t.jsx("p",{className:"",children:f.episodeText})]})})]})]})]})},f.id))})}),t.jsx(ln,{visible:d,onClick:()=>{o.ui.$scroll.scrollTo({top:0})}}),t.jsx("div",{className:_("z-100 fixed right-4 bottom-48",d?"block":"hidden"),style:{zIndex:100},onClick:()=>{i.push("root.history_updated")},children:t.jsx("div",{className:"flex flex-col items-center justify-center w-[64px] h-[64px] rounded-full bg-w-bg-0 opacity-100",children:t.jsx(Pi,{className:"w-6 h-6"})})}),t.jsx(G,{store:o.ui.$deletingConfirmDialog,children:t.jsx("div",{children:"确认删除吗？"})})]})}),rt=["light","dark"],zt="(prefers-color-scheme: dark)",Ht=N.createContext(void 0),Gn={setTheme:s=>{},themes:[]},Yn=()=>N.useContext(Ht)??Gn,Kn=s=>N.useContext(Ht)?t.jsx(N.Fragment,{children:s.children}):t.jsx(Jn,{...s}),Xn=["light","dark"],Jn=({forcedTheme:s,disableTransitionOnChange:r=!1,enableSystem:e=!0,enableColorScheme:i=!0,storageKey:n="theme",themes:a=Xn,defaultTheme:o=e?"system":"light",attribute:l="data-theme",value:h,children:u,nonce:d})=>{const[m,f]=N.useState(()=>hs(n,o)),[x,g]=N.useState(()=>hs(n)),w=h?Object.values(h):a,p=N.useCallback(b=>{let P=b;if(!P)return;b==="system"&&e&&(P=St());const T=h?h[P]:P,I=r?Qn():null,$=document.documentElement;if(l==="class"?($.classList.remove(...w),T&&$.classList.add(T)):T?$.setAttribute(l,T):$.removeAttribute(l),i){const R=rt.includes(o)?o:null,C=rt.includes(P)?P:R;$.style.colorScheme=C}I==null||I()},[]),j=N.useCallback(b=>{f(b);try{localStorage.setItem(n,b)}catch{}},[s]),y=N.useCallback(b=>{const P=St(b);g(P),m==="system"&&e&&!s&&p("system")},[m,s]);N.useEffect(()=>{const b=window.matchMedia(zt);return b.addListener(y),y(b),()=>b.removeListener(y)},[y]),N.useEffect(()=>{const b=P=>{if(P.key!==n)return;const T=P.newValue||o;j(T)};return window.addEventListener("storage",b),()=>window.removeEventListener("storage",b)},[j]),N.useEffect(()=>{p(s??m)},[s,m]);const k=N.useMemo(()=>({theme:m,setTheme:j,forcedTheme:s,resolvedTheme:m==="system"?x:m,themes:e?[...a,"system"]:a,systemTheme:e?x:void 0}),[m,j,s,x,e,a]);return t.jsx(Ht.Provider,{value:k,children:u})};N.memo(({forcedTheme:s,storageKey:r,attribute:e,enableSystem:i,enableColorScheme:n,defaultTheme:a,value:o,attrs:l,nonce:h})=>{const u=a==="system",d=(()=>e==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${l.map(w=>`'${w}'`).join(",")})`};`:`var d=document.documentElement,n='${e}',s='setAttribute';`)(),m=(()=>n?(rt.includes(a)?a:null)?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${a}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"")(),f=(g,w=!1,p=!0)=>{const j=o?o[g]:g,y=w?g+"|| ''":`'${j}'`;let k="";return n&&p&&!w&&rt.includes(g)&&(k+=`d.style.colorScheme = '${g}';`),e==="class"?w||j?k+=`c.add(${y})`:k+="null":j&&(k+=`d[s](n,${y})`),k},x=(()=>s?`!function(){${d}${f(s)}}()`:i?`!function(){try{${d}var e=localStorage.getItem('${r}');if('system'===e||(!e&&${u})){var t='${zt}',m=window.matchMedia(t);if(m.media!==t||m.matches){${f("dark")}}else{${f("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${f(o?"x[e]":"e",!0)}}${u?"":"else{"+f(a,!1,!1)+"}"}${m}}catch(e){}}()`:`!function(){try{${d}var e=localStorage.getItem('${r}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${f(o?"x[e]":"e",!0)}}else{${f(a,!1,!1)};}${m}}catch(t){}}();`)();return t.jsx("script",{nonce:h,dangerouslySetInnerHTML:{__html:x}})},()=>!0);const hs=(s,r)=>{let e;try{e=localStorage.getItem(s)||void 0}catch{}return e||r},Qn=()=>{const s=document.createElement("style");return s.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(s),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(s)},1)}},St=s=>(s||(s=window.matchMedia(zt)),s.matches?"dark":"light");function Zn(s){const{app:r,client:e}=s,i=new F(Ye,{client:e,onLoading(f){h.open&&h.okBtn.setLoading(f),h.open&&h.okBtn.setLoading(f)},onSuccess(f){r.tip({text:["提交成功"]}),h.open&&h.hide(),d.open&&d.hide()}}),n=new Q({os:r.env}),a=new Xe(r.$user.avatar),o=new V({footer:!1}),l=new re({defaultValue:"",placeholder:"请输入问题",autoFocus:!0}),h=new V({title:"问题与建议",onOk(){if(!l.value){r.tip({text:["请先输入问题"]});return}i.run({type:Le.Question,data:JSON.stringify({content:l.value})})}}),u=new re({defaultValue:"",placeholder:"请输入想看的电视剧/电影",autoFocus:!0}),d=new V({title:"想看",onOk(){if(!u.value){r.tip({text:["请先输入电视剧/电影"]});return}i.run({type:Le.Want,data:l.value})}}),m=new te({onClick(){r.$user.logout()}});return{ui:{$scroll:n,$avatar:a,$tip:o,$reportDialog:h,$reportInput:l,$requireDialog:d,$requireInput:u,$logout:m},ready(){r.$user.fetchProfile()}}}const ea=L.memo(s=>{const{app:r,history:e,storage:i,client:n,view:a}=s,o=H(()=>Zn(s)),{theme:l,setTheme:h}=Yn(),[u,d]=N.useState(l),[m,f]=N.useState(r.$user.state),[x,g]=N.useState(r.$user.$profile.loading),[w,p]=N.useState(he.response);return D(()=>{r.$user.$profile.onLoadingChange(j=>g(j)),he.onStateChange(j=>p(j)),(()=>{if(l!=="system")return;const j=St();d(j)})(),o.ready()}),t.jsxs(t.Fragment,{children:[t.jsx(se,{store:o.ui.$scroll,className:"bg-w-bg-0",children:t.jsxs("div",{className:"w-full h-full",children:[t.jsx("div",{className:"header",onTouchEnd:()=>{e.back()},children:t.jsx("div",{className:"flex items-center",children:t.jsx("div",{className:"inline-block p-4",children:t.jsx(je,{className:"w-6 h-6"})})})}),t.jsxs("div",{className:"relative px-4 py-2 space-y-2 text-w-fg-1",children:[t.jsxs("div",{className:"py-1 flex space-x-2",children:[t.jsx("div",{className:"p-2 rounded bg-w-bg-3",onClick:()=>{const j=(()=>u==="light"?"dark":"light")();d(j),h(j)},children:(()=>u==="light"?t.jsx(Ri,{className:"w-5 h-5"}):t.jsx(Li,{className:"w-5 h-5"}))()}),t.jsx("div",{className:"p-2 rounded bg-w-bg-3",onClick:()=>{e.push("root.update_mine_profile")},children:t.jsx(Ei,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"relative flex p-4 h-24 rounded-lg bg-w-bg-3",onClick:()=>{e.push("root.update_mine_profile")},children:[t.jsx("div",{className:"mr-4 w-16 h-16 rounded-full overflow-hidden",children:t.jsx(be,{className:"w-full h-full",store:o.ui.$avatar})}),t.jsx("div",{className:"mt-2 flex-1 w-0",children:t.jsx("div",{className:"w-full text-xl break-all truncate text-ellipsis text-w-fg-0",children:m.email||m.id})})]}),t.jsxs("div",{className:"rounded-lg bg-w-bg-3 text-w-fg-0",children:[t.jsx("div",{className:"flex items-center justify-between",onClick:()=>{e.push("root.messages")},children:t.jsxs("div",{className:"flex items-center",children:[t.jsxs("div",{className:"relative p-4",children:[t.jsx(Mi,{className:"w-5 h-5"}),t.jsx(M,{when:!!w.total,children:t.jsx("div",{className:"absolute top-3 right-3 w-2 h-2 rounded-full bg-w-red"})})]}),t.jsx("div",{className:"flex-1 py-4",children:t.jsx("div",{children:"消息"})})]})}),t.jsx("div",{className:"h-[1px] mx-4 bg-w-fg-3 transform scale-y-50"}),t.jsx("div",{className:"",onClick:()=>{e.push("root.help")},children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"p-4",children:t.jsx(Tt,{className:"w-5 h-5"})}),t.jsx("div",{className:"flex-1 py-4",children:t.jsx("div",{children:"帮助中心"})})]})}),t.jsx("div",{className:"h-[1px] mx-4 bg-w-fg-3 transform scale-y-50"}),t.jsx("div",{className:"",onClick:()=>{o.ui.$reportDialog.show()},children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"p-4",children:t.jsx(Fi,{className:"w-5 h-5"})}),t.jsx("div",{className:"flex-1 py-4",children:t.jsx("div",{children:"问题反馈"})})]})}),t.jsx("div",{className:"h-[1px] mx-4 bg-w-fg-3 transform scale-y-50"}),t.jsx("div",{className:"",onClick:()=>{o.ui.$requireDialog.show()},children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"p-4",children:t.jsx(Ii,{className:"w-5 h-5"})}),t.jsx("div",{className:"flex-1 py-4",children:t.jsx("div",{children:"想看"})})]})}),t.jsx("div",{className:"h-[1px] mx-4 bg-w-fg-3 transform scale-y-50"}),t.jsx("div",{className:"relative",onClick:()=>{if(!r.$user.hasPermission("001")){r.tip({text:["暂无权限"]});return}e.push("root.invitee")},children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"p-4",children:x?t.jsx(J,{className:"w-5 h-5 animate-spin"}):t.jsx(ys,{className:"w-5 h-5"})}),t.jsx("div",{className:"flex-1 py-4",children:t.jsx("div",{children:"邀请好友"})})]})})]}),t.jsx(le,{size:"lg",variant:"subtle",store:o.ui.$logout,children:"退出登录"}),t.jsxs("div",{className:"py-2 text-center text-sm",children:["v",Es]})]}),t.jsx("div",{className:"h-[1px]"})]})}),t.jsx(G,{store:o.ui.$tip,children:t.jsx("div",{className:"text-w-fg-1",children:"敬请期待"})}),t.jsx(G,{store:o.ui.$reportDialog,children:t.jsxs("div",{className:"text-w-fg-1",children:[t.jsx("p",{children:"提交你认为存在问题或需要改进的地方"}),t.jsx("div",{className:"mt-4",children:t.jsx(ee,{prefix:t.jsx(Ue,{className:"w-4 h-4"}),store:o.ui.$reportInput})})]})}),t.jsx(G,{store:o.ui.$requireDialog,children:t.jsxs("div",{className:"text-w-fg-1",children:[t.jsx("p",{children:"你可以提交想看的电视剧或电影"}),t.jsx("div",{className:"mt-4",children:t.jsx(ee,{prefix:t.jsx(Ue,{className:"w-4 h-4"}),store:o.ui.$requireInput})})]})})]})});function ta(s){const{app:r,history:e,client:i,storage:n,view:a}=s,{language:o=[]}=n.get("tv_search"),l=new Q({os:r.env,async onPullToRefresh(){await u.refresh(),r.tip({text:["刷新成功"]}),l.finishPullToRefresh()},async onReachBottom(){await u.loadMore(),l.finishLoadingMore()}}),h=new Q({os:r.env}),u=new ie(new F(It,{process:Dt,client:i}),{pageSize:20,beforeSearch(){m.setLoading(!0)},afterSearch(){m.setLoading(!1)}}),d=new F(In,{process:Dn,client:i}),m=new re({placeholder:"请输入关键字搜索",autoFocus:!0,onEnter(b){b!==u.params.name&&(u.search({name:b}),l.scrollTo({top:0}))},onBlur(b){b&&b!==u.params.name&&u.search({name:b})}}),f=new V,x=new ve,g=new ns({values:Kt.filter(b=>o.includes(b.value)).map(b=>b.value),options:Kt.map(b=>({...b,checked:o.includes(b.value)})),onChange(b){n.merge("tv_search",{language:b}),u.search({language:b.join("|")})}}),w=new ns({options:er,onChange(b){u.search({genres:b.join("|")})}}),p=new it({client:i}),j=new it({client:i}),y=new te({onClick(){p.input.change(m.value),p.dialog.show()}}),k=new He({onMounted(b){b.canScroll}});return p.onTip(b=>{r.tip(b)}),j.onTip(b=>{r.tip(b)}),{$list:u,$rank:d,$mediaRequest:p,$mediaRequest2:j,ui:{$scroll:l,$scroll2:h,$search:m,$poster:x,$settings:f,$source:g,$genres:w,$mediaRequestBtn:y,$node:k},ready(){d.run()}}}const sa=L.memo(s=>{const{app:r,history:e,storage:i,view:n}=s,a=H(()=>ta(s)),[o,l]=N.useState(a.$list.response),[h,u]=N.useState(a.$rank.state),[d,m]=N.useState(56),[f,x]=N.useState(!0),[g,w]=N.useState(i.values.media_search_histories);return D(()=>{n.onShow(()=>{r.setTitle(n.title)}),i.onStateChange(p=>{w(p.values.media_search_histories)}),a.$list.onStateChange(p=>{l(p)}),a.$list.onAfterSearch(({params:p})=>{const{name:j}=p;i.values.media_search_histories.find(y=>y.text===j)||i.merge("media_search_histories",[{sort:K().valueOf(),text:j}],{reverse:!0,limit:12}),x(!1)}),a.$rank.onStateChange(p=>u(p)),a.ui.$search.onChange(p=>{if(!p){x(!0);return}}),a.ui.$search.onClear(()=>{x(!0)}),a.ready()}),t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"z-50 w-full bg-w-bg-0",children:t.jsxs("div",{className:"flex items-center justify-between w-full py-2 px-4 text-w-fg-0 space-x-3",children:[t.jsx("div",{className:"flex-1 w-0",children:t.jsx(ee,{store:a.ui.$search,focus:!0,prefix:t.jsx(_t,{className:"w-5 h-5"})})}),t.jsx("div",{className:"relative py-2 w-12 text-center",onClick:()=>{e.back()},children:"取消"})]})}),(()=>f?t.jsxs(se,{store:a.ui.$scroll2,className:"absolute bottom-0 left-0 w-full text-w-fg-1",style:{top:d},children:[t.jsxs("div",{className:"relative p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"",children:"搜索历史"}),t.jsx("div",{onClick:()=>{i.clear("media_search_histories")},children:t.jsx(bs,{className:"w-4 h-4"})})]}),t.jsx("div",{className:"flex flex-wrap gap-2 mt-2 max-h-48 overflow-y-auto scroll--hidden",children:g.map((p,j)=>{const{text:y}=p;return t.jsx("div",{className:"inline-block px-4 py-2 rounded-md text-sm bg-w-bg-2",onClick:()=>{a.ui.$search.change(y),a.ui.$search.enter()},children:y},j)})})]}),(()=>h.response===null?null:t.jsx("div",{className:"__a scroll-area flex p-4 space-x-4 overflow-x-auto scroll scroll--hidden",onPointerDown:p=>{p.stopPropagation()},onTouchStart:p=>{p.stopPropagation()},onTouchMove:p=>{p.stopPropagation()},onAnimationEnd:p=>{const j=p.currentTarget;j.addEventListener("touchstart",y=>{y.stopPropagation()}),j.addEventListener("touchmove",y=>{y.stopPropagation()})},children:h.response.map((p,j)=>{const{id:y,type:k,title:b,desc:P,medias:T}=p;return t.jsx("div",{className:"py-4 rounded-md bg-w-bg-2 shadow-lg",children:t.jsxs("div",{className:"w-[248px]",children:[t.jsx("div",{className:"flex items-center justify-between px-4",children:t.jsx("div",{className:"text-lg text-w-brand",children:b})}),t.jsx("div",{className:"px-4 italic opacity-500",style:{fontSize:12},children:P}),t.jsx("div",{className:"mt-4 px-2 space-y-1",children:T.map((I,$)=>{const{key:R,id:C,name:B,order:S}=I;return t.jsxs("div",{className:"flex items-center max-w-full overflow-hidden break-keep whitespace-nowrap truncate text-ellipsis text-sm",onClick:()=>{if(C===null){a.$mediaRequest2.input.change(B),a.$mediaRequest2.dialog.show();return}if(k===wt.DoubanMovieRank){e.push("root.movie_playing",{id:C});return}if(k===wt.DoubanSeasonRank){e.push("root.season_playing",{id:C});return}r.tip({text:["未知错误"]})},children:[t.jsx("div",{className:_("w-[28px] text-gray-400 text-center italic tracking-tight font-mono",[1,2,3].includes(S)?"text-orange-500":""),children:S}),t.jsx("div",{className:_("flex-1 w-0",[1,2,3].includes(S)?"text-orange-500":"",C===null?"opacity-50":""),children:B})]},R)})})]})},y)})}))()]}):t.jsxs(se,{store:a.ui.$scroll,className:"absolute bottom-0 left-0 w-full text-w-fg-1",style:{top:d},children:[t.jsx(me,{store:a.$list,className:"relative grid grid-cols-1 pt-2",wrapClassName:"pb-8",extraEmpty:t.jsx("div",{className:"mt-2",children:t.jsx(le,{store:a.ui.$mediaRequestBtn,variant:"subtle",children:"提交想看的影视剧"})}),extraNoMore:t.jsx("div",{className:"mt-2 text-center",onClick:()=>{a.$mediaRequest.input.change(a.ui.$search.value),a.$mediaRequest.dialog.show()},children:"没有找到想看的？点击反馈"}),children:(()=>o.dataSource.map(p=>{const{id:j,type:y,name:k,episode_count_text:b,vote:P,genres:T,air_date:I,poster_path:$="",full:R,actors:C}=p;return t.jsxs("div",{className:"flex px-3 mb-4 cursor-pointer",onClick:()=>{if(y===O.Season){e.push("root.season_playing",{id:j});return}if(y===O.Movie){e.push("root.movie_playing",{id:j});return}r.tip({text:["未知的媒体类型"]})},children:[t.jsxs("div",{className:"relative w-[128px] h-[198px] mr-4 rounded-lg overflow-hidden",children:[t.jsx(be,{className:"w-full h-full object-cover",store:a.ui.$poster.bind($),alt:k}),t.jsx("div",{className:"absolute top-2 left-2",children:t.jsx("div",{className:"relative z-20 py-[1px] px-[2px] border text-[12px] rounded-md text-w-bg-1 dark:border-w-fg-1 dark:text-w-fg-1"})}),b&&t.jsxs("div",{className:"absolute w-full bottom-0 flex flex-row-reverse items-center",children:[t.jsx("div",{className:"absolute z-10 inset-0 opacity-80 bg-gradient-to-t to-transparent from-w-fg-0 dark:from-w-bg-0"}),t.jsx("div",{className:"relative z-20 p-2 pt-6 text-[12px] text-w-bg-1 dark:text-w-fg-1",children:b})]})]}),t.jsxs("div",{className:"flex-1 max-w-full overflow-hidden",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("h2",{className:"text-xl text-w-fg-0",children:k})}),(()=>P===null?null:t.jsx("div",{className:"mt-2",children:t.jsxs("div",{className:_("relative",P<=6?"text-gray-500":P>=8?"text-orange-500":"text-w-brand"),style:{},children:[t.jsx("span",{className:"italic tracking-tight font-mono text-lg",children:P}),t.jsx("span",{className:"relative ml-1 italic",style:{top:-1,left:-2,fontSize:10},children:"分"})]})}))(),t.jsxs("div",{className:"flex items-center mt-1",children:[t.jsx("div",{children:I}),t.jsx("p",{className:"mx-2 ",children:"·"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[b?t.jsx("div",{className:_("relative flex items-center bg-gray-100 rounded-md dark:bg-gray-800",R?"bg-green-100 text-green-500 dark:bg-green-800 dark:text-green-500":""),style:{padding:"2px 4px",fontSize:12},children:b}):null,t.jsx("div",{className:"relative flex items-center bg-orange-100 text-orange-600 rounded-md dark:bg-orange-800",style:{padding:"2px 4px",fontSize:12},children:(()=>y===O.Season?"电视剧":y===O.Movie?"电影":null)()})]})]}),C?t.jsx("div",{className:_("mt-1 text-sm rounded-md bg-blue-100 text-blue-600 overflow-hidden text-ellipsis break-keep whitespace-nowrap","dark:text-blue-400 dark:bg-gray-900"),style:{padding:"2px 4px",fontSize:12},children:C}):null,t.jsx("div",{className:"mt-2 flex items-center flex-wrap gap-2 max-w-full",children:T.map((B,S)=>t.jsx("div",{className:"py-1 px-2 text-[12px] leading-none rounded-lg break-keep whitespace-nowrap border border-w-fg-1",style:{lineHeight:"12px"},children:B},S))})]})]},j)}))()}),t.jsx("div",{style:{height:1}})]}))(),t.jsx(Ge,{store:a.ui.$settings,children:t.jsxs("div",{className:"relative h-[320px] py-4 pb-8 px-2 overflow-y-auto",children:[o.loading&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-0 bg-w-bg-0 opacity-50"}),t.jsx("div",{className:"absolute w-full h-[120px] flex items-center justify-center",children:t.jsx(J,{className:"w-8 h-8 animate-spin"})})]}),t.jsxs("div",{children:[t.jsx("div",{children:t.jsx(is,{store:a.ui.$source})}),t.jsx("div",{children:t.jsx(is,{store:a.ui.$genres})})]})]})}),t.jsx(G,{store:a.$mediaRequest.dialog,children:t.jsxs("div",{className:"text-w-fg-1",children:[t.jsx("p",{children:"输入想看的电视剧"}),t.jsx("div",{className:"mt-4",children:t.jsx(ee,{prefix:t.jsx(Ue,{className:"w-4 h-4"}),store:a.$mediaRequest.input})})]})}),t.jsx(G,{store:a.$mediaRequest2.dialog,children:t.jsxs("div",{className:"text-w-fg-1",children:[t.jsx("p",{children:"暂未收录，点击确定请求收录"}),t.jsx("div",{className:"mt-4",children:t.jsx(ee,{prefix:t.jsx(Ue,{className:"w-4 h-4"}),store:a.$mediaRequest2.input})})]})})]})}),ia=()=>t.jsxs("div",{className:"flex items-end h-[28px]",children:[t.jsx("div",{className:"bar bar1"}),t.jsx("div",{className:"bar bar2"}),t.jsx("div",{className:"bar bar3"})]}),Ae=6;function ra(s){const{store:r}=s,e={current:!1},i={current:null},n={current:null},a={current:{width:0,left:0}},o={current:null},l={current:0},h={current:0},u={current:null},d={current:!1},m={current:0},f={current:0},x={current:-6},g=new Z;let w;(j=>{j[j.Change=0]="Change"})(w||(w={}));const p=dr();return{$time:g,leftRef:x,barRef:n,cursorRef:i,targetTimeRef:o,handleTouchStart(j){j.stopPropagation();const y=(()=>j.touches?j.touches[0]:{clientX:j.clientX||0})();e.current=!0,r.startAdjustCurrentTime(),r.pause();const k=y.clientX,b=a.current,P=k-b.left,T=y.clientX-b.left;m.current=k,f.current=P,h.current=new Date().valueOf(),u.current=setTimeout(async()=>{if(u.current===null||d.current)return;d.current=!0,g.show(),await ke(800);const R=o.current;if(R){const C=fe(r.currentTime);R.innerText=`${C}/${fe(r._duration)}`}},200),x.current=T-Ae;const I=n.current,$=i.current;I&&(I.style.width=T+"px"),$&&($.style.left=x.current+"px")},handleTouchMove(j){if(j.stopPropagation(),e.current===!1)return;const y=(()=>j.touches?j.touches[0]:{clientX:j.clientX||0})(),k=y.clientX-m.current+f.current,b=a.current;if(k<0||k>b.width)return;const P=y.clientX-b.left,T=P/b.width;l.current=k,x.current=P-Ae;const I=n.current,$=i.current;I&&(I.style.width=P+"px"),$&&($.style.left=x.current+"px");const R=fe(T*r._duration),C=o.current;C&&(C.innerText=`${R}/${fe(r._duration)}`)},handleTouchEnd(j){if(j.stopPropagation(),e.current=!1,u.current&&(clearTimeout(u.current),u.current=null),new Date().valueOf()-h.current<=200){const T=f.current/a.current.width*r._duration;r.adjustCurrentTime(T);return}d.current&&(g.hide(),d.current=!1),f.current=l.current;const b=f.current/a.current.width*r._duration;r.adjustCurrentTime(b)},async updateRect(j){const y=j.currentTarget;await ke(200);const k=y.getBoundingClientRect();if(a.current={width:k.width,left:k.left},r._duration===0)return;const b=r.currentTime/r._duration*k.width,P=n.current,T=i.current;P&&(P.style.width=b+"px"),T&&(x.current=b-Ae,T.style.left=x.current+"px")},ready(){const j=r.onProgress(b=>{const P=a.current;if(P&&P.width){const T=Math.floor(r.currentTime/r._duration*P.width),I=n.current,$=i.current;I&&(I.style.width=T+"px"),$&&(x.current=T-Ae,$.style.left=x.current+"px")}p.emit(0,{currentTime:fe(b.currentTime),duration:fe(b.duration)})});function y(){const b=a.current;if(!b)return;const P=r._duration!==0?r.currentTime/r._duration*b.width:0,T=n.current,I=i.current;T&&(T.style.width=P+"px"),I&&(I.style.left=P-Ae+"px"),p.emit(0,{currentTime:fe(r.currentTime),duration:fe(r._duration)})}const k=r.onDurationChange(()=>{y()});return y(),()=>{j(),k()}},onChange(j){return p.on(0,j)}}}const ii=L.memo(s=>{const{store:r}=s,e=H(()=>ra({store:r})),i=N.useRef(null),n=N.useRef(null),a=N.useRef(null),[o,l]=N.useState({currentTime:fe(r._currentTime),duration:fe(r._duration)});return N.useEffect(()=>(e.barRef.current=n.current,e.cursorRef.current=i.current,e.targetTimeRef.current=a.current,e.onChange(u=>l(u)),e.ready()),[]),t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"user-select-none",onTouchStart:e.handleTouchStart,onTouchMove:e.handleTouchMove,onTouchEnd:e.handleTouchEnd,onMouseDown:e.handleTouchStart,onMouseMove:e.handleTouchMove,onMouseUp:e.handleTouchEnd,children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"text-sm",children:o.currentTime}),t.jsx("div",{className:"mx-1",children:"/"}),t.jsx("div",{className:"text-sm",children:o.duration})]}),t.jsxs("div",{className:"__a relative w-full h-[4px] py-4 cursor-pointer rounded-md",onAnimationEnd:async h=>{e.updateRect(h)},children:[t.jsx("div",{className:"progress__mask absolute top-1/2 left-0 w-full h-[4px] bg-w-fg-3 rounded-sm",style:{transform:"translateY(-50%)"}}),t.jsx("div",{ref:n,className:"progress__bar absolute top-1/2 left-0 bg-green-500",style:{width:0,height:4,transform:"translateY(-50%)"}}),t.jsx("div",{ref:i,className:"progress__cursor absolute top-1/2",style:{left:e.leftRef.current,width:12,height:12,borderRadius:"50%",backgroundColor:"#fff",transform:"translate(0px, -50%)"}})]})]}),t.jsx(Et,{children:t.jsx(ce,{store:e.$time,children:t.jsxs("div",{className:"z-10 fixed toast p-4 top-[32%] left-1/2 w-[240px] rounded-md",style:{zIndex:900,transform:"translate(-50%, -50%)"},children:[t.jsx("div",{className:"z-0 absolute top-0 left-0 w-full h-full rounded-md",style:{backgroundColor:"#000",opacity:.8}}),t.jsx("div",{className:"z-10 relative",children:t.jsx("div",{ref:a,className:"__a w-full h-[36px] text-md text-w-bg-0 text-center dark:text-w-fg-0",style:{fontSize:24},onAnimationEnd:h=>{e.targetTimeRef.current=h.currentTarget}})})]})})})]})});class ri extends q{constructor(e){super(e);c(this,"cur",new xe);c(this,"nameInput",new re({defaultValue:"",placeholder:"请输入昵称搜索",onEnter:()=>{this.searchBtn.click()}}));c(this,"searchBtn",new te({onClick:()=>{this.$list.search({name:this.nameInput.value})}}));c(this,"submitBtn");c(this,"$list");const{client:i,onSelect:n,onOk:a,onCancel:o}=e;this.$list=new ie(new F(Fs,{client:i}),{onLoadingChange:l=>{this.searchBtn.setLoading(l)}}),this.submitBtn=new te({onClick:()=>{if(!this.value){this.tip({text:["请先选择好友"]});return}a&&a(this.value)}}),this.cur.onStateChange(l=>{l===null&&this.emit(4)}),n&&this.onSelect(n)}get response(){return this.$list.response}get value(){return this.cur.value}clear(){this.cur.clear()}select(e){this.cur.select(e),this.emit(3,e)}onResponseChange(e){return this.$list.onStateChange(e)}onCurSeasonChange(e){return this.cur.onStateChange(e)}onSelect(e){return this.on(3,e)}onClear(e){return this.on(4,e)}}const ft=s=>typeof s=="object"&&s!==null,ye=new WeakMap,Qe=new WeakSet,na=(s=Object.is,r=(h,u)=>new Proxy(h,u),e=h=>ft(h)&&!Qe.has(h)&&(Array.isArray(h)||!(Symbol.iterator in h))&&!(h instanceof WeakMap)&&!(h instanceof WeakSet)&&!(h instanceof Error)&&!(h instanceof Number)&&!(h instanceof Date)&&!(h instanceof String)&&!(h instanceof RegExp)&&!(h instanceof ArrayBuffer),i=new WeakMap,n=(h,u)=>{const d=i.get(h);if((d==null?void 0:d[0])===u)return d[1];const m=Array.isArray(h)?[]:Object.create(Object.getPrototypeOf(h));return At(m,!0),i.set(h,[u,m]),Reflect.ownKeys(h).forEach(f=>{if(Object.getOwnPropertyDescriptor(m,f))return;const x=Reflect.get(h,f),{enumerable:g}=Reflect.getOwnPropertyDescriptor(h,f),w={value:x,enumerable:g,configurable:!0};if(Qe.has(x))At(x,!1);else if(ye.has(x)){const[p,j]=ye.get(x);w.value=n(p,j())}Object.defineProperty(m,f,w)}),Object.preventExtensions(m)},a=new WeakMap,o=[1,1],l=h=>{if(!ft(h))throw new Error("object required");const u=a.get(h);if(u)return u;let d=o[0];const m=new Set,f=($,R=++o[0])=>{d!==R&&(d=R,m.forEach(C=>C($,R)))};let x=o[1];const g=($=++o[1])=>(x!==$&&!m.size&&(x=$,p.forEach(([R])=>{const C=R[1]($);C>d&&(d=C)})),d),w=$=>(R,C)=>{const B=[...R];B[1]=[$,...B[1]],f(B,C)},p=new Map,j=($,R)=>{const C=!Qe.has(R)&&ye.get(R);if(C)if(m.size){const B=C[3](w($));p.set($,[C,B])}else p.set($,[C])},y=$=>{var C;const R=p.get($);R&&(p.delete($),(C=R[1])==null||C.call(R))},k=$=>(m.add($),m.size===1&&p.forEach(([C,B],S)=>{const E=C[3](w(S));p.set(S,[C,E])}),()=>{m.delete($),m.size===0&&p.forEach(([C,B],S)=>{B&&(B(),p.set(S,[C]))})});let b=!0;const T=r(h,{deleteProperty($,R){const C=Reflect.get($,R);y(R);const B=Reflect.deleteProperty($,R);return B&&f(["delete",[R],C]),B},set($,R,C,B){const S=!b&&Reflect.has($,R),E=Reflect.get($,R,B);if(S&&(s(E,C)||a.has(C)&&s(E,a.get(C))))return!0;y(R),ft(C)&&(C=Di(C)||C);let U=C;return C instanceof Promise?C.then(ne=>{C.status="fulfilled",C.value=ne,f(["resolve",[R],ne])}).catch(ne=>{C.status="rejected",C.reason=ne,f(["reject",[R],ne])}):(!ye.has(C)&&e(C)&&(U=l(C)),j(R,U)),Reflect.set($,R,U,B),f(["set",[R],C,E]),!0}});a.set(h,T);const I=[h,g,n,k];return ye.set(T,I),Reflect.ownKeys(h).forEach($=>{const R=Object.getOwnPropertyDescriptor(h,$);"value"in R&&R.writable&&(T[$]=h[$])}),b=!1,T})=>[l,ye,Qe,s,r,e,i,n,a,o],[aa]=na();function ni(s={}){return aa(s)}function ai(s,r,e){const i=ye.get(s);let n;const a=[],o=i[3];let l=!1;const u=o(d=>{if(a.push(d),e){r(a.splice(0));return}n||(n=Promise.resolve().then(()=>{n=void 0,l&&r(a.splice(0))}))});return l=!0,()=>{l=!1,u()}}function oi(s){const r=ye.get(s),[e,i,n]=r;return n(e,i())}const oa=[{value:1,title:"分辨率"},{value:2,title:"视频源"},{value:3,title:"字幕列表"},{value:4,title:"播放倍率"},{value:5,title:"分享"},{value:6,title:"反馈问题"}];function la(s){const{$media:r,$player:e,app:i,client:n,history:a,storage:o}=s,l=ni({shareLink:""}),h=new F(Js,{client:n,onLoading(b){p.submitBtn.setLoading(b)},onSuccess(b){const{name:P,token:T}=b;if(!r.profile){i.tip({text:["详情未加载"]});return}const I=a.buildURLWithPrefix("root.season_playing",{id:r.profile.id,token:T,tmp:"1"});j.show();const $=`➤➤➤ ${P}
${a.$router.origin}${I}`;l.shareLink=$},onFailed(b){i.tip({text:["分享失败",b.message]})}}),u=new F(Ye,{client:n,onLoading(b){k.okBtn.setLoading(b)},onSuccess(){i.tip({text:["提交成功"]}),k.hide()},onFailed(b){i.tip({text:["提交失败",b.message]})}}),d=new He,m=new we({value:2}),f=new we({value:2}),x=new we({value:2}),g=new we({value:2}),w=new Q({os:i.env,async onPullToRefresh(){await p.$list.refresh(),w.finishPullToRefresh()}}),p=new ri({client:n,onSelect(b){if(!r.profile){i.tip({text:["请选择要分享的影视剧"]});return}j.show(),h.run({media_id:r.profile.id,target_member_id:b.id})}}),j=new V({footer:!1}),y=new xe({}),k=new V({title:"发现问题",onOk(){var b;if(!r.profile){i.tip({text:["影视剧信息还未加载"]});return}if(!y.value){i.tip({text:["请先选择问题"]});return}u.run({type:Le.Season,data:y.value,media_id:r.profile.id,media_source_id:(b=r.curSource)==null?void 0:b.id})}});return{state:l,inviteeSelect:p,curReport:y,reportRequest:u,ui:{$scroll:w,wrap:d,sourceIcon:m,fileIcon:f,rateIcon:x,subtitleIcon:g,reportConfirmDialog:k,shareDialog:j},subscribe:ai}}const ca=s=>{const{$media:r,$player:e,app:i,client:n,history:a,storage:o}=s,l=H(()=>la(s)),[h,u]=N.useState(1),[d,m]=N.useState(r.state),[f,x]=N.useState(r.$source.profile),[g,w]=N.useState(e.state),[p,j]=N.useState(r.$source.subtitle),[y,k]=N.useState(e._curRate),[b,P]=N.useState(l.inviteeSelect.$list.response),[T,I]=N.useState(l.state.shareLink),[$,R]=N.useState(l.curReport.value),C=S=>{u(S),l.ui.wrap.setStyles("transform: translate(-100%);")},B=()=>{l.ui.wrap.setStyles("transform: translate(0);")};return D(()=>{r.onStateChange(S=>m(S)),r.onSourceFileChange(S=>x(S)),r.$source.onSubtitleChange(S=>j(S)),e.onRateChange(S=>k(S.rate)),e.onStateChange(S=>w(S)),l.subscribe(l.state,S=>I(oi(l.state).shareLink)),l.curReport.onChange(S=>R(S)),l.inviteeSelect.onResponseChange(S=>P(S))}),t.jsxs("div",{className:"overflow-hidden h-full",children:[t.jsxs(at,{className:"flex h-full transition-transform duration-500 ease-in-out",store:l.ui.wrap,children:[t.jsxs("div",{className:"panel__home w-full flex-shrink-0",children:[t.jsx("div",{className:"space-x-2 px-4",children:t.jsx("div",{className:"flex items-center mt-2 h-12",children:t.jsx("div",{className:"text-xl",children:"设置"})})}),t.jsx("div",{className:"h-[1px] bg-w-bg-1"}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{C(1)},children:[t.jsx("div",{children:"分辨率"}),t.jsxs("div",{className:"flex items-center text-w-fg-1",children:[t.jsx(M,{when:!!(f!=null&&f.typeText),children:t.jsx("div",{className:"px-2",children:f==null?void 0:f.typeText})}),t.jsx(oe,{className:"w-5 h-5"})]})]}),t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{C(2)},children:[t.jsx("div",{children:"视频源"}),t.jsx("div",{className:" text-w-fg-1",children:t.jsx(oe,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{p!==null&&C(3)},children:[t.jsx("div",{children:"字幕列表"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"px-4",onClick:S=>{S.stopPropagation(),p!==null&&(e.toggleSubtitleVisible(),r.$source.toggleSubtitleVisible())},children:(()=>p===null?t.jsx("span",{className:"text-w-fg-2",children:"暂无字幕"}):p.visible?"禁用":"启用")()}),t.jsx("div",{className:_(p===null?"text-w-fg-2":"text-w-fg-1"),onClick:()=>{p!==null&&C(3)},children:t.jsx(oe,{className:"w-5 h-5"})})]})]}),t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{C(4)},children:[t.jsx("div",{children:"播放倍率"}),t.jsxs("div",{className:"flex items-center space-x-2 text-w-fg-1",children:[t.jsxs("div",{className:"px-2",children:[g.rate,"x"]}),t.jsx(oe,{className:"w-5 h-5"})]})]}),t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{C(5),l.inviteeSelect.$list.init()},children:[t.jsx("div",{children:"分享"}),t.jsx("div",{className:"flex items-center space-x-2 text-w-fg-1",children:t.jsx(oe,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{C(6)},children:[t.jsx("div",{children:"反馈问题"}),t.jsx("div",{className:"flex items-center space-x-2 text-w-fg-1",children:t.jsx(oe,{className:"w-5 h-5"})})]})]})]}),t.jsxs("div",{className:"panel__second relative w-full h-full flex-shrink-0",children:[t.jsx("div",{className:"flex items-center justify-between mt-2 h-12 px-4 bg-w-bg-2",children:t.jsxs("div",{className:"flex items-center space-x-1",onClick:()=>{B()},children:[t.jsx(Ns,{className:"w-6 h-6"}),t.jsxs("div",{className:"flex items-center space-x-2 text-lg",children:[t.jsx("div",{className:"text-w-fg-2",children:"设置"}),t.jsx("div",{children:"/"}),t.jsx("div",{children:(()=>{const S=oa.find(E=>E.value===h);return S?S.title:null})()})]})]})}),t.jsx("div",{className:"h-[1px] bg-w-bg-1"}),t.jsx(se,{className:"absolute top-16 bottom-0 left-0 w-full h-auto",store:l.ui.$scroll,children:(()=>{if(h===1)return t.jsx("div",{children:(()=>{if(!f||!f.resolutions.length)return t.jsx("div",{className:"flex items-center justify-center p-12",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(Re,{className:"w-24 h-24"}),t.jsx("div",{className:"mt-2 text-center",children:"暂无可切换的分辨率"})]})});const{typeText:S,resolutions:E}=f;return t.jsx("div",{className:"max-h-full text-w-fg-1 px-4 overflow-y-auto",children:t.jsx("div",{className:"pb-24",children:E.map((U,ne)=>{const{type:ae,typeText:$e}=U;return t.jsxs("div",{className:_("flex items-center justify-between p-4 rounded-md cursor-pointer",S===$e?"bg-w-bg-active":""),onClick:async()=>{if(l.ui.sourceIcon.select(ae),l.ui.sourceIcon.set(3),(await r.changeResolution(ae)).error){l.ui.sourceIcon.set(5);return}l.ui.sourceIcon.set(2),l.ui.sourceIcon.clear(),o.merge("player_settings",{type:ae})},children:[t.jsx("div",{children:$e}),t.jsx(de,{className:"ml-4",store:l.ui.sourceIcon.bind(ae),options:[{value:1,content:null},{value:2,content:t.jsx(M,{when:S===$e,children:t.jsx("div",{children:t.jsx(Se,{className:"w-6 h-6"})})})},{value:3,content:t.jsx(J,{className:"w-6 h-6 animate animate-spin"})},{value:4,content:t.jsx(_e,{className:"w-6 h-6"})},{value:5,content:t.jsx(pe,{className:"w-6 h-6"})}]})]},ne)})})})})()});if(h===2)return t.jsx("div",{children:(()=>d===null?t.jsx("div",{className:"flex items-center justify-center p-12",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(J,{className:"w-24 h-24 animate animate-spin"}),t.jsx("div",{className:"mt-2 text-center",children:"Loading"})]})}):d.curSource?t.jsx("div",{className:"max-h-full overflow-y-auto px-4 text-w-fg-1",children:t.jsx("div",{className:"pb-24",children:d.curSource.files.map(S=>{const{id:E,name:U,invalid:ne}=S;return t.jsxs("div",{className:_("flex items-center justify-between p-4 rounded-md cursor-pointer",(f==null?void 0:f.id)===E?"bg-w-bg-active":""),onClick:async()=>{if((f==null?void 0:f.id)===E)return;if(l.ui.fileIcon.select(E),l.ui.fileIcon.set(3),(await r.changeSourceFile(S)).error){l.ui.fileIcon.set(5),l.ui.fileIcon.clear();return}l.ui.fileIcon.set(2),l.ui.fileIcon.clear()},children:[t.jsx("div",{className:"break-all",children:U}),t.jsx(de,{className:"ml-4",store:l.ui.fileIcon.bind(E),options:[{value:1,content:null},{value:2,content:t.jsx(M,{when:ne||!!(f!=null&&f.invalid),fallback:t.jsx(M,{when:(f==null?void 0:f.id)===E,children:t.jsx("div",{children:t.jsx(Se,{className:"w-6 h-6"})})}),children:t.jsx(pe,{className:"w-6 h-6"})})},{value:3,content:t.jsx(J,{className:"w-6 h-6 animate animate-spin"})},{value:4,content:t.jsx(_e,{className:"w-6 h-6"})},{value:5,content:t.jsx(pe,{className:"w-6 h-6"})}]})]},E)})})}):t.jsx("div",{className:"flex items-center justify-center p-12",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(Re,{className:"w-24 h-24"}),t.jsx("div",{className:"mt-2 text-center",children:"没有可切换的视频源"})]})}))()});if(h===4)return t.jsx("div",{children:(()=>t.jsx("div",{className:"max-h-full overflow-y-auto px-4 text-w-fg-1",children:t.jsx("div",{className:"pb-24",children:[.5,.75,1,1.25,1.5,2].map((S,E)=>t.jsxs("div",{className:_("flex items-center justify-between p-4 rounded-md cursor-pointer",y===S?"bg-w-bg-active":""),onClick:()=>{l.ui.rateIcon.select(S),l.ui.rateIcon.set(2),e.changeRate(S),l.ui.rateIcon.clear(),o.merge("player_settings",{rate:S})},children:[t.jsxs("div",{className:"break-all",children:[S,"x"]}),t.jsx(de,{className:"ml-4",store:l.ui.rateIcon.bind(S),options:[{value:1,content:null},{value:2,content:t.jsx(M,{when:y===S,children:t.jsx("div",{children:t.jsx(Se,{className:"w-6 h-6"})})})},{value:3,content:t.jsx(J,{className:"w-6 h-6 animate animate-spin"})}]})]},E))})}))()});if(h===3)return t.jsx("div",{children:(()=>t.jsx("div",{className:"max-h-full overflow-y-auto px-4 text-w-fg-1",children:t.jsx("div",{className:"pb-24",children:r.$source.subtitles.map((S,E)=>t.jsxs("div",{className:_("flex items-center justify-between p-4 rounded-md cursor-pointer",S.url===(p==null?void 0:p.url)?"bg-w-bg-active":""),onClick:async()=>{if(l.ui.subtitleIcon.select(S.id),l.ui.subtitleIcon.set(3),(await r.$source.loadSubtitleFile(S,r.currentTime)).error){l.ui.subtitleIcon.set(5),l.ui.subtitleIcon.clear();return}l.ui.subtitleIcon.set(4),l.ui.subtitleIcon.clear()},children:[t.jsx("div",{className:"w-full break-all truncate",children:S.language.join("&")}),t.jsx(de,{className:"ml-4",store:l.ui.subtitleIcon.bind(S.id),options:[{value:1,content:null},{value:2,content:t.jsx(M,{when:S.url===(p==null?void 0:p.url),children:t.jsx("div",{children:t.jsx(Se,{className:"w-6 h-6"})})})},{value:3,content:t.jsx(J,{className:"w-6 h-6 animate animate-spin"})},{value:4,content:t.jsx(_e,{className:"w-6 h-6"})},{value:5,content:t.jsx(pe,{className:"w-6 h-6"})}]})]},E))})}))()});if(h===5)return t.jsx("div",{children:(()=>t.jsx("div",{className:"max-h-full overflow-y-auto text-w-fg-1",children:t.jsx("div",{className:"pb-24",children:t.jsx(me,{wrapClassName:"flex-1 overflow-y-auto",className:"max-h-full flex flex-col h-full",store:l.inviteeSelect.$list,skeleton:t.jsxs("div",{className:"flex items-center justify-between space-x-2 p-4 rounded-md cursor-pointer",children:[t.jsx("div",{className:"w-8 h-8 bg-slate-300 rounded-full",children:t.jsx(z,{className:"w-[32px] h-[32px]"})}),t.jsx("div",{className:"flex-1",children:t.jsx(z,{className:"h-[32px] w-[180px]"})})]}),children:t.jsx("div",{className:"space-y-4 flex-1 overflow-y-auto",children:b.dataSource.map(S=>{const{id:E,remark:U}=S;return t.jsxs("div",{className:"flex items-center justify-between space-x-2 p-4 rounded-md cursor-pointer",onClick:()=>{l.inviteeSelect.select(S)},children:[t.jsx("div",{className:"flex items-center justify-between bg-slate-300 rounded-full",children:t.jsx("div",{className:"w-8 h-8 text-xl text-center text-slate-500",children:U.slice(0,1).toUpperCase()})}),t.jsx("div",{className:"flex-1 w-0",children:t.jsx("h2",{className:"",children:U})})]},E)})})})})}))()});if(h===6)return t.jsx("div",{children:(()=>t.jsx("div",{className:"max-h-full overflow-y-auto px-4 text-w-fg-1",children:t.jsx("div",{className:"pb-24",children:Ms.map((S,E)=>t.jsx("div",{className:"flex items-center justify-between p-4 rounded-md cursor-pointer",onClick:()=>{l.curReport.select(S),l.ui.reportConfirmDialog.show()},children:t.jsx("div",{children:S})},E))})}))()})})()})]})]}),t.jsx(G,{store:l.ui.shareDialog,children:t.jsx("div",{className:"relative w-full h-[160px]",onClick:()=>{T&&(i.copy(T),i.tip({text:["已复制至粘贴板"]}),l.ui.shareDialog.hide())},children:(()=>T?t.jsxs("div",{className:"text-center",children:[t.jsx("div",{children:"点击复制该信息至粘贴板"}),t.jsx("div",{className:"mt-4 rounded-md p-4 bg-w-bg-2",children:t.jsx("pre",{className:"text-left break-all whitespace-normal text-w-fg-1",children:T})})]}):t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx(ze,{className:"w-12 h-12 animate animate-spin"})}))()})}),t.jsx(G,{store:l.ui.reportConfirmDialog,children:t.jsxs("div",{className:"text-w-fg-1",children:[t.jsx("p",{children:"提交你发现的该电视剧的问题"}),t.jsxs("p",{className:"mt-2 text-xl",children:["「",$,"」"]})]})})]})};class li extends q{constructor(e){super(e);c(this,"$ref",new xe({}));c(this,"$media",new xe({}));c(this,"$create");c(this,"$dialog");const{app:i,client:n}=e;this.$create=new F(Ye,{client:n});const a=new V({title:"提交问题",onOk:()=>{if(!this.$ref.value){i.tip({text:["请先选择问题"]});return}if(!this.$media.value){i.tip({text:["没有选择影视剧"]});return}this.$create.run({type:Le.Season,data:this.$ref.value,media_id:this.$media.value.media_id,media_source_id:this.$media.value.media_source_id})}});this.$dialog=a,this.$create.onLoadingChange(o=>{a.okBtn.setLoading(o)}),this.$create.onSuccess(()=>{i.tip({text:["提交成功"]}),a.hide()}),this.$create.onFailed(o=>{i.tip({text:["提交失败",o.message]})})}onStateChange(e){return this.on(0,e)}}function ge(s){if(s.match(/[0-9]{1,2}:[0-9]{2}:[0-9]{2}[\.,]/)){const r=s.split(":"),e=parseInt(r[0]),i=parseInt(r[1]),n=parseFloat(r[2].replace(",","."));return parseFloat((e*60*60+i*60+n).toFixed(2))}if(s.match(/[0-9]{2}:[0-9]{2}[\.,]/)){const r=s.split(":"),e=parseInt(r[0]),i=parseFloat(r[1].replace(",","."));return parseFloat((e*60+i).toFixed(2))}return 0}function us(s){const r=s.match(/([0-9]{1,2})(:[0-9]{2}:[0-9]{2}[\.,])([0-9]{1,})/);if(!r)return s;const[,e,i,n]=r;return Ie(e)+i+Ie(n,{count:3,pos:2})}function ha(s){if(!s)return"srt";const{pathname:r}=ps(s),e=r.split(".").pop();return e?e.toLowerCase():"srt"}const ua={srt:s=>{if(!s)return[];let r=s.split(`\r
\r
`).filter(Boolean);return r.length===1&&(r=r[0].split(`

`).filter(Boolean)),r.map((e,i)=>{const n=(()=>{let[d,...m]=e.split(`\r
`).filter(Boolean);if(d&&d.includes("-->")){const[f,x]=d.split(" --> ");return[f,x,m]}if([d,...m]=m,d&&d.includes("-->")){const[f,x]=d.split(" --> ");return[f,x,m]}return null})();if(n===null)return null;const[a,o,l]=n,h=a.replace(/,/,"."),u=o.replace(/,/,".");return{start:h,end:u,startTime:ge(h),endTime:ge(u),texts:l}}).filter(Boolean).filter(e=>!(e===null||Math.abs(e.endTime-e.startTime)<.1)).map((e,i)=>{const{start:n,end:a,startTime:o,endTime:l,texts:h}=e;return{line:String(i),start:n,end:a,startTime:o,endTime:l,texts:h}})},vtt:s=>s?s.replace(/WEBVTT/,"").split(`

`).filter(Boolean).filter(i=>i!==`
`).map((i,n)=>{const[a,...o]=i.split(`
`).filter(Boolean),[l,h]=a.split(" --> "),u=l.split(",")[0],d=h.split(",")[0];return{start:u,end:d,startTime:ge(u),endTime:ge(d),texts:o}}).filter(i=>!(Math.abs(i.endTime-i.startTime)<.1)).map((i,n)=>{const{start:a,end:o,startTime:l,endTime:h,texts:u}=i;return{line:String(n),start:a,end:o,startTime:l,endTime:h,texts:u}}):[],ass:s=>{if(!s)return[];const r=s.match(/Dialogue:[^\n]{1,}\n{0,}/g);return r?r.map(e=>{const i=e.replace(/{[^}]{1,}}/g,""),[,n,a,o,l,h,u,d,m,...f]=i.split(","),[x="",g=""]=f.map(w=>w.replace(/\n$/,"")).join(",").split("\\N");return{start:n,end:a,startTime:ge(n),endTime:ge(a),texts:[x,g].filter(Boolean)}}).filter(e=>!(Math.abs(e.endTime-e.startTime)<.1)).map((e,i)=>{const{start:n,end:a,startTime:o,endTime:l,texts:h}=e;return{line:String(i),start:n,end:a,startTime:o,endTime:l,texts:h}}):[]}};function da(s,r){const e=ua[r];return e?e(s):[{line:"1",start:"",startTime:0,end:"",endTime:0,texts:[s]}]}const ma={[Y.CN]:"简体中文",[Y.TW]:"繁体中文",[Y.JP]:"日语",[Y.US]:"英语","chi&eng":"中英对照"},fa={[Y.CN]:"zh",[Y.TW]:"zh",[Y.JP]:"ja",[Y.US]:"en","chi&eng":"zh"};function ci(s){const{lines:r}=s,e=["WEBVTT","",...r.map((a,o)=>{const{start:l,end:h,texts:u}=a;return[`${us(l)} --> ${us(h)}`,...u].join(`
`)})].join(`\r
\r
`),i=new Blob([e],{type:"text/vtt"});return{src:URL.createObjectURL(i),label:s.lang?ma[s.lang.join("&")]:s.filename,lang:(()=>s.lang&&fa[s.lang.join("&")]||"zh")()}}var kt=(s=>(s[s.LocalFile=1]="LocalFile",s[s.AliyundriveFile=2]="AliyundriveFile",s[s.MediaInnerFile=3]="MediaInnerFile",s))(kt||{});class qt extends q{constructor(e){super(e);c(this,"filename","");c(this,"lang");c(this,"suffix");c(this,"files",[]);c(this,"lines",[]);c(this,"targetLine");c(this,"curLine",null);c(this,"curLineIndex",null);c(this,"curTime",0);c(this,"baseStep",0);const{filename:i,lines:n,suffix:a,language:o}=e;this.filename=i,this.lines=n,this.suffix=a,this.lang=o,this.targetLine=n[0]}static async New(e,i){const{id:n,name:a,type:o,url:l,language:h}=e,{client:u}=i,d=await(async()=>{if(o===kt.MediaInnerFile){const p=await(async()=>{try{const j=await u.fetch({url:l,method:"GET"});return v.Ok(j.data)}catch(j){const y=j;return v.Err(y.message)}})();return p.error?v.Err(p.error):v.Ok({name:a,content:p.data})}if(o===kt.LocalFile)try{const p=await u.fetch({url:[A.getHostname(),l].join(""),method:"GET"});return v.Ok({name:a,content:p.data})}catch(p){const j=p;return v.Err(j.message)}return v.Err("未知字幕类型")})();if(d.error)return v.Err(d.error);const{content:m,name:f}=d.data,x=ha(f),g=da(m,x),w=new qt({filename:f,language:h,suffix:x,lines:g});return i.currentTime&&w.handleTimeChange(i.currentTime),v.Ok(w)}get state(){return{curLine:this.curLine}}changeTargetLine(e){let i=this.lines.find(n=>{const{start:a,end:o}=n,l=ge(a),h=ge(o);return e>l&&e<=h});i||(i=this.lines.find(n=>{const{start:a,end:o}=n,l=ge(a);return e<l})),i&&(this.targetLine=i)}handleTimeChange(e){if(Math.abs(e-this.curTime)>=1&&(this.curLine=null,this.curLineIndex=null,this.emit(0,{...this.state}),this.changeTargetLine(e)),this.curTime=e,!this.targetLine)return;const i=this.curLineIndex,{startTime:n,endTime:a}=this.targetLine,o=n+this.baseStep,l=a+this.baseStep;(()=>{if(this.curLine&&e>this.curLine.endTime&&(this.curLineIndex=null),e>o&&e<=l){this.curLineIndex=this.lines.findIndex(h=>h===this.targetLine),this.targetLine=this.lines[this.curLineIndex+1]??null;return}})(),i!==this.curLineIndex&&((()=>{if(this.curLineIndex===null){this.curLine=null;return}this.curLine=this.lines[this.curLineIndex]})(),this.emit(0,{...this.state}))}increase(e){this.baseStep+=e}subtract(e){this.baseStep-=e}onStateChange(e){return this.on(0,e)}}function pa(s){return A.post("/api/v2/wechat/source",{id:s.id,type:s.type})}function xa(s){if(s.error)return v.Err(s.error);const{id:r,url:e,width:i,height:n,thumbnail_path:a,type:o,invalid:l,other:h,subtitles:u}=s.data;return v.Ok({id:r,url:e,type:o,typeText:bt[o],width:i,height:n,invalid:l,thumbnailPath:a,resolutions:h.map(d=>{const{cur:m,url:f,width:x,height:g,type:w}=d;return{cur:m,url:f,type:w,typeText:bt[d.type],width:x,height:g}}),subtitles:u})}class hi extends q{constructor(e){super();c(this,"profile",null);c(this,"curResolution",Ce.SD);c(this,"subtitle",null);c(this,"subtitles",[]);c(this,"loading",!1);c(this,"$subtitle",null);c(this,"$client");const{client:i,resolution:n=Ce.SD}=e;this.$client=i,this.curResolution=n}get state(){return{resolution:this.curResolution}}async load(e){const n=await new F(pa,{process:xa,client:this.$client}).run({id:e.id,type:this.curResolution});if(n.error)return this.tip({text:["获取影片详情失败",n.error.message]}),this.profile={id:e.id,invalid:1,url:"",type:this.curResolution,typeText:"",width:0,height:0,thumbnailPath:"",resolutions:[],subtitles:[]},this.emit(2,{...this.state}),v.Err(n.error);const{url:a,thumbnailPath:o,typeText:l,type:h,width:u,height:d,resolutions:m,subtitles:f}=n.data;return this.curResolution=h,this.profile={id:e.id,url:a,type:h,typeText:l,invalid:0,width:u,height:d,thumbnailPath:o,resolutions:m,subtitles:f},this.emit(2,{...this.state}),v.Ok(this.profile)}changeResolution(e){if(this.profile===null){const f=this.tip({text:["视频还未加载完成"]});return v.Err(f)}const{id:i,resolutions:n,subtitles:a,thumbnailPath:o}=this.profile;if(this.curResolution===e){const f=this.tip({text:[`当前已经是${bt[e]}了`]});return v.Err(f)}this.curResolution=e;const l=n.find(f=>f.type===e);if(!l){const f=this.tip({text:[`没有 '${e}' 分辨率`]});return v.Err(f)}const{url:h,typeText:u,width:d,height:m}=l;return this.profile={id:i,url:h,type:e,typeText:u,invalid:0,width:d,height:m,resolutions:n,subtitles:a,thumbnailPath:o},this.emit(2,{...this.state}),v.Ok(this.profile)}async loadSubtitle(e){const{extraSubtitleFiles:i,currentTime:n}=e;if(!this.profile)return v.Err("请先调用 load 获取视频文件");const a=i.concat(this.profile.subtitles).filter(Boolean);this.subtitles=a;const o=(()=>{const l=a.find(h=>h.language.join("&")===Y.CN);return l||(a[0]??null)})();return this.subtitle=null,this.emit(3,null),o?this.loadSubtitleFile(o,n):v.Err("没有可加载的字幕文件")}async loadSubtitleFile(e,i){var l;if(e.url===((l=this.subtitle)==null?void 0:l.url))return v.Err("已经是当前字幕了");this.$subtitle&&this.$subtitle.destroy(),this.$subtitle=null;const n=await qt.New(e,{currentTime:i,client:this.$client});if(n.error)return v.Err("实例化字幕失败");this.$subtitle=n.data;const{curLine:a}=n.data,o={url:e.url,visible:!0,index:(a==null?void 0:a.line)??"0",texts:(a==null?void 0:a.texts)??[]};return this.subtitle=o,this.emit(4,this.$subtitle),this.emit(3,{...o}),this.$subtitle.onStateChange(h=>{const{curLine:u}=h,d={url:e.url,visible:!0,index:(u==null?void 0:u.line)??"0",texts:(u==null?void 0:u.texts)??[]};this.subtitle=d,this.emit(3,{...d})}),v.Ok(null)}toggleSubtitleVisible(){if(this.subtitle){if(this.subtitle.visible){this.hideSubtitle();return}this.showSubtitle()}}hideSubtitle(){this.subtitle&&(this.subtitle.visible=!1,this.emit(3,{...this.subtitle}))}showSubtitle(){this.subtitle&&(this.subtitle.visible=!0,this.emit(3,{...this.subtitle}))}onSourceChange(e){return this.on(0,e)}onSubtitleChange(e){return this.on(3,e)}onSubtitleLoaded(e){return this.on(4,e)}onResolutionChange(e){return this.on(1,e)}onStateChange(e){return this.on(2,e)}}class ga extends q{constructor(e){super();c(this,"profile",null);c(this,"sourceGroups",[]);c(this,"curSource",null);c(this,"curGroup",null);c(this,"currentTime",0);c(this,"curResolutionType",Ce.SD);c(this,"playing",!1);c(this,"_pending",!1);c(this,"$source");c(this,"$client");c(this,"$update");c(this,"updatePlayProgress",wa(10*1e3,(e={})=>{this.updatePlayProgressForce(e)}));c(this,"_pause",Ke(800,()=>{this.playing=!1}));const{client:i,resolution:n=Ce.SD}=e;this.curResolutionType=n,this.$client=i,this.$source=new hi({resolution:n,client:i}),this.$update=new F(ti,{client:i})}get state(){return{playing:this.playing,profile:this.profile,curSource:this.curSource,groups:this.sourceGroups,curGroup:this.curGroup}}async fetchProfile(e){if(e===void 0){const f=this.tip({text:["缺少季 id 参数"]});return v.Err(f)}const n=await new F(Qs,{process:Zs,client:this.$client}).run({media_id:e,type:O.Season});if(n.error){const f=this.tip({text:["获取电视剧详情失败",n.error.message]});return v.Err(f)}const{id:a,name:o,overview:l,sourceCount:h,posterPath:u,curSource:d,sourceGroups:m}=n.data;if(d===null){const f=this.tip({text:["该电视剧尚未收录影片"]});return v.Err(f)}return this.profile={id:a,name:o,overview:l,posterPath:u},this.sourceGroups=m,this.curGroup=m.find(f=>f.cur)??null,this.emit(0,{profile:this.profile,curSource:d}),this.emit(8,{...this.state}),v.Ok({profile:this.profile,curSource:d})}fetchSeries(e){Vn({media_id:e})}async playEpisode(e,i={}){const{currentTime:n=0}=i,{id:a,files:o}=e;if(this.curSource&&a===this.curSource.id)return this.tip({text:["已经是该剧集了"]}),this.$source.profile===null?v.Err("加载视频文件失败"):v.Ok(this.$source.profile);if(o.length===0){const u=this.tip({text:["该剧集缺少视频源"]});return v.Err(u)}const l=(()=>{if(e.curFileId){const u=o.find(d=>d.id===e.curFileId);if(u)return u}return o[0]})(),h=await this.$source.load(l);return h.error?(this.tip({text:[h.error.message]}),v.Err(h.error)):(this.currentTime=n,this.curSource={...e,currentTime:n,thumbnailPath:e.stillPath,curFileId:l.id},(async()=>(this.emit(7),(await this.$source.loadSubtitle({extraSubtitleFiles:e.subtitles,currentTime:n})).error))(),this.emit(3,{...h.data,currentTime:n}),this.emit(8,{...this.state}),this.$source.profile===null?v.Err("加载视频文件失败"):v.Ok(this.$source.profile))}switchEpisode(e){return this.playEpisode(e,{currentTime:0})}async getNextEpisode(){if(this.profile===null||this.curSource===null||!this.curGroup)return v.Err("请先调用 fetchProfile 方法");const e=this.curSource,i=this.curGroup,n=this.sourceGroups.findIndex(m=>m.text===i.text),a=i.list.findIndex(m=>m.id===e.id);if(a===-1)return v.Err("在剧集组里没有找到当前剧集");if(!(a===i.list.length-1)){let m=i.list[a+1];if(m.id||(m=i.list[a+2]),m)return v.Ok(m)}if(n===this.sourceGroups.length-1)return v.Err("已经是最后一集了");const l=this.sourceGroups[n+1];if(!l)return v.Err("已经是最后一集了2");const u=await new F(ls,{process:cs,client:this.$client}).run({media_id:l.media_id,start:l.start,end:l.end});if(u.error)return v.Err(u.error);if(u.data.length===0)return v.Err("已经是最后一集了3");l.list=u.data,i.cur=!1,l.cur=!0;const d=l.list[0];return v.Ok(d)}prepareNextEpisode(){}async playNextEpisode(){if(this._pending){const n=this.tip({text:["正在加载..."]});return v.Err(n)}this.emit(4),this._pending=!0;const e=await this.getNextEpisode();if(this._pending=!1,e.error){const n=this.tip({text:[e.error.message]});return v.Err(n)}const i=e.data;return i===null?v.Err("没有找到可播放剧集"):(await this.playEpisode(i,{currentTime:0}),v.Ok(null))}async fetchEpisodeOfGroup(e){if(this.profile===null){const o=this.tip({text:["请先调用 fetchProfile"]});return v.Err(o)}const i=this.sourceGroups.find(o=>o.start===e.start&&o.end===e.end);if(!i){const o=this.tip({text:["参数错误"]});return v.Err(o)}const a=await new F(ls,{process:cs,client:this.$client}).run({media_id:this.profile.id,start:i.start,end:i.end});return a.error?v.Err(a.error):a.data.length===0?v.Err("没有剧集"):(this.curGroup&&(this.curGroup.cur=!1),i.list=a.data,i.cur=!0,this.curGroup=i,this.emit(8,{...this.state}),v.Ok(null))}setSourceFileInvalid(){if(!this.curSource)return;const e=this.curSource.files,i=this.curSource.curFileId,n=e.find(a=>a.id===i);n&&(n.invalid=!0)}async changeSourceFile(e){if(this.profile===null){const a=this.tip({text:["视频还未加载完成"]});return v.Err(a)}const i=this.curSource;if(i===null){const a=this.tip({text:["视频还未加载完成"]});return v.Err(a)}const n=await this.$source.load({id:e.id});return i.curFileId=e.id,n.error?(this.tip({text:[n.error.message]}),v.Err(n.error)):(this.emit(7),this.$source.loadSubtitle({extraSubtitleFiles:i.subtitles,currentTime:this.currentTime}),this.emit(3,{...n.data,currentTime:this.currentTime}),v.Ok(null))}changeResolution(e){if(this.profile===null){const a=this.tip({text:["视频还未加载完成"]});return v.Err(a)}const i=this.$source.changeResolution(e);if(i.error){const a=this.tip({text:[i.error.message]});return v.Err(a)}const n=i.data;return this.emit(3,{...n,currentTime:this.currentTime}),v.Ok(n)}setCurrentTime(e){this.currentTime=e}setCurResolution(e){this.curResolutionType=e}markFileInvalid(e){!this.curSource||!this.curSource.files.find(n=>n.id===e)||(this.curSource.files=this.curSource.files.map(n=>n.id===e?{...n,invalid:!0}:n))}updatePlayProgressForce(e={}){const{currentTime:i=this.currentTime,duration:n=0}=e;this.profile!==null&&this.curSource!==null&&this.$source.profile!==null&&this.$update.run({media_id:this.profile.id,media_source_id:this.curSource.id,current_time:parseFloat(i.toFixed(2)),duration:parseFloat(n.toFixed(2)),source_id:this.$source.profile.id})}handleCurTimeChange(e){var n,a;this.playing=!0;const{currentTime:i=0}=e;this.currentTime=i,(n=this.$source.subtitle)!=null&&n.visible&&((a=this.$source.$subtitle)==null||a.handleTimeChange(i)),this.updatePlayProgress(e)}getTitle(){if(this.profile&&this.curSource){const{name:e}=this.curSource,{name:i}=this.profile;return[e,i]}if(this.profile){const{name:e}=this.profile;return[e]}return[]}onSourceFileChange(e){return this.on(3,e)}onProfileLoaded(e){return this.on(0,e)}onEpisodeChange(e){return this.on(1,e)}onStateChange(e){return this.on(8,e)}beforeNextEpisode(e){return this.on(4,e)}beforeLoadSubtitle(e){return this.on(7,e)}beforePrevEpisode(e){return this.on(5,e)}beforeChangeSource(e){return this.on(6,e)}}function wa(s,r){let e=!0;return setInterval(()=>{e=!0},s),(...i)=>{e!==!1&&(r(...i),e=!1)}}var ui=(s=>(s[s.Mounted=0]="Mounted",s[s.UrlChange=1]="UrlChange",s[s.CurrentTimeChange=2]="CurrentTimeChange",s[s.BeforeAdjustCurrentTime=3]="BeforeAdjustCurrentTime",s[s.TargetTimeChange=4]="TargetTimeChange",s[s.AfterAdjustCurrentTime=5]="AfterAdjustCurrentTime",s[s.ResolutionChange=6]="ResolutionChange",s[s.VolumeChange=7]="VolumeChange",s[s.DurationChange=8]="DurationChange",s[s.RateChange=9]="RateChange",s[s.SizeChange=10]="SizeChange",s[s.Preload=11]="Preload",s[s.Ready=12]="Ready",s[s.Loaded=13]="Loaded",s[s.SourceLoaded=14]="SourceLoaded",s[s.CanPlay=15]="CanPlay",s[s.Play=16]="Play",s[s.Progress=17]="Progress",s[s.Pause=18]="Pause",s[s.BeforeLoadStart=19]="BeforeLoadStart",s[s.BeforeEnded=20]="BeforeEnded",s[s.CanSetCurrentTime=21]="CanSetCurrentTime",s[s.End=22]="End",s[s.Resize=23]="Resize",s[s.ExitFullscreen=24]="ExitFullscreen",s[s.Error=25]="Error",s[s.StateChange=26]="StateChange",s))(ui||{});class ot extends q{constructor(e){super();c(this,"metadata",null);c(this,"$app");c(this,"_timer",null);c(this,"_canPlay",!1);c(this,"_ended",!1);c(this,"_duration",0);c(this,"_currentTime",0);c(this,"_curVolume",.5);c(this,"_curRate",1);c(this,"theTimeSkip",0);c(this,"playing",!1);c(this,"poster");c(this,"subtitle",null);c(this,"_mounted",!1);c(this,"_target_current_time",0);c(this,"_subtitleVisible",!1);c(this,"prepareFullscreen",!1);c(this,"_progress",0);c(this,"virtualProgress",0);c(this,"errorMsg","");c(this,"_passPoint",!1);c(this,"_size",{width:0,height:0});c(this,"_abstractNode",null);c(this,"bindAbstractNode",e=>{this._abstractNode=e,this._abstractNode&&(this.pendingRate&&(this.changeRate(this.pendingRate),this.pendingRate=null),this._abstractNode.setVolume(this._curVolume))});c(this,"hasPlayed",!1);c(this,"play",()=>{this._abstractNode!==null&&(this.playing||(this._abstractNode.play(),this.hasPlayed=!0,this._abstractNode.setRate(this._curRate),this.playing=!0,this.emit(26,{...this.state})))});c(this,"pause",()=>{this._abstractNode!==null&&(this._abstractNode.pause(),this.playing=!1,this.emit(26,{...this.state}))});c(this,"changeVolume",e=>{this._abstractNode!==null&&(this._curVolume=e,this._abstractNode.setVolume(e),this.emit(7,{volume:e}))});c(this,"pendingRate",null);c(this,"changeRate",e=>{if(this._abstractNode===null){this.pendingRate=e;return}this._curRate=e,this._abstractNode.setRate(e),this.emit(9,{rate:e})});c(this,"tmpRate",null);c(this,"changeRateTmp",e=>{this._abstractNode!==null&&(this.tmpRate=e,this._abstractNode.setRate(e))});c(this,"recoverRate",()=>{this.tmpRate!==null&&this._abstractNode!==null&&(this.tmpRate=null,this._abstractNode.setRate(this._curRate))});c(this,"changeSkipTime",e=>{this.theTimeSkip=e,this.emit(26,{...this.state})});c(this,"showAirplay",()=>{this._abstractNode!==null&&this._abstractNode.showAirplay()});c(this,"pictureInPicture",()=>{this._abstractNode!==null&&this._abstractNode.pictureInPicture()});c(this,"toggleSubtitle",()=>{this._subtitleVisible=!this._subtitleVisible});c(this,"setPoster",e=>{e!==null&&(this.poster=e,this.emit(26,{...this.state}))});c(this,"setCurrentTime",(e=0)=>{this._abstractNode!==null&&(this._currentTime=e||0,this._abstractNode.setCurrentTime(e||0))});c(this,"speedUp",(e=10)=>{let i=this._currentTime+e;this._duration&&i>=this._duration&&(i=this._duration),this.setCurrentTime(i)});c(this,"rewind",(e=10)=>{let i=this._currentTime-e;i<=0&&(i=0),this.setCurrentTime(i)});c(this,"setSize",e=>{if(this._size.width!==0&&this._size.width===e.width&&this._size.height!==0&&this._size.height===e.height)return;const i=this.$app,{width:n,height:a}=e,o=Math.ceil(a/n*i.screen.width);Number.isNaN(o)||(this._size={width:i.screen.width,height:o},this.emit(10,{...this._size}),this.emit(26,{...this.state}))});c(this,"setResolution",e=>{this.emit(6,e)});c(this,"clearSubtitle",()=>{this.subtitle=null,this.emit(26,{...this.state})});c(this,"showSubtitle",e=>{this.subtitle=e,this.emit(26,{...this.state});const i=this._abstractNode;i&&setTimeout(()=>{this._subtitleVisible=!0,i.showSubtitle()},800)});c(this,"toggleSubtitleVisible",()=>{if(this._abstractNode){if(this._subtitleVisible){this._subtitleVisible=!1,this._abstractNode.hideSubtitle();return}this._subtitleVisible=!0,this._abstractNode.showSubtitle()}});c(this,"requestFullScreen",()=>{const e=this._abstractNode;if(e){if(this.$app.env.android||this.$app.env.weapp){this.play(),e.requestFullscreen();return}this.pause(),e.enableFullscreen(),this.play()}});c(this,"exitFullscreen",()=>{const e=this._abstractNode;e&&e.exitFullscreen()});c(this,"loadSource",e=>{this.metadata=e,this._canPlay=!1,this.errorMsg="",this.emit(1,e),this.emit(26,{...this.state})});c(this,"preloadSource",e=>{this.emit(11,{url:e})});c(this,"canPlayType",e=>this._abstractNode?this._abstractNode.canPlayType(e):!1);c(this,"load",e=>{this._canPlay=!1,this.errorMsg="",this._abstractNode&&this._abstractNode.load(e)});c(this,"startAdjustCurrentTime",()=>{this.emit(3)});c(this,"adjustProgressManually",e=>{const i=e*this._duration;this.virtualProgress=e,this.emit(4,i)});c(this,"adjustCurrentTime",e=>{this.hasPlayed&&!this.playing&&this.play();let i=e;i<0&&(i=0),i>this._duration&&(i=this._duration),this.setCurrentTime(i),this.emit(5,{time:i})});c(this,"node",()=>this._abstractNode?this._abstractNode.$node:null);c(this,"updated",!1);c(this,"handleTimeUpdate",({currentTime:e,duration:i})=>{if(this.startLoad&&!this.updated&&(this.emit(21),this.updated=!0),this._currentTime===e)return;this._currentTime=e,typeof i=="number"&&!Number.isNaN(i)&&(this._duration=i);const n=Math.floor(e/this._duration*100);if(this._progress=n,this.emit(17,{currentTime:this._currentTime,duration:this._duration,progress:this._progress}),e+10>=this._duration){if(this._passPoint)return;this.emit(20),this._passPoint=!0;return}this._passPoint=!1});c(this,"enableFullscreen",()=>{const e=this._abstractNode;e&&(this.prepareFullscreen=!0,e.enableFullscreen(),this.emit(26,{...this.state}))});c(this,"disableFullscreen",()=>{const e=this._abstractNode;e&&(this.prepareFullscreen=!1,e.disableFullscreen(),this.emit(26,{...this.state}))});c(this,"setMounted",()=>{this._mounted=!0,this.emit(0),this.emit(12)});c(this,"setInvalid",e=>{this.errorMsg=e,this.emit(26,{...this.state})});c(this,"isFullscreen",!1);c(this,"handleFullscreenChange",e=>{this.isFullscreen=e,e===!1&&this.emit(24)});c(this,"handlePause",({currentTime:e,duration:i})=>{this.emit(18,{currentTime:e,duration:i})});c(this,"handleVolumeChange",e=>{this._curVolume=e,this.emit(7,{volume:e})});c(this,"handleResize",e=>{});c(this,"startLoad",!1);c(this,"handleStartLoad",()=>{this.startLoad=!0});c(this,"handleEnded",()=>{this.playing=!1,this._ended=!0,this.emit(22,{current_time:this._currentTime,duration:this._duration})});c(this,"handleLoadedmetadata",e=>{const{width:i,height:n,duration:a}=e;this.setSize({width:i,height:n}),this._duration=a,this.emit(14,{width:i,height:n,duration:a})});c(this,"handleLoad",()=>{this.emit(13)});c(this,"handleCanPlay",(e={})=>{e.duration&&this._duration!==e.duration&&(this._duration=e.duration,this.emit(8,e.duration)),!this._canPlay&&(this._canPlay=!0,this.emit(15),this.emit(26,{...this.state}))});c(this,"handlePlay",()=>{});c(this,"handlePlaying",()=>{this.hasPlayed=!0});c(this,"handleError",e=>{this.errorMsg=e,this.emit(25,new Error(e))});c(this,"onReady",e=>this.on(12,e));c(this,"onBeforeStartLoad",e=>this.on(19,e));c(this,"onLoaded",e=>this.on(13,e));c(this,"onProgress",e=>this.on(17,e));c(this,"onCanPlay",e=>this.on(15,e));c(this,"onUrlChange",e=>this.on(1,e));c(this,"onExitFullscreen",e=>this.on(24,e));c(this,"onPreload",e=>this.on(11,e));c(this,"onBeforeEnded",e=>this.on(20,e));c(this,"onSizeChange",e=>this.on(10,e));c(this,"onVolumeChange",e=>this.on(7,e));c(this,"onRateChange",e=>this.on(9,e));c(this,"onDurationChange",e=>this.on(8,e));c(this,"onPause",e=>this.on(18,e));c(this,"onResolutionChange",e=>this.on(6,e));c(this,"onCanSetCurrentTime",e=>this.on(21,e));c(this,"beforeAdjustCurrentTime",e=>this.on(3,e));c(this,"afterAdjustCurrentTime",e=>this.on(5,e));c(this,"onPlay",e=>this.on(16,e));c(this,"onSourceLoaded",e=>this.on(14,e));c(this,"onTargetTimeChange",e=>this.on(4,e));c(this,"onCurrentTimeChange",e=>this.on(2,e));c(this,"onEnd",e=>this.on(22,e));c(this,"onError",e=>this.on(25,e));c(this,"onStateChange",e=>this.on(26,e));c(this,"onMounted",e=>this.on(0,e));const{app:i,volume:n,rate:a,skipTime:o}=e;n&&(this._curVolume=n),o&&(this.theTimeSkip=o),a&&(this._curRate=a),this.$app=i}get currentTime(){return this._currentTime}get state(){return{playing:this.playing,poster:this.poster,width:this._size.width,height:this._size.height,ready:this._canPlay,error:this.errorMsg,rate:this._curRate,volume:this._curVolume,currentTime:this._currentTime,subtitle:this.subtitle,prepareFullscreen:this.prepareFullscreen,skip:this.theTimeSkip,skipText:this.theTimeSkip?Rs(this.theTimeSkip):""}}async screenshot(){return v.Err("请实现 screenshot 方法")}}c(ot,"Events",ui);function va(s){const{app:r,storage:e,client:i,view:n}=s,a=e.get("player_settings"),{type:o,volume:l,rate:h,skip:u}=a,d=new ga({client:i,resolution:o}),m=new ot({app:r,volume:l,rate:h,skipTime:u[n.query.id]}),f=new li({app:r,client:i});return r.onHidden(()=>{m.pause()}),r.onShow(()=>{m.setCurrentTime(m.currentTime)}),r.onOrientationChange(x=>{if(x==="horizontal"){if(!m.hasPlayed&&r.env.ios||m.isFullscreen)return;m.requestFullScreen(),m.isFullscreen=!0}if(x==="vertical"&&(m.disableFullscreen(),d.$source.profile)){const{width:g,height:w}=d.$source.profile;m.setSize({width:g,height:w})}}),m.onExitFullscreen(()=>{m.pause(),r.orientation===Rt.Vertical&&m.disableFullscreen()}),d.onProfileLoaded(x=>{r.setTitle(d.getTitle().join(" - "));const{curSource:g}=x;d.playEpisode(g,{currentTime:g.currentTime??0}),m.setCurrentTime(g.currentTime)}),d.$source.onSubtitleLoaded(x=>{m.showSubtitle(ci(x))}),d.onEpisodeChange(x=>{r.setTitle(d.getTitle().join(" - "));const{currentTime:g}=x;m.setCurrentTime(g),m.pause()}),d.onTip(x=>{r.tip(x)}),d.beforeNextEpisode(()=>{m.pause()}),d.beforeLoadSubtitle(()=>{m.clearSubtitle()}),d.onSourceFileChange(x=>{m.pause(),m.setSize({width:x.width,height:x.height}),e.merge("player_settings",{type:x.type}),m.loadSource(x)}),m.onReady(()=>{m.disableFullscreen()}),m.onCanPlay(()=>{const{currentTime:x}=d;function g(){m.setCurrentTime(x===0?m.theTimeSkip:x),a.rate&&m.changeRate(Number(h))}(async()=>(r.env.android&&await ke(1e3),g()))(),m.hasPlayed&&m.play()}),m.onVolumeChange(({volume:x})=>{e.merge("player_settings",{volume:x})}),m.onProgress(({currentTime:x,duration:g})=>{m._canPlay&&d.handleCurTimeChange({currentTime:x,duration:g})}),m.onPause(({currentTime:x,duration:g})=>{d.updatePlayProgressForce({currentTime:x,duration:g})}),m.onEnd(()=>{d.playNextEpisode()}),m.onResolutionChange(({type:x})=>{}),m.onSourceLoaded(()=>{m.setCurrentTime(d.currentTime),m.hasPlayed}),m.onError(async x=>{d.setSourceFileInvalid(),await(async()=>{if(!d.profile||!d.curSource)return;const g=d.curSource.files,w=d.curSource.curFileId,j=g.findIndex(k=>k.id===w)+1,y=g[j];if(!y){f.$ref.select("无法播放"),f.$media.select({media_id:d.profile.id,media_source_id:d.curSource.id}),m.setInvalid(x.message);return}await d.changeSourceFile(y)})(),m.pause()}),m.onUrlChange(async({url:x})=>{m.load(x)}),n.query.rate&&m.changeRate(Number(n.query.rate)),n.onHidden(()=>{m.pause()}),{$tv:d,$player:m,$mediaReport:f,ready(){d.fetchProfile(n.query.id)},changeSkipTime(x){m.changeSkipTime(x);const g={...u,[n.query.id]:x};e.merge("player_settings",{skip:g})},handleClickElm(x){var p;const{elm:g,value:w}=x;if(g){if(g==="play-menu"){m.play();return}if(g==="pause-menu"){m.pause();return}if(g==="arrow-left-menu"){history.back();return}if(g==="skip-forward-menu"){d.playNextEpisode();return}if(g==="subtitle-menu"){if(d.$source.subtitle===null)return;m.toggleSubtitleVisible(),d.$source.toggleSubtitleVisible();return}if(g==="skip-menu"){const j=d.currentTime,y=Number(j);this.changeSkipTime(y),r.tip({text:[`设置片头跳过 ${Rs(y)}`]});return}if(g==="copy-media-url-btn"){if(d.$source.profile){r.copy((p=d.$source.profile)==null?void 0:p.url),r.tip({text:["复制成功"]});return}r.tip({text:["暂无播放地址"]});return}g==="report-media-error-btn"&&f.$dialog.show()}}}}class ja{constructor(r){c(this,"$view");c(this,"$scroll");c(this,"$mask",new Z({mounted:!0,visible:!0}));c(this,"$top",new Z({mounted:!0,visible:!0}));c(this,"$bottom",new Z({mounted:!0,visible:!0}));c(this,"$control",new Z({mounted:!0,visible:!0}));c(this,"$subtitle",new Z({}));c(this,"$tmpRateTip",new Z({}));c(this,"$settings",new V);c(this,"$episodes",new V);c(this,"$nextEpisode",new st({value:1}));c(this,"$icon",new st({value:1}));c(this,"$episode",new we({value:1}));c(this,"visible",!0);c(this,"timer",null);const{app:e,view:i}=r;this.$view=i,this.$scroll=new Q({os:e.env})}showControls(){this.visible=!0,this.$top.show(),this.$bottom.show(),this.$control.show(),this.$mask.show()}hideControls(){this.visible=!1,this.$top.hide({destroy:!1}),this.$bottom.hide({destroy:!1}),this.$control.hide(),this.$mask.hide()}toggleControls(){if(this.visible){this.hideControls();return}this.showControls()}attemptToShowControls(){return this.timer!==null?(this.hideControls(),clearTimeout(this.timer),this.timer=null,!1):(this.showControls(),!0)}prepareHideControls(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.hideControls(),this.timer=null},3e3)}prepareToggleControls(){if(this.timer===null){this.toggleControls();return}clearTimeout(this.timer),this.toggleControls()}stopHideControls(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}}const ba=L.memo(s=>{var g,w;const{app:r,client:e,history:i,storage:n,view:a}=s,o=H(()=>va(s)),l=H(()=>new ja({app:r,view:a})),h=H(()=>new He({onLongPress(){o.$tv.playing&&(l.$tmpRateTip.show(),o.$player.changeRateTmp(2))},onLongPressFinish(){l.$tmpRateTip.hide(),o.$player.recoverRate()}})),[u,d]=N.useState(o.$tv.state),[m,f]=N.useState(o.$player.state),x=N.useCallback(p=>{const j=p.currentTarget;if(j===null)return;const{elm:y,stop:k,value:b}=j.dataset;y&&(k&&p.stopPropagation(),o.handleClickElm({elm:y,value:b}))},[]);return D(()=>{o.$player.onStateChange(p=>f(p)),o.$tv.onStateChange(p=>d(p)),o.$player.beforeAdjustCurrentTime(()=>{l.stopHideControls()}),o.$player.onExitFullscreen(()=>{l.showControls()}),o.ready()}),t.jsxs(t.Fragment,{children:[t.jsxs(se,{store:l.$scroll,className:"fixed h-screen bg-w-bg-0 scroll--hidden",onClick:()=>{l.prepareToggleControls()},children:[t.jsxs("div",{className:"absolute z-10 top-[36%] left-[50%] w-full min-h-[120px] -translate-x-1/2 -translate-y-1/2",children:[t.jsx(Ft,{store:o.$player}),t.jsx(ce,{className:"z-20 absolute inset-0",enterClassName:"animate-in fade-in",exitClassName:"animate-out fade-out",store:l.$mask,children:t.jsx("div",{className:"absolute inset-0 bg-w-fg-1 dark:bg-black opacity-20"})}),t.jsx("div",{className:"absolute z-30 top-[50%] left-[50%] min-h-[64px] text-w-bg-0 dark:text-w-fg-0 -translate-x-1/2 -translate-y-1/2",onClick:p=>{p.stopPropagation()},children:t.jsx(ce,{enterClassName:"animate-in fade-in",exitClassName:"animate-out fade-out",store:l.$control,children:t.jsx(M,{when:!m.error,fallback:t.jsxs("div",{className:"flex flex-col justify-center items-center",children:[t.jsx(pe,{className:"w-16 h-16"}),t.jsxs("div",{className:"flex items-center mt-4",onClick:p=>{p.stopPropagation(),i.push("root.help",{highlight:""})},children:[t.jsx("div",{className:"text-center",children:m.error}),t.jsx("div",{className:"ml-2",children:t.jsx(Tt,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex items-center mt-4 space-x-4 text-center text-sm",children:[t.jsx("div",{"data-elm":"report-media-error-btn","data-stop":"1",onClick:x,children:"反馈问题"}),t.jsx("div",{"data-elm":"copy-media-url-btn","data-stop":"1",onClick:x,children:"复制播放地址"})]})]}),children:t.jsx(M,{when:!!m.ready,fallback:t.jsx(ze,{className:"w-16 h-16 animate animate-spin"}),children:t.jsxs("div",{className:"flex items-center space-x-8",onClick:p=>{p.stopPropagation()},children:[t.jsxs("div",{className:"relative",onClick:()=>{o.$player.rewind(),l.prepareHideControls()},children:[t.jsx(Ss,{className:"w-12 h-12"}),t.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 text-center text-sm",children:"10s"})]}),t.jsx("div",{className:"p-2",children:t.jsx(M,{when:m.playing,fallback:t.jsx("div",{onClick:()=>{o.$player.play(),l.prepareHideControls()},children:t.jsx(ks,{className:"relative left-[6px] w-20 h-20"})}),children:t.jsx("div",{onClick:()=>{o.$player.pause()},children:t.jsx(Cs,{className:"w-20 h-20"})})})}),t.jsxs("div",{className:"relative",onClick:()=>{o.$player.speedUp(),l.prepareHideControls()},children:[t.jsx(et,{className:"w-12 h-12"}),t.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 text-center text-sm",children:"10s"})]})]})})})})})]}),t.jsxs(at,{store:h,className:"__a absolute z-0 inset-0 text-w-fg-0",children:[t.jsx("div",{className:"absolute top-0 z-40 w-full",onClick:p=>{p.stopPropagation()},children:t.jsx(ce,{store:l.$top,className:"",enterClassName:"animate-in fade-in slide-in-from-top",exitClassName:"animate-out slide-out-to-top fade-out",onClick:p=>{p.stopPropagation()},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center",onTouchEnd:()=>{i.back()},children:[t.jsx("div",{className:"inline-block p-4",children:t.jsx(je,{className:"w-6 h-6"})}),t.jsx(M,{when:!!u.curSource,children:t.jsxs("div",{className:"max-w-[248px] truncate break-all",children:[(g=u.curSource)==null?void 0:g.order,"、",(w=u.curSource)==null?void 0:w.name]})})]}),t.jsx(M,{when:r.env.ios,children:t.jsx("div",{className:"flex items-center",children:t.jsx("div",{className:"inline-block p-4",onClick:p=>{o.$player.showAirplay()},children:t.jsx($s,{className:"w-6 h-6"})})})})]})})}),t.jsx("div",{className:"absolute bottom-12 z-40 w-full safe-bottom",onClick:p=>{p.stopPropagation()},children:t.jsxs(ce,{className:"",enterClassName:"animate-in slide-in-from-bottom fade-in",exitClassName:"animate-out slide-out-to-bottom fade-out",store:l.$bottom,children:[t.jsx("div",{className:"px-4",children:t.jsx(ii,{store:o.$player})}),t.jsxs("div",{className:"flex items-center flex-reverse space-x-4 mt-6 w-full px-2",onClick:p=>{p.stopPropagation()},children:[t.jsxs("div",{className:"flex items-center p-2 rounded-md space-x-2",onClick:()=>{l.$episodes.show()},children:[t.jsx(zi,{className:"w-6 h-6"}),t.jsx("div",{className:"",children:"选集"})]}),t.jsx("div",{className:"relative p-2 rounded-md space-x-2",onClick:async()=>{l.$nextEpisode.set(2),await o.$tv.playNextEpisode(),l.$nextEpisode.set(1)},children:t.jsx(de,{store:l.$nextEpisode,options:[{value:1,content:t.jsx(Hi,{className:"w-6 h-6"})},{value:2,content:t.jsx("div",{children:t.jsx(J,{className:"w-6 h-6 animate animate-spin"})})}]})}),t.jsx("div",{className:"relative p-2 rounded-md cursor-pointer","data-elm":"skip-menu",onClick:x,children:m!=null&&m.skipText?t.jsx("div",{children:m==null?void 0:m.skipText}):t.jsx("div",{children:"片头时间"})}),t.jsx("div",{className:"relative p-2 rounded-md",onClick:()=>{l.$settings.show()},children:t.jsx(_s,{className:"w-6 h-6"})}),t.jsx("div",{className:"relative p-2 rounded-md",onClick:()=>{o.$player.requestFullScreen()},children:t.jsx(Ts,{className:"w-6 h-6"})})]})]})}),t.jsx(ce,{store:l.$tmpRateTip,children:t.jsx("div",{className:"absolute left-1/2 bottom-[24%] -translate-x-1/2 text-center",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(et,{className:"w-8 h-8"}),t.jsx("div",{children:"2x速 快进中"})]})})})]})]}),t.jsx(Ge,{store:l.$episodes,className:"",size:"lg",children:(()=>u.profile===null?t.jsx("div",{children:"Loading"}):u.groups.length===0?null:t.jsxs("div",{className:"relative box-border h-full px-4 safe-bottom",children:[t.jsx("div",{className:"flex space-x-2 max-w-full overflow-x-auto scroll--hidden",children:u.groups.map(p=>{var k;const{text:j,list:y}=p;return t.jsx("div",{className:_("p-2 whitespace-nowrap",((k=u.curGroup)==null?void 0:k.text)===j?"underline":""),onClick:()=>{o.$tv.fetchEpisodeOfGroup(p)},children:j},j)})}),t.jsx("div",{className:"grid gap-2 grid-cols-6",children:(()=>u.curGroup?u.curGroup.list.map(p=>{var k;const{id:j,order:y}=p;return t.jsx("div",{className:_("relative flex justify-center items-center w-12 h-12 p-2 rounded-md bg-w-fg-3",{}),onClick:async()=>{if(!j){r.tip({text:["该集无法播放，请反馈后等待处理"]});return}l.$episode.select(j),l.$episode.set(2),await o.$tv.switchEpisode(p),l.$episode.set(1),l.$episode.clear(),l.$episodes.hide()},children:j?t.jsx(de,{store:l.$episode.bind(j),options:[{value:1,content:t.jsx(M,{when:((k=u.curSource)==null?void 0:k.id)===j,fallback:t.jsx("div",{children:y}),children:t.jsxs("div",{children:[t.jsx("div",{className:"absolute right-1 top-1 text-w-fg-1",style:{fontSize:10},children:y}),t.jsx(ia,{})]})})},{value:2,content:t.jsx("div",{children:t.jsx(J,{className:"w-5 h-5 animate animate-spin"})})}]}):t.jsx("div",{className:"opacity-20",children:y})},y)}):null)()})]}))()}),t.jsx(Ge,{store:l.$settings,hideTitle:!0,size:"lg",children:t.jsx(ca,{$media:o.$tv,app:r,client:e,storage:n,history:i,$player:o.$player})}),t.jsx(G,{store:o.$mediaReport.$dialog,children:t.jsx("div",{className:"text-w-fg-1",children:t.jsx("p",{className:"mt-2",children:"「无法播放」"})})})]})}),ya=[{value:1,title:"分辨率"},{value:2,title:"视频源"},{value:3,title:"字幕列表"},{value:4,title:"播放倍率"},{value:5,title:"分享"},{value:6,title:"反馈问题"}];function Na(s){const{$media:r,$player:e,app:i,client:n,history:a,storage:o}=s,l=ni({shareLink:""}),h=new F(Js,{client:n,onLoading(b){p.submitBtn.setLoading(b)},onSuccess(b){const{name:P,token:T}=b;if(!r.profile){i.tip({text:["详情未加载"]});return}const I=a.buildURLWithPrefix("root.movie_playing",{id:r.profile.id,token:T,tmp:"1"});j.show();const $=`➤➤➤ ${P}
${a.$router.origin}${I}`;l.shareLink=$},onFailed(b){i.tip({text:["分享失败",b.message]})}}),u=new F(Ye,{client:n,onLoading(b){k.okBtn.setLoading(b)},onSuccess(){i.tip({text:["提交成功"]}),k.hide()},onFailed(b){i.tip({text:["提交失败",b.message]})}}),d=new He,m=new we({value:2}),f=new we({value:2}),x=new we({value:2}),g=new we({value:2}),w=new Q({os:i.env,async onPullToRefresh(){await p.$list.refresh(),w.finishPullToRefresh()}}),p=new ri({client:n,onSelect(b){if(!r.profile){i.tip({text:["请选择要分享的影视剧"]});return}j.show(),h.run({media_id:r.profile.id,target_member_id:b.id})}}),j=new V({footer:!1}),y=new xe({}),k=new V({title:"发现问题",onOk(){var b;if(!r.profile){i.tip({text:["影视剧信息还未加载"]});return}if(!y.value){i.tip({text:["请先选择问题"]});return}u.run({type:Le.Season,data:y.value,media_id:r.profile.id,media_source_id:(b=r.curSource)==null?void 0:b.id})}});return{state:l,inviteeSelect:p,curReport:y,reportRequest:u,ui:{$scroll:w,wrap:d,sourceIcon:m,fileIcon:f,rateIcon:x,subtitleIcon:g,reportConfirmDialog:k,shareDialog:j},subscribe:ai}}const Sa=s=>{const{$media:r,$player:e,app:i,client:n,history:a,storage:o}=s,l=H(()=>Na(s)),[h,u]=N.useState(1),[d,m]=N.useState(r.state),[f,x]=N.useState(r.$source.profile),[g,w]=N.useState(e.state),[p,j]=N.useState(r.$source.subtitle),[y,k]=N.useState(e._curRate),[b,P]=N.useState(l.inviteeSelect.$list.response),[T,I]=N.useState(l.state.shareLink),[$,R]=N.useState(l.curReport.value),C=S=>{u(S),l.ui.wrap.setStyles("transform: translate(-100%);")},B=()=>{l.ui.wrap.setStyles("transform: translate(0);")};return D(()=>{r.onStateChange(S=>m(S)),r.onSourceFileChange(S=>x(S)),r.$source.onSubtitleChange(S=>j(S)),e.onRateChange(S=>k(S.rate)),e.onStateChange(S=>w(S)),l.subscribe(l.state,S=>I(oi(l.state).shareLink)),l.curReport.onChange(S=>R(S)),l.inviteeSelect.onResponseChange(S=>P(S))}),t.jsxs("div",{className:"overflow-hidden h-full",children:[t.jsxs(at,{className:"flex h-full transition-transform duration-500 ease-in-out",store:l.ui.wrap,children:[t.jsxs("div",{className:"panel__home w-full flex-shrink-0",children:[t.jsx("div",{className:"space-x-2 px-4",children:t.jsx("div",{className:"flex items-center mt-2 h-12",children:t.jsx("div",{className:"text-xl",children:"设置"})})}),t.jsx("div",{className:"h-[1px] bg-w-bg-1"}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{C(1)},children:[t.jsx("div",{children:"分辨率"}),t.jsxs("div",{className:"flex items-center text-w-fg-1",children:[t.jsx(M,{when:!!(f!=null&&f.typeText),children:t.jsx("div",{className:"px-2",children:f==null?void 0:f.typeText})}),t.jsx(oe,{className:"w-5 h-5"})]})]}),t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{C(2)},children:[t.jsx("div",{children:"视频源"}),t.jsx("div",{className:" text-w-fg-1",children:t.jsx(oe,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{p!==null&&C(3)},children:[t.jsx("div",{children:"字幕列表"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"px-4",onClick:S=>{S.stopPropagation(),p!==null&&(e.toggleSubtitleVisible(),r.$source.toggleSubtitleVisible())},children:(()=>p===null?t.jsx("span",{className:"text-w-fg-2",children:"暂无字幕"}):p.visible?"禁用":"启用")()}),t.jsx("div",{className:_(p===null?"text-w-fg-2":"text-w-fg-1"),onClick:()=>{p!==null&&C(3)},children:t.jsx(oe,{className:"w-5 h-5"})})]})]}),t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{C(4)},children:[t.jsx("div",{children:"播放倍率"}),t.jsxs("div",{className:"flex items-center space-x-2 text-w-fg-1",children:[t.jsxs("div",{className:"px-2",children:[g.rate,"x"]}),t.jsx(oe,{className:"w-5 h-5"})]})]}),t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{C(5),l.inviteeSelect.$list.init()},children:[t.jsx("div",{children:"分享"}),t.jsx("div",{className:"flex items-center space-x-2 text-w-fg-1",children:t.jsx(oe,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",onClick:()=>{C(6)},children:[t.jsx("div",{children:"反馈问题"}),t.jsx("div",{className:"flex items-center space-x-2 text-w-fg-1",children:t.jsx(oe,{className:"w-5 h-5"})})]})]})]}),t.jsxs("div",{className:"panel__second relative w-full h-full flex-shrink-0",children:[t.jsx("div",{className:"flex items-center justify-between mt-2 h-12 px-4 bg-w-bg-2",children:t.jsxs("div",{className:"flex items-center space-x-1",onClick:()=>{B()},children:[t.jsx(Ns,{className:"w-6 h-6"}),t.jsxs("div",{className:"flex items-center space-x-2 text-lg",children:[t.jsx("div",{className:"text-w-fg-2",children:"设置"}),t.jsx("div",{children:"/"}),t.jsx("div",{children:(()=>{const S=ya.find(E=>E.value===h);return S?S.title:null})()})]})]})}),t.jsx("div",{className:"h-[1px] bg-w-bg-1"}),t.jsx(se,{className:"absolute top-16 bottom-0 left-0 w-full h-auto",store:l.ui.$scroll,children:(()=>{if(h===1)return t.jsx("div",{children:(()=>{if(!f||!f.resolutions.length)return t.jsx("div",{className:"flex items-center justify-center p-12",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(Re,{className:"w-24 h-24"}),t.jsx("div",{className:"mt-2 text-center",children:"暂无可切换的分辨率"})]})});const{typeText:S,resolutions:E}=f;return t.jsx("div",{className:"max-h-full text-w-fg-1 px-4 overflow-y-auto",children:t.jsx("div",{className:"pb-24",children:E.map((U,ne)=>{const{type:ae,typeText:$e}=U;return t.jsxs("div",{className:_("flex items-center justify-between p-4 rounded-md cursor-pointer",S===$e?"bg-w-bg-active":""),onClick:async()=>{if(l.ui.sourceIcon.select(ae),l.ui.sourceIcon.set(3),(await r.changeResolution(ae)).error){l.ui.sourceIcon.set(5);return}l.ui.sourceIcon.set(2),l.ui.sourceIcon.clear(),o.merge("player_settings",{type:ae})},children:[t.jsx("div",{children:$e}),t.jsx(de,{className:"ml-4",store:l.ui.sourceIcon.bind(ae),options:[{value:1,content:null},{value:2,content:t.jsx(M,{when:S===$e,children:t.jsx("div",{children:t.jsx(Se,{className:"w-6 h-6"})})})},{value:3,content:t.jsx(J,{className:"w-6 h-6 animate animate-spin"})},{value:4,content:t.jsx(_e,{className:"w-6 h-6"})},{value:5,content:t.jsx(pe,{className:"w-6 h-6"})}]})]},ne)})})})})()});if(h===2)return t.jsx("div",{children:(()=>d===null?t.jsx("div",{className:"flex items-center justify-center p-12",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(J,{className:"w-24 h-24 animate animate-spin"}),t.jsx("div",{className:"mt-2 text-center",children:"Loading"})]})}):d.curSource?t.jsx("div",{className:"max-h-full overflow-y-auto px-4 text-w-fg-1",children:t.jsx("div",{className:"pb-24",children:d.curSource.files.map(S=>{const{id:E,name:U,invalid:ne}=S;return t.jsxs("div",{className:_("flex items-center justify-between p-4 rounded-md cursor-pointer",(f==null?void 0:f.id)===E?"bg-w-bg-active":""),onClick:async()=>{if((f==null?void 0:f.id)===E)return;if(l.ui.fileIcon.select(E),l.ui.fileIcon.set(3),(await r.changeSourceFile(S)).error){l.ui.fileIcon.set(5),l.ui.fileIcon.clear();return}l.ui.fileIcon.set(2),l.ui.fileIcon.clear()},children:[t.jsx("div",{className:"break-all",children:U}),t.jsx(de,{className:"ml-4",store:l.ui.fileIcon.bind(E),options:[{value:1,content:null},{value:2,content:t.jsx(M,{when:ne||!!(f!=null&&f.invalid),fallback:t.jsx(M,{when:(f==null?void 0:f.id)===E,children:t.jsx("div",{children:t.jsx(Se,{className:"w-6 h-6"})})}),children:t.jsx(pe,{className:"w-6 h-6"})})},{value:3,content:t.jsx(J,{className:"w-6 h-6 animate animate-spin"})},{value:4,content:t.jsx(_e,{className:"w-6 h-6"})},{value:5,content:t.jsx(pe,{className:"w-6 h-6"})}]})]},E)})})}):t.jsx("div",{className:"flex items-center justify-center p-12",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(Re,{className:"w-24 h-24"}),t.jsx("div",{className:"mt-2 text-center",children:"没有可切换的视频源"})]})}))()});if(h===4)return t.jsx("div",{children:(()=>t.jsx("div",{className:"max-h-full overflow-y-auto px-4 text-w-fg-1",children:t.jsx("div",{className:"pb-24",children:[.5,.75,1,1.25,1.5,2].map((S,E)=>t.jsxs("div",{className:_("flex items-center justify-between p-4 rounded-md cursor-pointer",y===S?"bg-w-bg-active":""),onClick:()=>{l.ui.rateIcon.select(S),l.ui.rateIcon.set(2),e.changeRate(S),l.ui.rateIcon.clear(),o.merge("player_settings",{rate:S})},children:[t.jsxs("div",{className:"break-all",children:[S,"x"]}),t.jsx(de,{className:"ml-4",store:l.ui.rateIcon.bind(S),options:[{value:1,content:null},{value:2,content:t.jsx(M,{when:y===S,children:t.jsx("div",{children:t.jsx(Se,{className:"w-6 h-6"})})})},{value:3,content:t.jsx(J,{className:"w-6 h-6 animate animate-spin"})}]})]},E))})}))()});if(h===3)return t.jsx("div",{children:(()=>t.jsx("div",{className:"max-h-full overflow-y-auto px-4 text-w-fg-1",children:t.jsx("div",{className:"pb-24",children:r.$source.subtitles.map((S,E)=>t.jsxs("div",{className:_("flex items-center justify-between p-4 rounded-md cursor-pointer",S.url===(p==null?void 0:p.url)?"bg-w-bg-active":""),onClick:async()=>{if(l.ui.subtitleIcon.select(S.id),l.ui.subtitleIcon.set(3),(await r.$source.loadSubtitleFile(S,r.currentTime)).error){l.ui.subtitleIcon.set(5),l.ui.subtitleIcon.clear();return}l.ui.subtitleIcon.set(4),l.ui.subtitleIcon.clear()},children:[t.jsx("div",{className:"w-full break-all truncate",children:S.language.join("&")}),t.jsx(de,{className:"ml-4",store:l.ui.subtitleIcon.bind(S.id),options:[{value:1,content:null},{value:2,content:t.jsx(M,{when:S.url===(p==null?void 0:p.url),children:t.jsx("div",{children:t.jsx(Se,{className:"w-6 h-6"})})})},{value:3,content:t.jsx(J,{className:"w-6 h-6 animate animate-spin"})},{value:4,content:t.jsx(_e,{className:"w-6 h-6"})},{value:5,content:t.jsx(pe,{className:"w-6 h-6"})}]})]},E))})}))()});if(h===5)return t.jsx("div",{children:(()=>t.jsx("div",{className:"max-h-full overflow-y-auto text-w-fg-1",children:t.jsx("div",{className:"pb-24",children:t.jsx(me,{wrapClassName:"flex-1 overflow-y-auto",className:"max-h-full flex flex-col h-full",store:l.inviteeSelect.$list,skeleton:t.jsxs("div",{className:"flex items-center justify-between space-x-2 p-4 rounded-md cursor-pointer",children:[t.jsx("div",{className:"w-8 h-8 bg-slate-300 rounded-full",children:t.jsx(z,{className:"w-[32px] h-[32px]"})}),t.jsx("div",{className:"flex-1",children:t.jsx(z,{className:"h-[32px] w-[180px]"})})]}),children:t.jsx("div",{className:"space-y-4 flex-1 overflow-y-auto",children:b.dataSource.map(S=>{const{id:E,remark:U}=S;return t.jsxs("div",{className:"flex items-center justify-between space-x-2 p-4 rounded-md cursor-pointer",onClick:()=>{l.inviteeSelect.select(S)},children:[t.jsx("div",{className:"flex items-center justify-between bg-slate-300 rounded-full",children:t.jsx("div",{className:"w-8 h-8 text-xl text-center text-slate-500",children:U.slice(0,1).toUpperCase()})}),t.jsx("div",{className:"flex-1 w-0",children:t.jsx("h2",{className:"",children:U})})]},E)})})})})}))()});if(h===6)return t.jsx("div",{children:(()=>t.jsx("div",{className:"max-h-full overflow-y-auto px-4 text-w-fg-1",children:t.jsx("div",{className:"pb-24",children:Ms.map((S,E)=>t.jsx("div",{className:"flex items-center justify-between p-4 rounded-md cursor-pointer",onClick:()=>{l.curReport.select(S),l.ui.reportConfirmDialog.show()},children:t.jsx("div",{children:S})},E))})}))()})})()})]})]}),t.jsx(G,{store:l.ui.shareDialog,children:t.jsx("div",{className:"relative w-full h-[160px]",onClick:()=>{T&&(i.copy(T),i.tip({text:["已复制至粘贴板"]}),l.ui.shareDialog.hide())},children:(()=>T?t.jsxs("div",{className:"text-center",children:[t.jsx("div",{children:"点击复制该信息至粘贴板"}),t.jsx("div",{className:"mt-4 rounded-md p-4 bg-w-bg-2",children:t.jsx("pre",{className:"text-left break-all whitespace-normal text-w-fg-1",children:T})})]}):t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx(ze,{className:"w-12 h-12 animate animate-spin"})}))()})}),t.jsx(G,{store:l.ui.reportConfirmDialog,children:t.jsxs("div",{className:"text-w-fg-1",children:[t.jsx("p",{children:"提交你发现的该电影的问题"}),t.jsxs("p",{className:"mt-2 text-xl",children:["「",$,"」"]})]})})]})};class ka extends q{constructor(e){super();c(this,"profile",null);c(this,"curSource",null);c(this,"currentTime",0);c(this,"currentFixTime",0);c(this,"curResolutionType",Ce.SD);c(this,"playing",!1);c(this,"_pending",!1);c(this,"played",!1);c(this,"canAutoPlay",!1);c(this,"$source");c(this,"$client");c(this,"$update");c(this,"updatePlayProgress",Ca(10*1e3,(e={})=>{this.updatePlayProgressForce(e)}));c(this,"handleCurTimeChange",(e={})=>{var n,a;const{currentTime:i=0}=e;this.playing=!0,this._pause(),this.currentTime=i,(n=this.$source.subtitle)!=null&&n.visible&&((a=this.$source.$subtitle)==null||a.handleTimeChange(i+this.currentFixTime)),this.updatePlayProgress(e)});c(this,"_pause",Ke(800,()=>{this.playing=!1}));const{client:i,resolution:n=Ce.SD}=e;this.$client=i,this.$source=new hi({resolution:n,client:i}),this.$update=new F(ti,{client:i})}get state(){return{profile:this.profile,playing:this.playing,curSource:this.curSource,fixTime:this.currentFixTime}}async fetchProfile(e){if(e===void 0){const d=this.tip({text:["缺少电影 id 参数"]});return v.Err(d)}const n=await new F(Qs,{process:Zs,client:this.$client}).run({media_id:e,type:O.Movie});if(n.error){const d=this.tip({text:["获取电视剧详情失败",n.error.message]});return v.Err(d)}const{id:a,name:o,overview:l,posterPath:h,curSource:u}=n.data;if(this.profile={id:a,name:o,overview:l,posterPath:h},u===null){const d=this.tip({text:["当前没有可播放的视频源"]});return v.Err(d)}return this.emit(0,{profile:this.profile,curSource:u}),this.emit(3,{...this.state}),v.Ok({...this.profile})}async playSource(e,i){const{currentTime:n=0}=i;if(!this.profile){const u=this.tip({text:["请先调用 fetchProfile 获取详情"]});return v.Err(u)}const{id:a,files:o}=e;if(this.curSource&&a===this.curSource.id)return this.tip({text:["已经是该剧集了"]}),v.Ok(this.curSource);if(o.length===0){const u=this.tip({text:["该剧集缺少视频源"]});return v.Err(u)}const l=(()=>{if(e.curFileId){const u=o.find(d=>d.id===e.curFileId);if(u)return u}return o[0]})();this.curSource={...e,currentTime:n,thumbnailPath:e.stillPath,curFileId:l.id};const h=await this.$source.load(l);if(h.error){const u=this.tip({text:[h.error.message]});return v.Err(u)}return this.currentTime=n,this.curSource={...e,currentTime:n,thumbnailPath:e.stillPath,curFileId:h.data.id},(async()=>(this.emit(2),(await this.$source.loadSubtitle({extraSubtitleFiles:e.subtitles,currentTime:n})).error))(),this.emit(1,{...h.data,currentTime:n}),this.emit(3,{...this.state}),v.Ok(h.data)}setSourceFileInvalid(){if(!this.curSource)return;const e=this.curSource.files,i=this.curSource.curFileId,n=e.find(a=>a.id===i);n&&(n.invalid=!0)}async changeSourceFile(e){if(this.profile===null){const a=this.tip({text:["视频还未加载完成"]});return v.Err(a)}const i=this.curSource;if(i===null){const a=this.tip({text:["视频还未加载完成"]});return v.Err(a)}const n=await this.$source.load({id:e.id});return i.curFileId=e.id,n.error?(this.tip({text:[n.error.message]}),v.Err(n.error)):(this.emit(2),this.$source.loadSubtitle({extraSubtitleFiles:i.subtitles,currentTime:this.currentTime}),this.emit(1,{...n.data,currentTime:this.currentTime}),v.Ok(null))}changeResolution(e){if(this.profile===null){const a=this.tip({text:["视频还未加载完成"]});return v.Err(a)}const i=this.$source.changeResolution(e);if(i.error){const a=this.tip({text:[i.error.message]});return v.Err(a)}const n=i.data;return this.emit(1,{...n,currentTime:this.currentTime}),v.Ok(n)}setCurResolution(e){this.curResolutionType=e}setCurrentTime(e){this.currentTime=e}updatePlayProgressForce(e={}){const{currentTime:i=this.currentTime,duration:n=0}=e;this.profile&&this.curSource!==null&&this.$source.profile!==null&&this.$update.run({media_id:this.profile.id,media_source_id:this.curSource.id,current_time:parseFloat(i.toFixed(2)),duration:parseFloat(n.toFixed(2)),source_id:this.$source.profile.id})}minFixTime(e=1){var i,n;this.currentFixTime-=e,(i=this.$source.subtitle)!=null&&i.visible&&((n=this.$source.$subtitle)==null||n.handleTimeChange(this.currentTime+this.currentFixTime)),this.emit(3,{...this.state})}addFixTime(e=1){var i,n;this.currentFixTime+=e,(i=this.$source.subtitle)!=null&&i.visible&&((n=this.$source.$subtitle)==null||n.handleTimeChange(this.currentTime+this.currentFixTime)),this.emit(3,{...this.state})}getTitle(){if(this.profile===null)return["加载中..."];const{name:e}=this.profile;return[e]}onSourceFileChange(e){return this.on(1,e)}onProfileLoaded(e){return this.on(0,e)}beforeLoadSubtitle(e){return this.on(2,e)}onStateChange(e){return this.on(3,e)}}function Ca(s,r){let e=!0;return setInterval(()=>{e=!0},s),(...i)=>{e!==!1&&(r(...i),e=!1)}}function $a(s){const{app:r,client:e,storage:i,view:n}=s,a=i.get("player_settings"),o=new xe({value:a}),{type:l,volume:h,rate:u}=a,d=new ka({resolution:l,client:e}),m=d,f=new ot({app:r,volume:h,rate:u}),x=new li({app:r,client:e}),g=f;return r.onHidden(()=>{f.pause()}),r.onShow(()=>{f.setCurrentTime(f.currentTime)}),r.onOrientationChange(w=>{if(w==="horizontal"){if(!f.hasPlayed&&r.env.ios||f.isFullscreen)return;f.requestFullScreen(),f.isFullscreen=!0}w==="vertical"&&f.disableFullscreen()}),f.onExitFullscreen(()=>{f.pause(),r.orientation===Rt.Vertical&&f.disableFullscreen()}),d.onProfileLoaded(w=>{r.setTitle(d.getTitle().join(" - "));const{curSource:p}=w;d.playSource(p,{currentTime:p.currentTime??0}),f.setCurrentTime(p.currentTime)}),m.beforeLoadSubtitle(()=>{g.clearSubtitle()}),d.$source.onSubtitleLoaded(w=>{f.showSubtitle(ci(w))}),d.onTip(w=>{r.tip(w)}),d.onSourceFileChange(w=>{f.pause(),f.setSize({width:w.width,height:w.height}),i.merge("player_settings",{type:w.type}),f.loadSource(w)}),f.onReady(()=>{f.disableFullscreen()}),f.onCanPlay(()=>{const{currentTime:w}=d;function p(){f.setCurrentTime(w);const{rate:j}=o.value;j&&f.changeRate(Number(j))}(async()=>(r.env.android&&await ke(1e3),p()))(),f.hasPlayed&&f.play()}),f.onVolumeChange(({volume:w})=>{i.merge("player_settings",{volume:w})}),f.onProgress(({currentTime:w,duration:p})=>{f._canPlay&&d.handleCurTimeChange({currentTime:w,duration:p})}),f.onPause(({currentTime:w,duration:p})=>{d.updatePlayProgressForce({currentTime:w,duration:p})}),f.onResolutionChange(({type:w})=>{}),f.onSourceLoaded(()=>{f.setCurrentTime(d.currentTime),f.hasPlayed}),g.onError(async w=>{m.setSourceFileInvalid(),await(async()=>{if(!m.profile||!m.curSource)return;const p=m.curSource.files,j=m.curSource.curFileId,k=p.findIndex(P=>P.id===j)+1,b=p[k];if(!b){x.$ref.select("无法播放"),x.$media.select({media_id:m.profile.id,media_source_id:m.curSource.id}),g.setInvalid(w.message);return}await m.changeSourceFile(b)})(),g.pause()}),f.onUrlChange(async({url:w})=>{f.load(w)}),{$tv:m,$player:g,$mediaReport:x,ready(){m.fetchProfile(n.query.id)},handleClickElm(w){var y;const{elm:p,value:j}=w;if(p){if(p==="play-menu"){g.play();return}if(p==="pause-menu"){g.pause();return}if(p==="arrow-left-menu"){history.back();return}if(p==="subtitle-menu"){if(m.$source.subtitle===null)return;g.toggleSubtitleVisible(),m.$source.toggleSubtitleVisible();return}if(p==="copy-media-url-btn"){if(m.$source.profile){r.copy((y=m.$source.profile)==null?void 0:y.url),r.tip({text:["复制成功"]});return}r.tip({text:["暂无播放地址"]});return}p==="report-media-error-btn"&&x.$dialog.show()}}}}class _a{constructor(r){c(this,"$view");c(this,"$scroll");c(this,"$mask",new Z({mounted:!0,visible:!0}));c(this,"$top",new Z({mounted:!0,visible:!0}));c(this,"$bottom",new Z({mounted:!0,visible:!0}));c(this,"$control",new Z({mounted:!0,visible:!0}));c(this,"$subtitle",new Z({}));c(this,"$tmpRateTip",new Z);c(this,"$settings",new V);c(this,"$episodes",new V);c(this,"visible",!0);c(this,"timer",null);const{app:e,view:i}=r;this.$view=i,this.$scroll=new Q({os:e.env})}showControls(){this.visible=!0,this.$top.show(),this.$bottom.show(),this.$control.show(),this.$mask.show()}hideControls(){this.visible=!1,this.$top.hide({destroy:!1}),this.$bottom.hide({destroy:!1}),this.$control.hide(),this.$mask.hide()}toggleControls(){if(this.visible){this.hideControls();return}this.showControls()}attemptToShowControls(){return this.timer!==null?(this.hideControls(),clearTimeout(this.timer),this.timer=null,!1):(this.showControls(),!0)}prepareHideControls(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.hideControls(),this.timer=null},5e3)}prepareToggleControls(){if(this.timer===null){this.toggleControls();return}clearTimeout(this.timer),this.toggleControls()}stopHideControls(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}}const Ta=L.memo(s=>{const{app:r,history:e,client:i,storage:n,view:a}=s,o=H(()=>$a(s)),l=H(()=>new _a({app:r,view:a})),h=H(()=>new He({onLongPress(){o.$tv.playing&&(l.$tmpRateTip.show(),o.$player.changeRateTmp(2))},onLongPressFinish(){l.$tmpRateTip.hide(),o.$player.recoverRate()}})),[u,d]=N.useState(o.$player.state),m=N.useCallback(f=>{const x=f.currentTarget;if(x===null)return;const{elm:g,stop:w,value:p}=x.dataset;g&&(w&&f.stopPropagation(),o.handleClickElm({elm:g,value:p}))},[]);return D(()=>{a.query.rate&&o.$player.changeRate(Number(a.query.rate)),a.onHidden(()=>{o.$player.pause()}),o.$player.onStateChange(f=>d(f)),o.$player.beforeAdjustCurrentTime(()=>{l.stopHideControls()}),o.$player.afterAdjustCurrentTime(()=>{l.prepareHideControls()}),o.ready()}),t.jsxs(t.Fragment,{children:[t.jsxs(se,{store:l.$scroll,className:"fixed h-screen bg-w-bg-0 scroll--hidden",onClick:f=>{l.prepareToggleControls()},children:[t.jsxs("div",{className:"absolute z-10 top-[36%] left-[50%] w-full min-h-[120px] -translate-x-1/2 -translate-y-1/2",children:[t.jsx(Ft,{store:o.$player}),t.jsx(ce,{className:"z-20 absolute inset-0",enterClassName:"animate-in fade-in",exitClassName:"animate-out fade-out",store:l.$mask,children:t.jsx("div",{className:"absolute inset-0 bg-w-fg-1 dark:bg-black opacity-20"})}),t.jsx("div",{className:"absolute z-30 top-[50%] left-[50%] text-w-bg-0 dark:text-w-fg-0 -translate-x-1/2 -translate-y-1/2",onClick:f=>{f.stopPropagation()},children:t.jsx(ce,{enterClassName:"animate-in fade-in",exitClassName:"animate-out fade-out",store:l.$control,children:t.jsx(M,{when:!u.error,fallback:t.jsxs("div",{className:"flex flex-col justify-center items-center",children:[t.jsx(pe,{className:"w-16 h-16"}),t.jsxs("div",{className:"flex items-center mt-4",onClick:f=>{f.stopPropagation(),e.push("root.help",{highlight:""})},children:[t.jsx("div",{className:"text-center",children:u.error}),t.jsx("div",{className:"ml-2",children:t.jsx(Tt,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex items-center mt-4 space-x-4 text-center text-sm",children:[t.jsx("div",{"data-elm":"report-media-error-btn","data-stop":"1",onClick:m,children:"反馈问题"}),t.jsx("div",{"data-elm":"copy-media-url-btn","data-stop":"1",onClick:m,children:"复制播放地址"})]})]}),children:t.jsx(M,{when:!!u.ready,fallback:t.jsx(ze,{className:"w-16 h-16 animate animate-spin"}),children:t.jsxs("div",{className:"flex items-center space-x-8",onClick:f=>{f.stopPropagation()},children:[t.jsxs("div",{className:"relative",onClick:()=>{o.$player.rewind(),l.prepareHideControls()},children:[t.jsx(Ss,{className:"w-12 h-12"}),t.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 text-center text-sm",children:"10s"})]}),t.jsx("div",{className:"p-2",children:t.jsx(M,{when:u.playing,fallback:t.jsx("div",{onClick:()=>{o.$player.play(),l.prepareHideControls()},children:t.jsx(ks,{className:"relative left-[6px] w-16 h-16"})}),children:t.jsx("div",{onClick:()=>{o.$player.pause(),l.prepareHideControls()},children:t.jsx(Cs,{className:"w-16 h-16"})})})}),t.jsxs("div",{className:"relative",onClick:()=>{o.$player.speedUp(),l.prepareHideControls()},children:[t.jsx(et,{className:"w-12 h-12"}),t.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 text-center text-sm",children:"10s"})]})]})})})})})]}),t.jsxs(at,{store:h,className:"absolute z-0 inset-0 text-w-fg-0",children:[t.jsx("div",{className:"",onClick:f=>{f.stopPropagation()},children:t.jsx(ce,{store:l.$top,enterClassName:"animate-in fade-in slide-in-from-top",exitClassName:"animate-out fade-out slide-out-to-top",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"inline-block p-4",onTouchEnd:()=>{e.back()},children:t.jsx(je,{className:"w-6 h-6"})}),t.jsx(M,{when:r.env.ios,children:t.jsx("div",{className:"flex items-center",children:t.jsx("div",{className:"inline-block p-4",onClick:f=>{o.$player.showAirplay()},children:t.jsx($s,{className:"w-6 h-6"})})})})]})})}),t.jsx("div",{className:"absolute bottom-12 w-full safe-bottom",onClick:f=>{f.stopPropagation()},children:t.jsxs(ce,{enterClassName:"animate-in slide-in-from-bottom fade-in",exitClassName:"animate-out slide-out-to-bottom fade-out",store:l.$bottom,children:[t.jsx("div",{className:"px-4",children:t.jsx(ii,{store:o.$player})}),t.jsxs("div",{className:"flex items-center flex-reverse space-x-4 mt-6 w-full px-2",onClick:f=>{f.stopPropagation()},children:[t.jsx("div",{className:"relative p-2 rounded-md",onClick:()=>{l.$settings.show()},children:t.jsx(_s,{className:"w-6 h-6"})}),t.jsx("div",{className:"relative p-2 rounded-md",onClick:()=>{o.$player.requestFullScreen()},children:t.jsx(Ts,{className:"w-6 h-6"})})]})]})}),t.jsx(ce,{store:l.$tmpRateTip,children:t.jsx("div",{className:"absolute left-1/2 bottom-[24%] -translate-x-1/2 text-center",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(et,{className:"w-8 h-8"}),t.jsx("div",{children:"2x速 快进中"})]})})})]})]}),t.jsx(Ge,{store:l.$settings,hideTitle:!0,children:t.jsx(Sa,{$media:o.$tv,$player:o.$player,app:r,client:i,history:e,storage:n})}),t.jsx(G,{store:o.$mediaReport.$dialog,children:t.jsx("div",{className:"text-w-fg-1",children:t.jsx("p",{className:"mt-2",children:"「无法播放」"})})})]})}),Pa=L.memo(s=>{const r=H(()=>new te({onClick(){}}));return t.jsx("div",{className:"flex items-center justify-center h-screen",children:t.jsxs("div",{className:"",children:[t.jsx(Re,{className:"w-36 h-36"}),t.jsx("div",{className:"mt-4 text-6xl text-center",children:"404"}),t.jsx("div",{className:"mt-4 text-center",children:"路由不存在"}),t.jsx(le,{className:"mt-2",store:r,children:"返回首页"})]})})});function Ra(s){const{app:r,client:e}=s,i=new Q({os:r.env,async onPullToRefresh(){await o.refresh(),i.finishPullToRefresh()},async onReachBottom(){await o.loadMore(),i.finishLoadingMore()}}),n=new re({placeholder:"请输入关键字",onEnter(p){o.search({remark:p})},onBlur(p){o.search({remark:p})}}),a=new re({defaultValue:"",placeholder:"请输入好友备注",onEnter(){l.okBtn.click()}}),o=new ie(new F(Fs,{client:e}),{onLoadingChange(p){n.setLoading(!o.response.initial&&p)}}),l=new V({title:"邀请好友",onOk(){if(!a.value){r.tip({text:[a.placeholder]});return}g.run({remark:a.value})}}),h=new V({title:"好友专属链接",footer:!1}),u=new V({title:"移动端二维码",footer:!1}),d=new F(zs,{client:e,defaultResponse:{list:[]}}),m=new V({title:"生成邀请码",async onOk(){const p=f.value;if(!p){r.tip({text:["请输入邀请码数量"]});return}m.okBtn.setLoading(!0);const j=await d.run({count:Number(p)});if(m.okBtn.setLoading(!1),j.error){r.tip({text:[j.error.message]});return}r.tip({text:["创建成功"]}),m.hide(),x.show()}}),f=new re({defaultValue:"1",placeholder:"请输入邀请码数量"}),x=new V({title:"邀请码",footer:!1}),g=new F(ar,{client:e,onLoading(p){l.okBtn.setLoading(p)},onSuccess(p){const{tokens:j}=p;j[0]&&(r.tip({text:["新增成功"]}),o.refresh(),l.hide())},onFailed(p){r.tip({text:["邀请失败",p.message]})}});return{state:{response:o.response},$list:o,request:{$invitationCodeCreateRequest:d},ui:{$scroll:i,$searchInput:n,$inviteDialog:l,$invitationCodeDialog:m,$invitationCodeInput:f,$invitationCodeResultDialog:x,$qrcodeDialog:u,$memberLinkDialog:h,$remarkInput:a}}}const La=L.memo(s=>{const{app:r,history:e,client:i,view:n}=s,a=H(()=>Ra(s)),[o,l]=N.useState(a.$list.response),[h,u]=N.useState(a.request.$invitationCodeCreateRequest.response),[d,m]=N.useState(null);D(()=>{a.$list.onStateChange(g=>{l(g)}),a.request.$invitationCodeCreateRequest.onResponseChange(g=>{u(g)})}),N.useEffect(()=>{a.$list.init()},[]);const{dataSource:f,error:x}=o;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative z-20 bg-w-bg-0",children:[t.jsxs("div",{className:"flex items-center justify-between py-2 px-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"inline-block",onTouchEnd:()=>{e.back()},children:t.jsx(je,{className:"w-6 h-6"})}),t.jsx("div",{className:"text-md"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"p-2 rounded-md bg-w-bg-2",onClick:()=>{a.ui.$inviteDialog.show()},children:t.jsx(qi,{className:"w-6 h-6"})}),t.jsx("div",{className:"p-2 rounded-md bg-w-bg-2",onClick:()=>{a.ui.$invitationCodeDialog.show()},children:t.jsx(ys,{className:"w-6 h-6"})}),t.jsx("div",{className:"p-2 rounded-md bg-w-bg-2",onClick:()=>{e.push("root.invitation_code")},children:t.jsx(Ai,{className:"w-6 h-6"})})]})]}),t.jsx("div",{className:"flex items-center justify-between w-full px-4 py-2 space-x-4",children:t.jsx("div",{className:"relative w-full",children:t.jsx(ee,{store:a.ui.$searchInput,prefix:t.jsx(_t,{className:"w-5 h-5"})})})})]}),t.jsx(se,{store:a.ui.$scroll,className:"z-10 absolute left-[0] top-[112px] bottom-0 w-full h-auto",children:t.jsx(me,{store:a.$list,className:"relative grid grid-cols-1 pt-4 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-5",children:(()=>f.map(g=>{const{id:w,remark:p,tokens:j}=g;return t.jsxs("div",{className:"flex p-4 pb-4 mb-2 bg-w-bg-2 cursor-pointer",children:[t.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-slate-300 rounded-full mr-4",children:t.jsx("div",{className:"text-3xl text-slate-500",children:p.slice(0,1).toUpperCase()})}),t.jsxs("div",{className:"flex-1 max-w-full overflow-hidden",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("h2",{className:"text-xl",children:p})}),t.jsx("div",{className:"operations mt-2",children:t.jsx(M,{when:j.length!==0,children:t.jsx(t.Fragment,{children:j.map(y=>{const{id:k,used:b}=y;return t.jsx("div",{className:"flex space-x-2",children:[{prefix:"/pc/home/index?force=1&token=",qrcode:!1,platform:1,text:"PC 端"},{prefix:"/mobile/home/index?force=1&token=",qrcode:!0,platform:2,text:"移动端"}].map(P=>{const{prefix:T,qrcode:I,platform:$,text:R}=P,C=`${e.$router.origin}${T}${k}`;return t.jsx("div",{className:"flex space-x-2",children:t.jsx("div",{className:"",children:t.jsx("div",{className:"p-2 rounded bg-w-bg-1",onClick:B=>{B.stopPropagation(),r.copy(C),r.tip({text:[`${R}链接已复制至剪切板`]})},children:$===1?t.jsx(gs,{className:"w-5 h-5"}):t.jsx(Bi,{className:"w-5 h-5"})})})},T)})},k)})})})})]})]},w)}))()})}),t.jsxs(G,{store:a.ui.$inviteDialog,children:[t.jsx("p",{children:"输入好友备注（该备注仅自己可见）"}),t.jsx("div",{className:"mt-4",children:t.jsx(ee,{prefix:t.jsx(Ue,{className:"w-4 h-4"}),store:a.ui.$remarkInput})})]}),t.jsx(G,{store:a.ui.$memberLinkDialog,children:t.jsx(M,{when:!!d,children:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"",children:d}),t.jsxs("div",{className:"flex items-center mt-4 space-x-2",onClick:()=>{r.copy(d)},children:[t.jsx(We,{className:"w-4 h-4"}),t.jsx("div",{children:"点击复制"})]})]})})}),t.jsx(G,{store:a.ui.$qrcodeDialog,children:t.jsx("div",{className:"flex justify-center mt-4 p-2"})}),t.jsxs(G,{store:a.ui.$invitationCodeDialog,children:[t.jsx("div",{className:"mb-4",children:"请填写邀请码数量"}),t.jsx(ee,{store:a.ui.$invitationCodeInput})]}),t.jsxs(G,{store:a.ui.$invitationCodeResultDialog,children:[t.jsx("div",{className:"text-left",children:"注册地址"}),t.jsxs("div",{className:"text-left",children:[e.$router.origin,"/mobile/register"]}),t.jsx("div",{className:"mt-4 text-left",children:"邀请码"}),t.jsx("div",{className:"h-[120px] overflow-y-auto space-y-1 text-left",children:h==null?void 0:h.list.map(g=>t.jsx("div",{children:g.code}))}),t.jsxs("div",{className:"flex items-center mt-4 space-x-2",onClick:()=>{const g=`注册地址
${e.$router.origin}/mobile/register
            
邀请码
${h==null?void 0:h.list.map(w=>w).join(`
`)}
`;r.copy(g)},children:[t.jsx(We,{className:"w-4 h-4"}),t.jsx("div",{children:"点击复制"})]})]})]})}),Ea=L.memo(s=>{const{app:r,client:e}=s,i=H(()=>new ot({app:r})),[n,a]=N.useState({duration:0});return N.useEffect(()=>{i.setSize({width:1280,height:640}),i.onSourceLoaded(l=>{a(l);const{width:h,height:u}=l;!h||!u||i.setSize({width:h,height:u})});const o="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4";i.onReady(()=>{i.load(o)})},[]),t.jsx(t.Fragment,{children:t.jsxs("div",{children:[t.jsx("div",{className:"w-full min-h-[240px]",children:t.jsx(Ft,{store:i})}),n.duration]})})}),Ma=L.memo(s=>{const{store:r,...e}=s,[i,n]=N.useState(r.state);D(()=>{r.onStateChange(o=>{n(o)})});const a={...e.style,position:i.fixed?"fixed":"unset",top:i.top};return t.jsxs("div",{className:"affix",children:[t.jsx("div",{className:_("__a",e.className),style:a,onAnimationEnd:o=>{const l=o.currentTarget;r.setRect(()=>{const u=l.getBoundingClientRect();return{top:u.top,height:u.height}});const h=l.getBoundingClientRect();r.handleMounted(h)},children:s.children}),i.fixed&&t.jsx("div",{style:{height:i.height}})]})});function Fa(s){const{app:r,client:e}=s,i=new ie(new F(Is,{process:Ds,client:e}),{pageSize:40}),n=new F(si,{client:e,onLoading(d){a.okBtn.setLoading(d)},onFailed(d){r.tip({text:["删除失败",d.message]})},onSuccess(d){r.tip({text:["删除成功"]}),a.hide(),i.deleteItem(m=>{var f;return m.id===((f=o.value)==null?void 0:f.id)}),o.clear()}}),a=new V({onOk(){o.value&&n.run({history_id:o.value.id})}}),o=new xe,l=new Q({os:r.env,async onPullToRefresh(){await i.refresh(),l.finishPullToRefresh()},async onReachBottom(){await i.loadMore(),l.finishLoadingMore()}}),h=new ve({scale:1.38}),u=new Xs({top:0});return{$historyList:i,ui:{$scroll:l,$affix:u,$deletingDialog:a,$thumbnail:h}}}const Ia=L.memo(s=>{const{app:r,client:e,history:i,view:n}=s,a=H(()=>Fa(s)),[o,l]=N.useState(a.$historyList.response);D(()=>{a.$historyList.onStateChange(u=>l(u)),a.$historyList.init()});const{dataSource:h}=o;return t.jsxs(t.Fragment,{children:[t.jsx(Ma,{store:a.ui.$affix,className:"z-50 w-full bg-w-bg-0",children:t.jsx("div",{className:"z-100 flex items-center justify-between w-full p-4",children:t.jsx("div",{className:"flex items-center cursor-pointer",children:t.jsx("div",{className:"inline-block",onTouchEnd:()=>{i.back()},children:t.jsx(je,{className:"w-6 h-6"})})})})}),t.jsx(se,{className:"h-full bg-w-bg-3",store:a.ui.$scroll,children:t.jsx(me,{store:a.$historyList,className:"grid grid-cols-2 gap-2 px-3 md:grid-cols-4 xl:grid-cols-6 pt-4",skeleton:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative w-full rounded-lg",children:[t.jsx("div",{className:"relative w-full h-[124px] overflow-hidden rounded-t-md",children:t.jsx(z,{className:"w-full h-full object-cover"})}),t.jsxs("div",{className:"py-2 pb-4",children:[t.jsx(z,{className:"w-[68%] h-[24px]"}),t.jsx(z,{className:"mt-2 w-[20%] h-[18px]"})]})]}),t.jsxs("div",{className:"relative w-full rounded-lg",children:[t.jsx("div",{className:"relative w-full h-[124px] overflow-hidden rounded-t-md",children:t.jsx(z,{className:"w-full h-full object-cover"})}),t.jsxs("div",{className:"py-2 pb-4",children:[t.jsx(z,{className:"w-[38%] h-[24px]"}),t.jsx(z,{className:"mt-2 w-[72%] h-[18px]"})]})]})]}),children:h.map(u=>{const{id:d,name:m,thumbnail_path:f,latest_episode:x,cur_episode:g,episode_added:w}=u;return t.jsx("div",{className:"relative flex w-full cursor-pointer select-none",children:t.jsxs("div",{className:"relative w-full bg-w-bg-2 rounded-lg",onClick:()=>{i.push("root.season_playing",{id:d})},children:[t.jsx("div",{className:"relative w-full h-[124px] overflow-hidden rounded-t-md",children:t.jsx(be,{className:"w-full h-full object-cover",store:a.ui.$thumbnail.bind(f),alt:m})}),t.jsx("div",{className:"absolute top-2 left-2",children:t.jsxs("div",{className:"huizhang",children:[w,"集未看"]})}),t.jsxs("div",{className:"p-2 pb-4",children:[t.jsx("div",{className:"text-w-fg-0 truncate text-ellipsis",children:m}),t.jsxs("div",{className:"flex items-center mt-2 text-sm text-w-fg-1 truncate text-ellipsis",children:[t.jsx("p",{className:"",children:"当前"}),t.jsx("p",{className:"mx-1",children:"·"}),t.jsx("p",{className:" truncate text-ellipsis",children:g.name})]}),t.jsxs("div",{className:"flex items-center text-sm text-w-fg-1 truncate text-ellipsis",children:[t.jsx("p",{className:"",children:"最新"}),t.jsx("p",{className:"mx-1",children:"·"}),t.jsx("p",{className:" truncate text-ellipsis",children:x.name})]})]})]},d)},d)})})}),t.jsx(G,{store:a.ui.$deletingDialog,children:t.jsx("div",{children:"确认删除吗？"})})]})});function Da(s){const{app:r,view:e,history:i}=s,n=new re({placeholder:"请输入邮箱"}),a=new re({placeholder:"请输入密码",type:"password",autoComplete:!0,onEnter(){o.click()}}),o=new te({async onClick(){const u={email:n.value,pwd:a.value};o.setLoading(!0);const d=await r.$user.loginWithEmailAndPwd(u);if(o.setLoading(!1),d.error){r.tip({text:[d.error.message]});return}r.tip({text:["登录成功"]}),i.replace("root.home_layout.home_index.home_index_season",{language:Y.CN})}}),l=new te({onClick(){i.push("root.register")}}),h=new te({onClick(){i.push("root.home_layout.home_index.home_index_season",{language:Y.CN})}});return{ui:{$username:n,$password:a,$login:o,$register:l,$home:h}}}const za=L.memo(s=>{const{app:r,client:e,view:i,history:n}=s,a=H(()=>Da(s));return t.jsxs("div",{className:"pt-12 px-4 min-h-screen bg-w-bg-0",children:[t.jsx("div",{className:"h-[160px] mx-auto",children:t.jsxs("div",{className:"relative cursor-pointer",children:[t.jsx("div",{className:"z-10 absolute left-14 top-[32px] w-[82%] h-[32px] rounded-xl bg-green-500"}),t.jsx("div",{className:"z-20 relative text-6xl text-center italic",children:"FamilyFlix"})]})}),t.jsxs("div",{className:"space-y-4 rounded-md",children:[t.jsxs("div",{children:[t.jsx("div",{children:"邮箱"}),t.jsx(ee,{className:"mt-1 bg-w-bg-0",store:a.ui.$username})]}),t.jsxs("div",{children:[t.jsx("div",{children:"密码"}),t.jsx(ee,{className:"mt-1 bg-w-bg-0",store:a.ui.$password})]})]}),t.jsxs("div",{className:"w-full mt-8",children:[t.jsx(le,{size:"lg",store:a.ui.$login,children:"登录"}),t.jsx("div",{className:"mt-1 py-2 text-center text-w-fg-1 cursor-pointer hover:underline",onClick:()=>{n.push("root.register")},children:"没有账号，前往注册"}),r.$user.isLogin?t.jsxs("div",{className:"mt-2",children:[t.jsx(le,{size:"lg",variant:"subtle",store:a.ui.$home,children:"前往首页"}),t.jsx("div",{className:"mt-1 text-sm text-w-fg-2 text-center",children:"检测到当前已登录"})]}):null]})]})});function Ha(s){const{app:r,client:e,history:i}=s,n=new Q({os:r.env}),a=new re({defaultValue:"",placeholder:"请输入邮箱",autoFocus:!0}),o=new V({title:"修改邮箱",async onOk(){const u=a.value;if(!u){r.tip({text:["请输入邮箱"]});return}o.okBtn.setLoading(!0);const d=await r.$user.updateEmail({email:u});if(o.okBtn.setLoading(!1),d.error){r.tip({text:[d.error.message]});return}r.tip({text:["更新邮箱成功"]}),a.clear(),o.hide()}}),l=new re({defaultValue:"",placeholder:"请输入密码",type:"password",autoComplete:!1,autoFocus:!0}),h=new V({title:"修改密码",async onOk(){const u=l.value;if(!u){r.tip({text:["请输入密码"]});return}h.okBtn.setLoading(!0);const d=await r.$user.updatePwd({pwd:u});if(h.okBtn.setLoading(!1),d.error){r.tip({text:[d.error.message]});return}l.clear(),h.hide(),r.tip({text:["更新成功，请重新登录"]}),i.push("root.login")}});return{ui:{$email:a,$pwd:l,$scroll:n,$emailDialog:o,$pwdDialog:h}}}const qa=L.memo(s=>{const{app:r,history:e,storage:i,client:n,view:a}=s,o=H(()=>Ha(s));return t.jsxs(t.Fragment,{children:[t.jsx(se,{store:o.ui.$scroll,className:"min-h-screen bg-w-bg-0",children:t.jsxs("div",{className:"w-full h-full",children:[t.jsx("div",{className:"",children:t.jsx("div",{className:"flex items-center",children:t.jsx("div",{className:"inline-block p-4",onTouchEnd:()=>{e.back()},children:t.jsx(je,{className:"w-6 h-6"})})})}),t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{className:"w-full h-[1px] transform scale-y-50 bg-w-fg-3"}),t.jsxs("div",{className:"flex items-center justify-between p-4 bg-w-bg-1",onClick:()=>{if(!r.$user.id){r.tip({text:["异常"]});return}r.copy(r.$user.id),r.tip({text:["复制成功"]})},children:[t.jsx("div",{children:"ID"}),t.jsxs("div",{className:"flex items-center text-w-fg-1",children:[t.jsx("div",{className:"",children:r.$user.id}),t.jsx("div",{className:"ml-2 mr-2",children:t.jsx(We,{className:"w-4 h-4"})})]})]}),t.jsx("div",{className:"w-full h-[1px] transform scale-y-50 bg-w-fg-3"}),t.jsxs("div",{className:"flex items-center justify-between p-4 bg-w-bg-1",onClick:()=>{o.ui.$emailDialog.show()},children:[t.jsx("div",{children:"邮箱"}),t.jsxs("div",{className:"flex items-center text-w-fg-1",children:[t.jsx("div",{className:"",children:(()=>r.$user.email?r.$user.email:"设置邮箱")()}),t.jsx("div",{children:t.jsx(oe,{className:"w-6 h-6"})})]})]}),t.jsx("div",{className:"w-full h-[1px] transform scale-y-50 bg-w-fg-3"}),t.jsxs("div",{className:"flex items-center justify-between p-4 bg-w-bg-1",onClick:()=>{o.ui.$pwdDialog.show()},children:[t.jsx("div",{children:"密码"}),t.jsxs("div",{className:"flex items-center text-w-fg-1",children:[t.jsx("div",{className:"",children:"修改"}),t.jsx("div",{children:t.jsx(oe,{className:"w-6 h-6"})})]})]})]})]})}),t.jsx(G,{store:o.ui.$emailDialog,children:t.jsx(ee,{store:o.ui.$email})}),t.jsx(G,{store:o.ui.$pwdDialog,children:t.jsx(ee,{store:o.ui.$pwd})})]})}),Aa=L.memo(s=>{const{app:r,history:e}=s,i=H(()=>new Q({os:r.env,async onPullToRefresh(){await ke(1200),i.finishPullToRefresh()}})),n=`${e.$router.origin}/pc/home/index`;return t.jsxs(se,{className:"h-screen bg-w-bg-0 safe-bottom",store:i,children:[t.jsx("div",{className:"flex items-center",children:t.jsx("div",{className:"inline-block p-4",onTouchEnd:()=>{e.back()},children:t.jsx(je,{className:"w-6 h-6"})})}),t.jsxs("div",{className:"space-y-4 px-4",children:[t.jsxs("div",{className:"p-4 rounded bg-w-bg-1",children:[t.jsx("div",{className:"",children:"PC 端地址是什么？"}),t.jsxs("div",{className:"flex items-center mt-1 break-all text-sm",children:[t.jsx("div",{children:n}),t.jsx("div",{className:"ml-4",onClick:()=>{r.copy(n),r.tip({text:["复制成功"]})},children:t.jsx(We,{className:"w-4 h-4"})})]})]}),t.jsxs("div",{className:"p-4 rounded bg-w-bg-1",children:[t.jsx("div",{className:"",children:"如何修改密码？"}),t.jsxs("div",{className:"mt-1 break-all text-sm",onClick:()=>{e.push("root.update_mine_profile")},children:[t.jsx("span",{children:"进入"}),t.jsx("span",{className:"underline",children:"邮箱密码编辑页面"}),t.jsx("span",{children:"，填写好信息后保存即可。"})]})]}),t.jsxs("div",{className:"p-4 rounded bg-w-bg-1",children:[t.jsx("div",{className:"",children:"视频色彩怪异？"}),t.jsx("div",{className:"mt-1 break-all text-sm",children:t.jsxs("ol",{children:[t.jsx("li",{children:"切换其他源"}),t.jsx("li",{children:"使用三方播放器"}),t.jsx("li",{children:"PC 端观看"})]})})]}),t.jsxs("div",{className:"p-4 rounded bg-w-bg-1",children:[t.jsx("div",{className:"",children:"视频提示「不支持的视频格式」？"}),t.jsxs("div",{className:"mt-1 break-all text-sm",children:[t.jsx("div",{children:"问题同上。基本上视频播放相关的问题，都可以通过这三种方式解决。"}),t.jsxs("ol",{children:[t.jsx("li",{children:"切换其他源"}),t.jsx("li",{children:"使用三方播放器"}),t.jsx("li",{children:"PC 端观看"})]}),t.jsx("div",{children:"如果不行，可以在播放页面「反馈」问题"})]})]}),t.jsxs("div",{className:"p-4 rounded bg-w-bg-1",children:[t.jsx("div",{className:"",children:"如何使用三方播放器？"}),t.jsx("div",{className:"mt-1 break-all text-sm",children:t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"text-md",children:"1、VLC 播放器"}),t.jsx("img",{className:"ml-2 w-8 h-8",src:"https://cdn.weipaitang.com/static/20230928ab23e98c-d8fc-e98cd8fc-453a-47af288db8d1-W512H512"})]}),t.jsx("div",{children:"下载、打开 VLC 播放器。进入「网络」Tab，选择「打开网络串流」，将视频「播放地址」输入即可开始播放。"})]})})]}),t.jsxs("div",{className:"p-4 rounded bg-w-bg-1",children:[t.jsx("div",{className:"",children:"如何在小程序端播放视频"}),t.jsx("div",{className:"mt-1 break-all text-sm",children:t.jsxs("ol",{children:[t.jsx("li",{onClick:()=>{e.push("root.update_mine_profile")},children:"点击前往「信息编辑页面」"}),t.jsx("li",{children:"复制「ID」字段"}),t.jsx("li",{children:"进入小程序「追剧日记」，点击下方「我的」页面"}),t.jsx("li",{children:"点击「关联账号」，输入上面复制的「ID」后点击「确定」即可"}),t.jsx("li",{children:"退出小程序重新进入即可"})]})})]})]})]})});function Ba(s){const{view:r,app:e,client:i,history:n}=s,a=r.query.code;Ze.Loading;let o=null;const l=new F(cr,{client:i}),h=new te({async onClick(){h.setLoading(!0);const u=await l.run({code:a,status:Ze.Confirmed});if(u.error){e.tip({text:[u.error.message]});return}h.setLoading(!1),n.replace("root.home_layout.home_index.home_index_season",{language:Y.CN})}});return{ui:{$btn:h},ready(){if(!a){o=new Error("缺少 code 参数"),e.tip({text:[o.message]});return}l.run({code:a,status:Ze.Scanned})}}}const Oa=L.memo(s=>{const r=H(()=>Ba(s));return Dr(()=>{r.ready()}),t.jsxs("div",{className:"pt-24 px-4 h-screen bg-w-bg-0",children:[t.jsx("div",{className:"h-[198px] mx-auto",children:t.jsxs("div",{className:"relative cursor-pointer",children:[t.jsx("div",{className:"z-10 absolute left-12 top-[32px] w-[82%] h-[32px] rounded-xl bg-green-500"}),t.jsx("div",{className:"z-20 relative text-6xl text-center italic",children:"FunFlixFlim"})]})}),t.jsxs("div",{className:"mt-8",children:[t.jsx(le,{size:"lg",store:r.ui.$btn,children:"确认"}),t.jsx("div",{className:"mt-4 text-sm text-center",children:"点击确认登录"})]})]})});function Va(s){const{app:r,history:e,client:i}=s,n=new ie(new F(hr,{client:i}));new F(zs,{client:i});const a=new Q({os:r.env,async onPullToRefresh(){await n.refresh(),a.finishPullToRefresh()},async onReachBottom(){await n.loadMore(),a.finishLoadingMore()}});return{state:{response:n.response},$list:n,ui:{$scroll:a}}}const Ua=L.memo(s=>{const{app:r,history:e}=s,i=H(()=>Va(s)),[n,a]=N.useState(i.$list.response);return D(()=>{i.$list.onStateChange(o=>{a(o)}),i.$list.init()}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between py-2 px-4 h-[56px]",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"inline-block",onTouchEnd:()=>{e.back()},children:t.jsx(je,{className:"w-6 h-6"})}),t.jsx("div",{className:"text-md"})]}),t.jsx("div",{className:"flex items-center"})]}),t.jsx(se,{store:i.ui.$scroll,className:"overflow-y-auto fixed top-[56px] bottom-0 bg-w-bg-2",children:t.jsx(me,{store:i.$list,children:t.jsx("div",{className:"pt-8 px-4 space-y-2 divider-y-1",children:n.dataSource.map(o=>{const{id:l,code:h,invitee:u}=o;return t.jsxs("div",{className:"flex items-center justify-between rounded-md",children:[t.jsxs("div",{children:[t.jsx("div",{className:_("text-xl",{underline:u,"line-through":u}),children:h}),u?t.jsxs("div",{className:"mt-2",children:["邀请了 ",u.nickname]}):null]}),t.jsx("div",{className:"p-2 rounded-md bg-w-bg-2",onClick:()=>{u||(r.copy(h),r.tip({text:["复制成功"]}))},children:t.jsx(We,{className:_("w-6 h-6",{"text-w-fg-2":u})})})]})})})})})]})});function Wa(s){const{app:r,view:e,history:i,client:n}=s,a=new re({placeholder:"请输入邮箱"}),o=new re({placeholder:"请输入密码",type:"password",autoComplete:!1,onEnter(){h.click()}}),l=new re({placeholder:"没有则不用输入",autoComplete:!0,onEnter(){h.click()}}),h=new te({async onClick(){const m={email:a.value,pwd:o.value,code:l.value};h.setLoading(!0);const f=await r.$user.register(m);if(h.setLoading(!1),f.error){r.tip({text:[f.error.message]});return}r.tip({text:["注册成功"]}),i.replace("root.home_layout.home_index.home_index_season",{language:Y.CN})}}),u=new te({onClick(){i.push("root.login")}}),d=new te({onClick(){i.push("root.home_layout.home_index.home_index_season",{language:Y.CN})}});return{ui:{$username:a,$password:o,$code:l,$register:h,$login:u,$home:d}}}const Ga=L.memo(s=>{const{app:r,client:e,view:i,history:n}=s,a=H(()=>Wa(s));return t.jsxs("div",{className:"pt-12 min-h-screen px-4 bg-w-bg-0",children:[t.jsx("div",{className:"h-[160px] mx-auto",children:t.jsxs("div",{className:"relative cursor-pointer",children:[t.jsx("div",{className:"z-10 absolute left-14 top-[32px] w-[82%] h-[32px] rounded-xl bg-green-500"}),t.jsx("div",{className:"z-20 relative text-6xl text-center italic",children:"FamilyFlix"})]})}),t.jsxs("div",{className:"space-y-4 rounded-md",children:[t.jsxs("div",{children:[t.jsx("div",{children:"邮箱"}),t.jsx(ee,{className:"mt-1 bg-w-bg-0",store:a.ui.$username})]}),t.jsxs("div",{children:[t.jsx("div",{children:"密码"}),t.jsx(ee,{className:"mt-1 bg-w-bg-0",store:a.ui.$password})]}),t.jsxs("div",{children:[t.jsx("div",{children:"邀请码"}),t.jsx(ee,{className:"mt-1 bg-w-bg-0",store:a.ui.$code})]})]}),t.jsxs("div",{className:"w-full mt-4",children:[t.jsx(le,{size:"lg",store:a.ui.$register,children:"注册"}),t.jsx("div",{className:"mt-1 py-2 text-center text-w-fg-1 cursor-pointer hover:underline",onClick:()=>{n.push("root.login")},children:"已有账号，前往登录"}),r.$user.isLogin?t.jsxs("div",{className:"mt-2",children:[t.jsx(le,{size:"lg",variant:"subtle",store:a.ui.$home,children:"前往首页"}),t.jsx("div",{className:"mt-1 text-sm text-w-fg-2 text-center",children:"检测到当前已登录"})]}):null]})]})}),ds={"root.home_layout":zr,"root.home_layout.home_index":Rn,"root.home_layout.home_index.home_index_recommended":Fn,"root.home_layout.home_index.home_index_history":Wn,"root.home_layout.home_index.home_index_movie":An,"root.home_layout.home_index.home_index_season":Hn,"root.mine":ea,"root.update_mine_profile":qa,"root.history_updated":Ia,"root.search":sa,"root.messages":En,"root.invitee":La,"root.season_playing":ba,"root.movie_playing":Ta,"root.invitation_code":Ua,"root.help":Aa,"root.login":za,"root.register":Ga,"root.scan":Oa,"root.test":Ea,"root.notfound":Pa};const ms=W.$view;function Ya(){const s=H(()=>new un),r=H(()=>new V({title:"升级提示",cancel:!1,onOk(){window.location.reload()}})),[e,i]=N.useState(null),[n,a]=N.useState(ms.subViews);return D(()=>{ms.onSubViewsChange(u=>{a(u)}),X.onTip(u=>{const{text:d}=u;s.show({texts:d})}),X.onUpdate(()=>{r.show()}),X.onError(u=>{i(u)});const{innerWidth:o,innerHeight:l,location:h}=window;W.$router.prepare(h),X.start({width:X.env.pc?375:o,height:l})}),e?t.jsx("div",{className:_("fixed inset-0 z-10"),onClick:()=>{W.reload()},children:t.jsx("div",{className:"w-screen h-screen flex items-center justify-center",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl text-center",children:e.message}),t.jsx("div",{className:"mt-4 text-center",children:"请根据上述提示进行操作，或者点击刷新"})]})})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:_("screen w-screen h-screen"),children:n.map((o,l)=>{const h=o.name,u=ds[h];return t.jsx(Lt,{className:_("z-10 fixed left-1/2 top-0 h-full mx-auto bg-w-bg-3 shadow-xl opacity-100 -translate-x-1/2",X.env.pc?"w-[375px]":"w-full"),store:o,index:10+l,children:t.jsx(u,{app:X,history:W,client:Ee,storage:X.$storage,pages:ds,view:o})},l)})}),t.jsx(pn,{store:s}),t.jsx(G,{store:r,children:t.jsx("div",{children:"当前版本过旧，点击确定升级"})})]})}Oi.createRoot(document.getElementById("root")).render(t.jsx(L.StrictMode,{children:t.jsx(Kn,{children:t.jsx(Ya,{})})}));
